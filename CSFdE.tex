\documentclass[dvipsnames]{article}
\usepackage[a4paper, landscape]{geometry}
\usepackage{url}
\usepackage{multicol} 
\usepackage{amsmath}
\usepackage{esint}
\usepackage{amsfonts}
\usepackage{tikz}
\usetikzlibrary{decorations.pathmorphing}
\usepackage{caption}
\usepackage{amsmath,amssymb}
\usepackage{bbding}
\usepackage{pifont}
\usepackage{wasysym}
\usepackage{colortbl}
\usepackage{xcolor, soul} %colors and \hl
\usepackage{mathtools} 
\usepackage{amsmath,amssymb}
\usepackage[shortlabels]{enumitem}
\usepackage{fontawesome}
\usepackage[american,european, siunitx]{circuitikz} %https://grex99.gitlab.io/circuitgui/
\usepackage{graphicx}
\usepackage{microtype}

\makeatletter

\newcommand*\bigcdot{\mathpalette\bigcdot@{.5}}
\newcommand*\bigcdot@[2]{\mathbin{\vcenter{\hbox{\scalebox{#2}{$\m@th#1\bullet$}}}}}
\makeatother

\definecolor{CustomYellow}{RGB}{233,215,0}

\title{Cheat Sheet}
\usepackage[brazilian]{babel}
\usepackage[utf8]{inputenc}

\advance\topmargin-.8in
\advance\textheight3in
\advance\textwidth3in
\advance\oddsidemargin-1.5in
\advance\evensidemargin-1.5in
\parindent0pt
\parskip2pt
%------------ COMMANDS ---------------
\newcommand{\hr}{\centerline{\rule{3.5in}{1pt}}}
%\colorbox[HTML]{e4e4e4}{\makebox[\textwidth-2\fboxsep][l]{texto}


%------------ CONDITIONAL FORMATTING ---------------
\newcommand\conform{}
%\newcommand\conform{S}
\newcommand\dummytext[1]{\if \conform S {#1} \else \vspace{5cm} \hspace{5cm} \fi}

%---------------------------------------------------
\begin{document}

%\begin{center}{\huge{\textbf{Formulario esame elettrotecnica}}}\\
%\end{center}
\begin{multicols*}{3}

    \tikzstyle{mybox} = [draw=CustomYellow, fill=white, very thick,
    rectangle, rounded corners, inner sep=10pt, inner ysep=10pt]
    \tikzstyle{fancytitle} =[fill=CustomYellow, text=white, font=\bfseries]

    \tikzset{
        miaFreccia/.style={
                ->,
                >=latex,
                line width=1pt,
                shorten <=5mm,
                shorten >=5mm
            }
    }

    %------------ Prefissi SI ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \begin{center}
                    \begin{tabular}{|c|c|c|}
                        \hline
                        \textbf{Simbolo} & \textbf{Nome} & \textbf{Fattore} \\
                        \hline
                        G & giga & $10^{9}$ \\
                        \hline
                        M & mega & $10^{6}$ \\
                        \hline
                        k & kilo & $10^{3}$ \\
                        \hline
                        h & etto & $10^{2}$ \\
                        \hline
                        da & deca & $10^{1}$ \\
                        \hline
                        d & deci & $10^{-1}$ \\
                        \hline
                        c & centi & $10^{-2}$ \\
                        \hline
                        m & milli & $10^{-3}$ \\
                        \hline
                        $\mu$ & micro & $10^{-6}$ \\
                        \hline
                        n & nano & $10^{-9}$ \\
                        \hline
                    \end{tabular}
                \end{center}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Prefissi SI (Notazione Scientifica)};
    \end{tikzpicture}

    \newpage

    %SCALA TRANSITORI

    \resizebox{\columnwidth}{0.9\textheight}{%------------ Box 26 ---------------
        \label{Box 26}
        \begin{tikzpicture}
            \node [mybox] (box){%
                \begin{minipage}{0.3\textwidth}

                    \begin{enumerate}
                        \item Per \colorbox{yellow}{$t \to 0^-$},
                              \begin{enumerate}
                                  \item \textbf{calcolare variabile di stato prima dell’inizio del transitorio}
                                  \item In questa fase il \textbf{\color{orange}condensatore\color{black}}/\textbf{\color{Fuchsia}induttore\color{black}                                   \color{black}} si comporta come \textbf{\color{orange}circuito aperto\color{black}}/\textbf{\color{Fuchsia}cortocircuito\color{black}                                   \color{black}}
                                  \item Sfrutterò nella fase 2 la continuitá della variabile di stato
                              \end{enumerate}

                        \item Per \colorbox{Dandelion}{\(t \to 0^+\) (per var. \textbf{NON} di stato es. $v_x, i_x$) },
                              \begin{enumerate}
                                  \item (Eventuale chiusura interruttore)
                                  \item \textbf{Sfrutto continuitá variabile di stato}: \\ \(\color{orange}v_C(t_0^-)=v_C(t_0^+)\)\color{black} / \color{Fuchsia}\(i_L(t_0^-)= i_L(t_0^+)\)\color{black}
                                  \item \textbf{Sostituisco al transitorio} GENERATORE IDEALE DI \color{orange}\textbf{TENSIONE}\color{black} / \color{Fuchsia}\textbf{CORRENTE }\color{black} con \ul{\textbf{valore pari alla variabile di stato appena calcolata}} $$E=V_C(t \to 0^-) \quad I=I_L(t \to 0^-)$$
                              \end{enumerate}

                        \item Per \colorbox{BurntOrange}{\(t \to \infty\)} / \colorbox{BurntOrange}{\(t>0\)} :
                              \begin{enumerate}
                                  \item \textbf{Soluzione di tipo esponenziale}
                                        \begin{enumerate}
                                            \item Formule variabili di stato:
                                                  \begin{align*}
                                                      V_C(t) & = V_{C_{\infty}}+\left[V_{C}(0)-V_{C_\infty}\right] e^{-\frac{t}{\tau}} \\
                                                      I_L(t) & = I_{L_{\infty}}+\left[I_{L}(0)-I_{L_\infty}\right] e^{-\frac{t}{\tau}}
                                                  \end{align*}

                                            \item Formule per le grandezze \textbf{non di stato}:
                                                  \begin{align*}
                                                      I_C(t) & = I_{C_\infty}+[I_C(\color{red}0^+\color{black})-I_{C_\infty}]e^{\frac{-t}{\tau}} \\
                                                      V_L(t) & = V_{L_\infty}+[V_L(\color{red}0^+\color{black})-V_{L_\infty}]e^{\frac{-t}{\tau}}
                                                  \end{align*}

                                            \item Qui, siamo \textbf{\color{red}ancora a regime\color{black}}: il \textbf{\color{orange}condensatore\color{black}}/\textbf{\color{Fuchsia}induttore\color{black}                                   \color{black}} si comporta come \textbf{\color{orange}circuito aperto\color{black}}/\textbf{\color{Fuchsia}cortocircuito\color{black}                                   \color{black}}
                                            \item Cerco la variabile di stato per \(t \to \infty\)
                                            \item Cerco \(\tau\):
                                                  \begin{enumerate}
                                                      \item Mi serve \(R_{\text{eq}}\) ai morsetti di dove c’é transitorio
                                                      \item \textbf{\color{brown}Spengo generatori non pilotati\color{black}}
                                                      \item uso \color{teal} \textbf{generatore sonda (c.g.)} - cerco corrente che passa sul ramo della sonda in funzione di \(V_S\):  \(?\rightarrow I_S(V_S)\)

                                                            \[
                                                                R_{\text{eq}}=\frac{V_S}{I_S(V_S)}
                                                            \]
                                                            \color{black}
                                                      \item Calcolo  \(\tau\):

                                                            \[
                                                                \tau = C \cdot R_{\text{eq}} = \frac{L}{R_{\text{eq}}}
                                                            \]
                                                  \end{enumerate}
                                        \end{enumerate}


                              \end{enumerate}
                    \end{enumerate}
                \end{minipage}
            };
            %------------ Box 26 Header ---------------------
            \node[fancytitle, right=10pt] at (box.north west) {\color{white}Procedimento transitori:};
        \end{tikzpicture}}


    %------------ Box 27 ---------------
    \label{Box 27}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}
                \begin{enumerate}
                    \item Traccio asintoto
                    \item Sfrutto \textbf{proprietá dell’esponenziale}: tangente al grafico in \(t=0\) interseca il valore asintotico dopo \(\Delta t = \tau\)
                    \item Dopo \(t=5\tau\) la funzione assume valore asintotico
                \end{enumerate}

            \end{minipage}
        };
        %------------ Box 27 Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Grafico};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Condensatore - Casi Semplici Carica/Scarica ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Carica e Scarica RC - Casi Semplici}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Costante di tempo:}
                    $$\boxed{\tau = R \cdot C}$$

                    Unità: $[\Omega] \cdot [F] = [s]$
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{CARICA del condensatore}

                    \vspace{0.1cm}
                    Condensatore inizialmente scarico ($V_C(0) = 0$), caricato a $V_{finale}$:

                    $$\boxed{V_C(t) = V_{finale} \cdot \left(1 - e^{-\frac{t}{\tau}}\right)}$$

                    $$\boxed{I_C(t) = \frac{V_{finale}}{R} \cdot e^{-\frac{t}{\tau}}}$$

                    \vspace{0.05cm}
                    {\footnotesize La tensione \textbf{sale} da 0 a $V_{finale}$, la corrente \textbf{scende} da $I_{max}$ a 0}
                }}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{
                    \textbf{SCARICA del condensatore}

                    \vspace{0.1cm}
                    Condensatore inizialmente carico a $V_0$, scaricato a 0:

                    $$\boxed{V_C(t) = V_0 \cdot e^{-\frac{t}{\tau}}}$$

                    $$\boxed{I_C(t) = -\frac{V_0}{R} \cdot e^{-\frac{t}{\tau}}}$$

                    \vspace{0.05cm}
                    {\footnotesize La tensione \textbf{scende} da $V_0$ a 0, corrente negativa (verso opposto)}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Carica a CORRENTE COSTANTE:}

                    \vspace{0.1cm}
                    Se il condensatore è caricato da una corrente costante $I$:

                    $$\boxed{V_C(t) = V_C(0) + \frac{I \cdot t}{C}}$$

                    oppure: $\boxed{\Delta V_C = \frac{I \cdot \Delta t}{C}}$

                    \vspace{0.05cm}
                    {\footnotesize (Usata per errore da $I_B$ nel S\&H!)}
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Valori notevoli:}

                    \vspace{0.05cm}
                    \begin{tabular}{|c|c|c|}
                        \hline
                        $t$ & Carica & Scarica \\
                        \hline
                        $\tau$ & $63.2\%$ di $V_f$ & $36.8\%$ di $V_0$ \\
                        \hline
                        $3\tau$ & $95\%$ di $V_f$ & $5\%$ di $V_0$ \\
                        \hline
                        $5\tau$ & $99.3\%$ di $V_f$ & $\approx 0$ \\
                        \hline
                    \end{tabular}

                    \vspace{0.1cm}
                    $\Rightarrow$ Dopo $5\tau$ si considera raggiunto il regime!
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Condensatore - Carica/Scarica RC};
    \end{tikzpicture}


    %------------ Box 4: Resistenze in parallelo ---------------
    \label{Box 4}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \textbf{Resistenze in parallelo:}

                \begin{enumerate}
                    \item \textbf{Caso con 2 resistenze:}
                          $$R_{eq} = \frac{R_1 \cdot R_2}{R_1 + R_2}$$

                    \item \textbf{Caso generale (n resistenze):}
                          $$\frac{1}{R_{eq}} = \sum_{i=1}^{n} \frac{1}{R_i}$$
                \end{enumerate}

                \vspace{0.3cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{
                        \textbf{\color{red}$\triangle$ NOTA IMPORTANTE - Tensioni di alimentazione}

                        Le tensioni fornite dalle alimentazioni sono le \textbf{massime e minime} possibili nel circuito.

                        \vspace{0.1cm}
                        \textbf{I NODI della rete NON possono mai avere tensioni:}
                        \begin{itemize}
                            \item Più alte di $V_{\text{max}}$ (alimentazione massima)
                            \item Più basse di $V_{\text{min}}$ (alimentazione minima)
                        \end{itemize}

                        \vspace{0.1cm}
                        \colorbox{yellow!50}{\parbox{0.9\linewidth}{\footnotesize
                                \textbf{ATTENZIONE:} Questo vale per le tensioni dei \textbf{NODI} (riferite a massa).

                                Le \textbf{cadute di tensione} (misurate tra due nodi diversi) \underline{possono} superare questi limiti!
                            }}

                        \vspace{0.1cm}
                        \textbf{Uso pratico:} Fondamentale quando si fanno ipotesi sullo stato dei diodi (ON/OFF). Se un'ipotesi porta un nodo oltre $V_{\text{max}}$ o sotto $V_{\text{min}}$, l'ipotesi è \textbf{sbagliata}.
                    }}

            \end{minipage}
        };
        %------------ Box 4 Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Resistenze e Alimentazioni};
    \end{tikzpicture}

    
    %------------ Box 3: Diodi ---------------
    \label{Box 3}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \textbf{1. Diodo normale:}

                \vspace{0.2cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.9]
                        % Diodo ON
                        \draw (0,2) to[D, v=$V_D$, color=green!70!black, line width=1.2pt] (2,2);
                        \node[anchor=south] at (1,2.2) {\color{green!70!black}\textbf{ON}};
                        \node[anchor=north] at (1,1.3) {$V_D > 0.7\text{V}$};
                        \node[anchor=north] at (1,0.8) {$\Rightarrow V_D = 0.7\text{V}$};

                        % Diodo OFF
                        \draw (3.5,2) to[D, v=$V_D$, color=gray, line width=1.2pt] (5.5,2);
                        \node[anchor=south] at (4.5,2.2) {\color{gray}\textbf{OFF}};
                        \node[anchor=north] at (4.5,1.3) {$V_D < 0.7\text{V}$};
                        \node[anchor=north] at (4.5,0.8) {$\Rightarrow$ aperto};
                    \end{circuitikz}
                \end{center}

                \vspace{0.3cm}
                \textbf{2. Diodo Zener:}

                \vspace{0.2cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.8]
                        % Conduzione diretta
                        \draw (0,2.5) to[zD, v=$V_D$, color=green!70!black, line width=1.2pt] (2,2.5);
                        \node[anchor=south] at (1,2.7) {\color{green!70!black}\textbf{Diretta}};
                        \node[anchor=north] at (1,1.8) {$V_D > 0.7\text{V}$};
                        \node[anchor=north] at (1,1.2) {$V_D = 0.7\text{V}$};

                        % Breakdown
                        \draw (3.5,2.5) to[zD, v=$V_D$, color=red!70!black, line width=1.2pt] (5.5,2.5);
                        \node[anchor=south] at (4.5,2.7) {\color{red!70!black}\textbf{Breakdown}};
                        \node[anchor=north] at (4.5,1.8) {$V_D < -V_Z$};
                        \node[anchor=north] at (4.5,1.2) {\color{red}$V_D = -V_Z$};
                    \end{circuitikz}
                \end{center}

                \colorbox{yellow!30}{\parbox{0.9\linewidth}{\small \textbf{ATTENZIONE:} In breakdown, la tensione $V_D = -V_Z$ ha polarità \textbf{\color{red}opposta} rispetto ai $+0.7\text{V}$ della conduzione diretta!}}

                \vspace{0.2cm}
                \textbf{3. Configurazioni in serie:}

                \begin{center}
                    \begin{circuitikz}[scale=0.7]
                        % Serie discordi
                        \draw (0,1.5) to[D] (1.5,1.5) to[D, invert] (3,1.5);
                        \node[anchor=south] at (1.5,1.7) {\small Discordi};
                        \node[anchor=north] at (1.5,1.0) {$\Rightarrow$ \textbf{APERTO}};

                        % Serie concordi
                        \draw (4,1.5) to[D] (5.5,1.5) to[D] (7,1.5);
                        \node[anchor=south] at (5.5,1.7) {\small Concordi};
                        \node[anchor=north] at (5.5,1.0) {$V_\gamma = \sum V_{\gamma,i}$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.2cm}
                \colorbox{cyan!20}{\parbox{0.9\linewidth}{\footnotesize
                        \textbf{$\bigstar$ TRUCCO PRATICO - Verifica stato diodo:}

                        Quando sei \textbf{in un intorno della soglia} ($V_D \approx 0.7V$, anche infinitesimamente superiore), le \textbf{correnti sono molto basse}.

                        $\Rightarrow$ Per verificare se il diodo si accende puoi \textbf{ignorare le resistenze in serie} (I $\approx$ 0 $\Rightarrow$ $\Delta V_R \approx$ 0).

                        \textbf{Uso nei transitori:} A fine esercizio, verifica che l'ipotesi sul diodo (ON/OFF) resti valida in:
                        \begin{itemize}[leftmargin=*, itemsep=0pt]
                            \item $\hat{T}^-$ (istante prima della transizione)
                            \item $\hat{T}^+$ (istante dopo della transizione)
                            \item $t \to \infty$ (regime)
                        \end{itemize}
                    }}

            \end{minipage}
        };
        %------------ Box 3 Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Diodi};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





    %------------ Box 5: Capacità - Formule fondamentali ---------------------
    \label{Box 5}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \textbf{1. Tensione del condensatore:}
                $$V_C(t) = V_C(0^+) + \left[V_C(\color{orange}\infty^*\color{black}) - V_C(0^+)\right] \left(1 - e^{-\frac{t}{\tau}}\right)$$
                \small
                $V_C(0^+)$: iniziale; $V_C(\color{orange}\infty^*\color{black})$: a regime; \colorbox{yellow!30}{$\color{orange}\infty^* \neq \infty$}

                \vspace{0.2cm}
                \textbf{2. Corrente:} $I_C(t) = C \frac{dV_C(t)}{dt}$

                \small \textbf{\color{blue}Proprietà:}
                La \textbf{\color{red}corrente} varia \textbf{\color{red}istantaneamente}; La \textbf{\color{green!50!black}tensione} NON commuta: $V_C(t_0^-) = V_C(t_0^+)$

                \vspace{0.25cm}
                \colorbox{Dandelion!40}{\parbox{0.95\linewidth}{\small
                        \textbf{$\bigstar$ REGOLA D'ORO - A REGIME}

                        \vspace{0.1cm}
                        A regime ($t \to \infty$): $\frac{dV_C}{dt} = 0$ $\Rightarrow$ $\boxed{I_C = 0}$

                        \textbf{Condensatore = CIRCUITO APERTO}

                        \vspace{0.15cm}
                        \colorbox{white}{\parbox{0.9\linewidth}{\small
                                \textbf{Per calcolare $V_C(\infty)$:}
                                \begin{enumerate}[itemsep=2pt]
                                    \item Sostituisci C con \textbf{circuito aperto}
                                    \item Risolvi il circuito semplificato
                                    \item Calcola la tensione nel punto dove c'era C
                                \end{enumerate}

                                \vspace{0.1cm}
                                \textbf{Es:} $V \xrightarrow{R_1} \bullet \xrightarrow{R_2} \text{GND}$ + C $\parallel$ $R_2$

                                $\Rightarrow$ $V_C(\infty) = V \frac{R_2}{R_1+R_2}$ (partitore)
                            }}
                    }}

                \vspace{0.2cm}
                \textbf{3. Ripple:} $\Delta V_{out} = V_{picco} \frac{\Delta T}{\tau} = V_{picco} \frac{T}{f \cdot \tau}$

                \vspace{0.2cm}
                \textbf{4. Comportamento fisico} \small ($Q = C \cdot V$; $I = C \frac{dV}{dt}$)

                \vspace{0.15cm}
                \colorbox{green!15}{\parbox{0.95\linewidth}{\small
                        \textbf{\color{green!50!black}CARICA} ($\frac{dV_C}{dt} > 0$): Corrente \textbf{ENTRA} ($I_C > 0$)

                        Il condensatore accumula energia; $V_C \uparrow$
                        \begin{center}
                            \begin{circuitikz}[scale=0.55]
                                \draw (0,0) to[C=$C$, v=$V_C$] (0,2.5);
                                \draw[->, thick, color=green!70!black, line width=1.5pt] (-0.9,1.2) -- (-0.15,1.2);
                                \node[anchor=east, color=green!70!black] at (-0.9,1.2) {\small $I_C > 0$};
                                \node[anchor=south] at (0,2.8) {\small Corrente ENTRA};
                            \end{circuitikz}
                        \end{center}
                    }}

                \vspace{0.15cm}
                \colorbox{red!15}{\parbox{0.95\linewidth}{\small
                        \textbf{\color{red!70!black}SCARICA} ($\frac{dV_C}{dt} < 0$): Corrente \textbf{ESCE} ($I_C < 0$)

                        Il condensatore rilascia energia; $V_C \downarrow$
                        \begin{center}
                            \begin{circuitikz}[scale=0.55]
                                \draw (0,0) to[C=$C$, v=$V_C$] (0,2.5);
                                \draw[->, thick, color=red!70!black, line width=1.5pt] (0.15,1.2) -- (0.9,1.2);
                                \node[anchor=west, color=red!70!black] at (0.9,1.2) {\small $I_C < 0$};
                                \node[anchor=south] at (0,2.8) {\small Corrente ESCE};
                            \end{circuitikz}
                        \end{center}
                    }}

                \vspace{0.1cm}
                \colorbox{yellow!20}{\parbox{0.95\linewidth}{\small
                        \textbf{Regola:} $V_C \uparrow$ $\Rightarrow$ CARICA; $V_C \downarrow$ $\Rightarrow$ SCARICA; segno $I_C$ indica verso
                    }}

            \end{minipage}
        };
        %------------ Box 5 Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Capacità: Formule e Comportamento};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




    %------------ Box 6: Transitori multipli ---------------
    \label{Box 6}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \textbf{Formula tempo centrale $\hat{T}$:}
                $$V_C(\hat{T}) = V_C(0^+)_{\hat{T}} + \left[V_C(\infty^*) - V_C(0^+)_{\hat{T}}\right] \left(1 - e^{-\frac{\hat{T}}{\tau}}\right)$$

                \vspace{0.2cm}
                \colorbox{Dandelion!30}{\parbox{0.95\linewidth}{\small
                        \textbf{Prassi: segnale rettangolare}

                        \underline{salita} $\to$ \underline{plateau} $\to$ \underline{discesa}
                    }}

                \vspace{0.25cm}
                \textbf{Procedimento step-by-step:}
                \begin{enumerate}[leftmargin=*, itemsep=3pt]
                    \item \textbf{\color{green!50!black}FASE 1 - Salita}
                          \begin{itemize}[itemsep=1pt]
                              \item Analizza $t = 0^-$ (condizioni iniziali)
                              \item $V_C(0^+)$ per continuità
                              \item Determina stato diodi
                              \item Calcola $V_C(\infty^*)$
                              \item Applica formula con $\tau$
                          \end{itemize}

                    \item \textbf{\color{orange}FASE 2 - Plateau}
                          \begin{itemize}[itemsep=1pt]
                              \item Se durata $\gg 5\tau$: regime
                              \item Se durata $< 5\tau$: calcola $V_C$ fine
                              \item Verifica diodi (Box 7)
                          \end{itemize}

                    \item \textbf{\color{red!70!black}FASE 3 - Discesa}
                          \begin{itemize}[itemsep=1pt]
                              \item $V_C(0^+) = V_C(\text{fine plateau})$
                              \item Ridetermina stato diodi
                              \item Nuovo $V_C(\infty^*)$
                              \item Applica formula
                          \end{itemize}
                \end{enumerate}

                \vspace{0.2cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.6]
                        % Segnale di ingresso
                        \draw[->] (0,0) -- (8,0) node[right] {$t$};
                        \draw[->] (0,0) -- (0,2.5) node[above] {$V_{in}$};
                        \draw[thick, green!50!black] (0,0) -- (0.5,0) -- (0.5,2) -- (3.5,2) -- (3.5,0) -- (8,0);
                        \node at (4,-0.8) {\small Ingresso (rettangolare)};

                        % Risposta Vc(t)
                        \draw[->] (0,-3.5) -- (8,-3.5) node[right] {$t$};
                        \draw[->] (0,-3.5) -- (0,-1) node[above] {$V_C$};
                        % Fase 1
                        \draw[thick, green!50!black, domain=0.5:3.5, samples=50] plot (\x, {-3.5 + 2*(1-exp(-(\x-0.5)))});
                        % Fase 2
                        \draw[thick, orange, domain=3.5:3.8, samples=20] plot (\x, {-1.5 - 0.05*(\x-3.5)});
                        % Fase 3
                        \draw[thick, red!70!black, domain=3.8:7, samples=50] plot (\x, {-1.52 - 1.7*(1-exp(-(\x-3.8)))});

                        \node[green!50!black] at (2,-4.2) {\small Fase 1};
                        \node[orange] at (3.65,-4.2) {\small F.2};
                        \node[red!70!black] at (5.5,-4.2) {\small Fase 3};

                        \draw[dashed] (0.5,0) -- (0.5,-3.5);
                        \draw[dashed] (3.5,0) -- (3.5,-3.5);
                        \node at (4,-4.8) {\small Risposta $V_C(t)$};
                    \end{tikzpicture}
                \end{center}

            \end{minipage}
        };
        %------------ Box 6 Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Transitori con gradini multipli};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





    %------------ Box 7: Verifica ipotesi diodi ---------------
    \label{Box 7}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \colorbox{red!20}{\parbox{0.95\linewidth}{\small
                        \textbf{\color{red}$\triangle$ VERIFICA FONDAMENTALE}

                        Verifica ipotesi diodo (ON/OFF) rimanga valida per tutto il transitorio
                    }}

                \vspace{0.2cm}
                \colorbox{cyan!15}{\parbox{0.95\linewidth}{\small
                        \textbf{\color{blue}FASE 0: Metodo intuitivo}

                        \textbf{Regola:} $I$ scorre da $V_{+}$ a $V_{-}$

                        1) $V_C(0^+)$ continuità
                        2) Trova $V_{\max}$
                        3) $I$ va da $V_{\max}$ a $V_{\min}$
                        4) Compatibile con diodo?
                        5) No $\Rightarrow$ cambia stato

                        \vspace{0.15cm}
                        \begin{center}
                            \begin{circuitikz}[scale=0.65]
                                \draw (0,0) node[ground]{} to[V, v=$V_{in}$] (0,2.5)
                                      to[D, l=$D$, color=red] (2.5,2.5)
                                      to[R, l=$R$] (5,2.5)
                                      to[C, l=$C$, v<=$V_C{=}5V$] (5,0) -- (0,0);
                                \node[anchor=south, color=blue] at (0,2.8) {\small $0V$};
                                \node[anchor=south, color=red!70!black] at (5,2.8) {\small \textbf{$5V$}};
                                \draw[->, very thick, color=orange, line width=1.2pt] (4.5,3.6) -- (0.5,3.6);
                                \node[anchor=south, color=orange] at (2.5,3.8) {\small $I$ (5V$\to$0V)};
                                \node[anchor=north, align=center] at (2.5,-0.5) {\small \textbf{Contraddizione!} $I$ va ← \\
                                \small ma D conduce solo → \\
                                \small $\Rightarrow$ \textbf{D OFF}};
                            \end{circuitikz}
                        \end{center}
                    }}

                \vspace{0.2cm}
                \begin{enumerate}[leftmargin=*, itemsep=2pt]
                    \item Ipotesi (es: D ON)
                    \item Risolvi (ON: gen 0.7V; OFF: aperto)
                    \item Calcola $V_C(t)$
                    \item Verifica $\forall t$:

                          \colorbox{green!10}{\parbox{0.9\linewidth}{\small
                                  \textbf{ON:} $I_D(t) > 0$? No $\to$ errore
                              }}

                          \colorbox{orange!10}{\parbox{0.9\linewidth}{\small
                                  \textbf{OFF:} $V_D(t) < 0.7$V? No $\to$ errore
                              }}

                    \item Se errore: dividi in 2 fasi ($t^*$ cambio), ricalcola
                \end{enumerate}

            \end{minipage}
        };
        %------------ Box 7 Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Verifica ipotesi stato diodi};
    \end{tikzpicture}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



    %------------ Box 8 ---------------
    \label{Box 8}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \textbf{NOTAZIONE ALIMENTAZIONI}

                \vspace{0.1cm}
                \colorbox{orange!30}{\parbox{0.95\linewidth}{\small
                        \textbf{REGOLA D'ORO:} Il \textbf{trattino} indica SEMPRE il \textbf{polo + del generatore}, sia con tensione positiva che negativa!
                    }}

                \vspace{0.2cm}
                \textbf{Caso 1: $V_{DD} = +1V$ (alimentazione positiva)}

                \begin{center}
                    {\color{black}
                    \begin{circuitikz}[scale=1.0]
                        % Simbolo alimentazione VDD
                        \draw[very thick] (0,0) to[short] (0,0.5);
                        \draw[ultra thick, line width=2pt] (-0.5,0.5) -- (0.5,0.5);
                        \node[anchor=south, font=\small\bfseries] at (0,0.6) {$V_{DD} = +1V$};

                        % Freccia indicazione
                        \draw[<-, ultra thick, color=red, line width=2pt] (-1.2,0.5) -- (-0.55,0.5);
                        \node[anchor=east, color=red, font=\scriptsize\bfseries, align=right] at (-1.25,0.5) {Trattino\\= polo \textbf{+}};

                        % Equivalente circuitale
                        \node[anchor=north, font=\footnotesize, align=center] at (0,-0.2) {Equivale a:};

                        \draw (2.5,-1) node[ground]{} to[V, v=$+1V$, invert] (2.5,0.5);
                        \node[anchor=west, font=\scriptsize] at (3,0.5) {\textbf{+} (polo +)};
                        \node[anchor=west, font=\scriptsize] at (3,-1) {\textbf{--} (GND)};
                    \end{circuitikz}
                    }
                \end{center}

                \vspace{0.05cm}
                {\footnotesize Tensione $+1V$ $\to$ polo + sul trattino, tutto normale}

                \vspace{0.2cm}
                \textbf{Caso 2: $V_{SS} = -1V$ (alimentazione negativa)}

                \begin{center}
                    {\color{black}
                    \begin{circuitikz}[scale=1.0]
                        % Simbolo alimentazione VSS
                        \draw[very thick] (0,0) to[short] (0,0.5);
                        \draw[ultra thick, line width=2pt] (-0.5,0.5) -- (0.5,0.5);
                        \node[anchor=south, font=\small\bfseries] at (0,0.6) {$V_{SS} = -1V$};

                        % Freccia indicazione
                        \draw[<-, ultra thick, color=blue, line width=2pt] (-1.2,0.5) -- (-0.55,0.5);
                        \node[anchor=east, color=blue, font=\scriptsize\bfseries, align=right] at (-1.25,0.5) {Trattino\\= polo \textbf{+}};

                        % Equivalente circuitale
                        \node[anchor=north, font=\footnotesize, align=center] at (0,-0.2) {Equivale a:};

                        \draw (2.5,-1) node[ground]{} to[V, v=$-1V$, invert] (2.5,0.5);
                        \node[anchor=west, font=\scriptsize] at (3,0.5) {\textbf{+} (polo +)};
                        \node[anchor=west, font=\scriptsize] at (3,-1) {\color{black}\textbf{--} (GND)};
                    \end{circuitikz}
                    }
                \end{center}

                \vspace{0.05cm}
                {\footnotesize Tensione $-1V$ $\to$ polo + è comunque sul trattino!}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                        \textbf{TRUCCO:} Con $V_{SS}=-1V$ puoi ridisegnare il generatore invertendo polarità E segno: diventa $+1V$ con polo + su GND. Utile per evitare tensioni negative nei calcoli.
                    }}

            \end{minipage}
        };
        %------------ Box 8 Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Notazione alimentazioni};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ Box: Onda Quadra Ideale ---------------
    \label{Box Onda Quadra}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \begin{itemize}
                    \item Transizioni \textbf{verticali istantanee} (tempo di salita/discesa = 0)
                    \item Due livelli costanti: $V_{HIGH}$ e $V_{LOW}$
                \end{itemize}


                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                        \textbf{DUTY CYCLE DEFAULT:} Se non specificato, un'onda quadra ha \textbf{duty cycle 50\%} (HIGH = LOW = $T/2$)
                    }}

                \begin{center}
                    \begin{tikzpicture}[scale=0.8]
                        % Assi
                        \draw[->] (-0.3,0) -- (5,0) node[right] {\small $t$};
                        \draw[->] (0,-0.3) -- (0,2.5) node[above] {\small $V$};

                        % Livelli di tensione
                        \draw[dashed, gray] (0,2) -- (4.5,2);
                        \draw[dashed, gray] (0,0.5) -- (4.5,0.5);
                        \node[anchor=east, font=\footnotesize] at (-0.1,2) {$V_{HIGH}$};
                        \node[anchor=east, font=\footnotesize] at (-0.1,0.5) {$V_{LOW}$};

                        % Onda quadra ideale - parte da zero (V_LOW), duty cycle 25%
                        \draw[very thick, blue] (0,0.5) -- (1,0.5) -- (1,2) -- (4,2) -- (4,0.5);

                        % Periodo T
                        \draw[<->, red, very thick] (0,-0.5) -- (4,-0.5);
                        \node[anchor=north, color=red, font=\small\bfseries] at (2,-0.5) {$T$ (periodo)};

                        % Duty cycle - tempo LOW (OFF)
                        \draw[<->, purple!70!black, thick] (0,-0.9) -- (1,-0.9);
                        \node[anchor=north, color=purple!70!black, font=\scriptsize] at (0.5,-0.9) {OFF};

                        % Duty cycle - tempo HIGH (ON)
                        \draw[<->, green!60!black, thick] (1,2.3) -- (4,2.3);
                        \node[anchor=south, color=green!60!black, font=\scriptsize] at (2.5,2.3) {ON (75\% di $T$)};

                        % Indicazioni transizioni verticali
                        \draw[->, orange, ultra thick] (2,1.2) -- (2.4,1.2);
                        \node[anchor=west, color=orange, font=\tiny, align=left] at (2.45,1.2) {Transizione\\istantanea};
                    \end{tikzpicture}
                \end{center}

                \colorbox{yellow!20}{\parbox{0.95\linewidth}{\small
                        \textbf{COME DISEGNARE A MANO:}
                        \begin{enumerate}
                            \item Segna i livelli $V_{HIGH}$ e $V_{LOW}$ con righe orizzontali
                            \item Scegli quanti quadretti = $T$ (es: 4 quadretti = 1 periodo)
                            \item Disegna righe verticali per le transizioni
                            \item Collega con righe orizzontali ai livelli
                        \end{enumerate}
                    }}

                \vspace{0.2cm}
                \colorbox{red!15}{\parbox{0.95\linewidth}{\small
                        \textbf{COME TROVARE IL PERIODO $T$:}

                        Il periodo è la distanza tra \textbf{due punti identici} del ciclo:
                        \begin{itemize}
                            \item Da LOW a LOW (stesso punto)
                            \item Da HIGH a HIGH (stesso punto)
                            \item Da salita a salita successiva
                            \item Da discesa a discesa successiva
                        \end{itemize}
                        \textbf{Trucco:} Scegli un punto qualsiasi e conta i quadretti fino a quando si ripete!
                    }}

                \vspace{0.2cm}
                \textbf{Esempio pratico (duty cycle 75\%):}
                \begin{itemize}
                    \item Se $T = 10\mu s$ e vuoi disegnare 2 periodi
                    \item Usa 4 quadretti per ogni periodo (tot. 8 quadretti)
                    \item Duty cycle 75\%: \textbf{1 quadretto LOW} (OFF), poi \textbf{3 quadretti HIGH} (ON)
                    \item Ripeti il pattern: 1 LOW, 3 HIGH per il 2° periodo
                \end{itemize}

            \end{minipage}
        };
        %------------ Box Onda Quadra Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Onda Quadra Ideale - Guida al Disegno};
    \end{tikzpicture}


    % Separa sezione MOSFET
    \newpage



    %%%%%%%%%%%%%

    %------------ Formazione del Canale nei MOSFET ---------------
    \label{Formazione del Canale nei MOSFET}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}



                \begin{enumerate}
                    \item \textbf{Zona OFF (o Cutoff):}
                          \begin{enumerate}
                              \item Non c'è formazione del canale.
                              \item Il dispositivo è spento e non permette il flusso di corrente tra drain e source.
                          \end{enumerate}

                    \item \textbf{Zona Ohmica (o Triodo):}
                          \begin{enumerate}
                              \item Si forma un canale.
                              \item Quando il gate è abbastanza polarizzato (cioè \( V_{GS} > V_{Tn} \) per nMOS o \( V_{GS} < V_{Tp} \) per pMOS), si forma un canale conduttivo tra il drain e il source.
                              \item Il dispositivo si comporta come un \textbf{resistore il cui valore varia in base alla tensione} \( V_{GS} \).
                          \end{enumerate}

                    \item \textbf{Zona di Saturazione (o Pinch-off):}
                          \begin{enumerate}
                              \item Si forma un canale.
                              \item Il canale diventa "strozzato" o "pinched-off" vicino al drain (per il nMOS) o vicino al source (per il pMOS).
                              \item Anche se la tensione \( V_{DS} \) aumenta ulteriormente, la corrente \( I_D \) rimane costante.
                              \item Questo comportamento è \textbf{analogo a quello di un generatore di corrente.}
                          \end{enumerate}
                \end{enumerate}



            \end{minipage}
        };
        %------------ Formazione del Canale nei MOSFET Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Formazione del Canale nei MOSFET};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ Box: Simboli e convenzioni nMOS/pMOS ---------------
    \label{Box Simboli MOSFET}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \vspace{0.3cm}
                \textbf{\color{blue}nMOS:}

                \begin{center}
                    \begin{circuitikz}[scale=2.0]
                        % nMOS symbol
                        \draw (0,0) node[nmos, anchor=G] (nmos) {};

                        % Labels terminali - vicine al simbolo
                        \node[anchor=east, font=\small] at ($(nmos.G)+(-0.1,0)$) {G};
                        \node[anchor=south, font=\small] at ($(nmos.D)+(0,0.001)$) {D};
                        \node[anchor=north, font=\small] at ($(nmos.S)+(0,-0.001)$) {S};

                        % Freccia VGS - a sinistra con concavità invertita
                        \draw[->, thick, color=red!70!black] ($(nmos.G)+(-0.2,-0.1)$) to[bend right=40] node[midway, left, font=\footnotesize] {$V_{GS}$} ($(nmos.S)+(-0.5,-0.15)$);

                        % Freccia VDS - a destra con concavità invertita
                        \draw[->, thick, color=blue!70!black] ($(nmos.D)+(0.5,-0.15)$) to[bend left=40] node[midway, right, font=\footnotesize] {$V_{DS}$} ($(nmos.S)+(0.3,-0.15)$);

                        % Freccia corrente - molto più a destra e accorciata
                        \draw[->, line width=2pt, color=green!60!black] ($(nmos.D)+(1.3,0.15)$) -- ($(nmos.S)+(1.3,-0.15)$);
                        \node[anchor=west, color=green!60!black, font=\small\bfseries] at ($(nmos.S)+(1.5,-0.05)$) {$I_D$};

                        % Freccia entrante sul terminale Source (che è in alto nel pMOS)
                        \draw[->, ultra thick, color=blue!70!black]  ($(nmos.S)+(-0.2,0.25)$) -- ($(nmos.S)+(0,0.25)$) ;
                    \end{circuitikz}
                \end{center}

                \vspace{0.1cm}
                \colorbox{green!15}{\parbox{0.95\linewidth}{\small
                    \textbf{nMOS:} Gate a sinistra, Drain in alto, Source in basso

                    \textbf{Corrente:} Da Drain $\to$ Source (verso il basso)
                }}

                \vspace{0.4cm}
                \textbf{\color{purple}pMOS:}

                \begin{center}
                    \begin{circuitikz}[scale=2.0]
                        % pMOS symbol (invertito)
                        \draw (0,0) node[pmos, anchor=G] (pmos) {};

                        % Labels terminali - vicine al simbolo
                        \node[anchor=east, font=\small] at ($(pmos.G)+(-0.25,0)$) {G};
                        \node[anchor=south, font=\small] at ($(pmos.D)+(0,0.65)$) {S};
                        \node[anchor=north, font=\small] at ($(pmos.S)+(0,-0.65)$) {D};

                        % Freccia VGS - a sinistra con concavità invertita rispetto a nMOS
                        \draw[->, thick, color=red!70!black] ($(pmos.G)+(-0.2,0.1)$) to[bend right=40] node[midway, left, font=\footnotesize] {$V_{GS}$} ($(pmos.D)+(-0.5,-0.15)$);

                        % Freccia VSD - a destra con concavità invertita rispetto a nMOS
                        \draw[->, thick, color=blue!70!black] ($(pmos.D)+(0.5,0.15)$) to[bend right=40] node[midway, right, font=\footnotesize] {$V_{SD}$} ($(pmos.S)+(0.3,0.15)$);

                        % Freccia corrente - molto più a destra e accorciata
                        \draw[->, line width=2pt, color=purple!70!black] ($(pmos.D)+(1.3,0.15)$) -- ($(pmos.S)+(1.3,-0.15)$);
                        \node[anchor=west, color=purple!70!black, font=\small\bfseries] at ($(pmos.S)+(1.5,-0.05)$) {$I_D$};

                        % Freccia entrante sul terminale Source (che è in alto nel pMOS)
                        \draw[->, ultra thick, color=red!70!black]  ($(pmos.S)+(0,-0.25)$) --  ($(pmos.S)+(-0.2,-0.25)$);
                    \end{circuitikz}
                \end{center}

                \vspace{0.1cm}
                \colorbox{purple!15}{\parbox{0.95\linewidth}{\small
                    \textbf{pMOS:} Gate a sinistra, Source in alto, Drain in basso

                    \textbf{Corrente:} Da Source $\to$ Drain (verso il basso)

                    \textbf{NOTA:} Nel pMOS il source è in alto (invertito rispetto a nMOS)!
                }}

            \end{minipage}
        };
        %------------ Box Simboli MOSFET Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Simboli e convenzioni nMOS/pMOS};
    \end{tikzpicture}



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ Box: Caratteristica I-V nMOS ---------------
    \label{Box Caratteristica nMOS}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}


                \begin{center}
                    \begin{tikzpicture}[scale=0.9]
                        % Assi
                        \draw[->] (0,0) -- (5.5,0) node[right] {$V_{DS}$};
                        \draw[->] (0,0) -- (0,4.2) node[above] {$I_D$};

                        % Curve caratteristiche per diversi VGS
                        % VGS1 (più basso)
                        \draw[thick, blue] (0,0) -- (0.5,0.8) .. controls (1,1) and (1.5,1.1) .. (5,1.1);
                        \node[anchor=west, blue, font=\tiny] at (5.1,1.1) {$V_{GS1}$};

                        % VGS2
                        \draw[thick, blue] (0,0) -- (1,1.6) .. controls (1.5,2) and (2,2.1) .. (5,2.1);
                        \node[anchor=west, blue, font=\tiny] at (5.1,2.1) {$V_{GS2}$};

                        % VGS3
                        \draw[thick, blue] (0,0) -- (1.5,2.4) .. controls (2,3) and (2.5,3.1) .. (5,3.1);
                        \node[anchor=west, blue, font=\tiny] at (5.1,3.1) {$V_{GS3}$};

                        % Zona INTERDIZIONE (OFF) - spostata più a sinistra
                        \fill[red!10, opacity=0.3] (-0.6,-0.3) rectangle (-0.1,4.3);
                        \node[rotate=90, font=\tiny\bfseries, red!70!black] at (-0.8,2.3) {INTERDIZIONE};
                        \node[rotate=90, font=\tiny, red!70!black] at (-0.35,1) {$V_{GS}<V_T$};

                        % Linea divisione triodo/saturazione
                        \draw[dashed, thick, orange!70!black] (0,0) -- (2.5,4.2);

                        % Punto di separazione sull'asse X con scritta sotto
                        \draw[orange!70!black, very thick] (1.5,-0.1) -- (1.5,0.1);
                        \node[anchor=north, orange!70!black, font=\tiny] at (1.5,-0.35) {$V_{DS}=V_{GS}-V_T$};

                        % Zona TRIODO (OMICA)
                        \node[font=\footnotesize\bfseries, cyan!70!black] at (0.8,2.8) {TRIODO};
                        \node[font=\tiny, cyan!70!black] at (0.8,2.4) {(OMICA)};

                        % Zona SATURAZIONE - spostata più in alto
                        \node[font=\footnotesize\bfseries, green!60!black] at (3.8,3.8) {SATURAZIONE};
                        \node[font=\tiny, green!60!black] at (3.8,3.5) {$V_{DS}>V_{GS}-V_T$};

                    \end{tikzpicture}
                \end{center}

                \vspace{0.2cm}
                \colorbox{yellow!20}{\parbox{0.95\linewidth}{\small
                    \textbf{Zone di funzionamento:}
                    \begin{itemize}[itemsep=1pt, leftmargin=*]
                        \item \textbf{\color{red!70!black}INTERDIZIONE}: $V_{GS} < V_T$ → $I_D = 0$
                        \item \textbf{\color{cyan!70!black}TRIODO}: $V_{GS} > V_T$ e $V_{DS} < (V_{GS}-V_T)$
                        \item \textbf{\color{green!60!black}SATURAZIONE}: $V_{GS} > V_T$ e $V_{DS} > (V_{GS}-V_T)$
                    \end{itemize}
                }}

            \end{minipage}
        };
        %------------ Box Caratteristica nMOS Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Caratteristica I-V nMOS};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ Box: Caratteristica I-V pMOS ---------------
    \label{Box Caratteristica pMOS}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}
                \begin{center}
                    \begin{tikzpicture}[scale=0.9]
                        % Assi
                        \draw[->] (0,0) -- (5.5,0) node[right] {$|V_{DS}|$};
                        \draw[->] (0,0) -- (0,4.2) node[above] {$I_D$};

                        % Curve caratteristiche per diversi VSG
                        % VSG1 (più basso)
                        \draw[thick, purple] (0,0) -- (0.5,0.8) .. controls (1,1) and (1.5,1.1) .. (5,1.1);
                        \node[anchor=west, purple, font=\tiny] at (5.1,1.1) {$V_{SG1}$};

                        % VSG2
                        \draw[thick, purple] (0,0) -- (1,1.6) .. controls (1.5,2) and (2,2.1) .. (5,2.1);
                        \node[anchor=west, purple, font=\tiny] at (5.1,2.1) {$V_{SG2}$};

                        % VSG3
                        \draw[thick, purple] (0,0) -- (1.5,2.4) .. controls (2,3) and (2.5,3.1) .. (5,3.1);
                        \node[anchor=west, purple, font=\tiny] at (5.1,3.1) {$V_{SG3}$};

                        % Zona INTERDIZIONE (OFF) - spostata più a sinistra
                        \fill[red!10, opacity=0.3] (-0.6,-0.3) rectangle (-0.1,4.3);
                        \node[rotate=90, font=\tiny\bfseries, red!70!black] at (-0.8,2.3) {INTERDIZIONE};
                        \node[rotate=90, font=\tiny, red!70!black] at (-0.35,0.8) {$V_{SG}<|V_T|$};

                        % Linea divisione triodo/saturazione
                        \draw[dashed, thick, orange!70!black] (0,0) -- (2.5,4.2);

                        % Punto di separazione sull'asse X con scritta sotto
                        \draw[orange!70!black, very thick] (1.5,-0.1) -- (1.5,0.1);
                        \node[anchor=north, orange!70!black, font=\tiny] at (1.5,-0.35) {$V_{SD}=V_{SG}-|V_T|$};

                        % Zona TRIODO (OMICA)
                        \node[font=\footnotesize\bfseries, cyan!70!black] at (0.8,2.8) {TRIODO};
                        \node[font=\tiny, cyan!70!black] at (0.8,2.4) {(OMICA)};

                        % Zona SATURAZIONE - spostata più in alto
                        \node[font=\footnotesize\bfseries, green!60!black] at (3.8,3.8) {SATURAZIONE};
                        \node[font=\tiny, green!60!black] at (3.8,3.5) {$V_{SD}>V_{SG}-|V_T|$};

                    \end{tikzpicture}
                \end{center}

                \vspace{0.2cm}
                \colorbox{yellow!20}{\parbox{0.95\linewidth}{\small
                    \textbf{Zone di funzionamento:}
                    \begin{itemize}[itemsep=1pt, leftmargin=*]
                        \item \textbf{\color{red!70!black}INTERDIZIONE}: $V_{SG} < |V_T|$ → $I_D = 0$
                        \item \textbf{\color{cyan!70!black}TRIODO}: $V_{SG} > |V_T|$ e $V_{SD} < (V_{SG}-|V_T|)$
                        \item \textbf{\color{green!60!black}SATURAZIONE}: $V_{SG} > |V_T|$ e $V_{SD} > (V_{SG}-|V_T|)$
                    \end{itemize}
                }}

            \end{minipage}
        };
        %------------ Box Caratteristica pMOS Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Caratteristica I-V pMOS};
    \end{tikzpicture}


    \newpage 



    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ Box: nMOS - Metodo operativo ---------------
    \label{Box nMOS}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}


                \vspace{0.2cm}
                \textbf{\color{blue}PRIMO CONTROLLO: $V_{GS}$ vs $V_{T}$}

                \begin{enumerate}[leftmargin=*, itemsep=3pt]
                    \item Se \colorbox{red!20}{$V_{GS} < V_T$} $\Rightarrow$ \textbf{MOSFET OFF}
                          \begin{itemize}
                              \item $I_D = 0$ (circuito aperto)
                              \item Non c'è conduzione
                          \end{itemize}

                    \item Se \colorbox{green!20}{$V_{GS} > V_T$} $\Rightarrow$ \textbf{MOSFET ON}
                          \begin{itemize}
                              \item Proseguire al \textbf{SECONDO CONTROLLO}
                          \end{itemize}
                \end{enumerate}

                \vspace{0.2cm}
                \textbf{\color{blue}SECONDO CONTROLLO (solo se ON): $V_{DS}$ vs $(V_{GS} - V_T)$}

                \vspace{0.1cm}
                \colorbox{yellow!20}{\parbox{0.95\linewidth}{
                    \textbf{Tensione di Overdrive:}
                    $$V_{OV} = V_{GS} - V_T$$
                }}

                \vspace{0.15cm}
                \begin{enumerate}[leftmargin=*, itemsep=3pt]
                    \item \textbf{\color{orange}ZONA DI SATURAZIONE}: Se $V_{DS} > (V_{GS} - V_T)$

                          \colorbox{orange!15}{\parbox{0.93\linewidth}{
                              $$I_D = K_n(V_{GS} - V_T)^2$$

                              \vspace{0.1cm}
                              \textbf{Nota:} La corrente dipende \textbf{SOLO da $V_{GS}$}
                          }}

                    \item \textbf{\color{cyan!70!black}ZONA OHMICA (Triodo)}: Se $V_{DS} < (V_{GS} - V_T)$

                          \colorbox{cyan!15}{\parbox{0.93\linewidth}{
                              $$I_D = K_n\left[2(V_{GS} - V_T)V_{DS} - V_{DS}^2\right]$$

                              \vspace{0.1cm}
                              \textbf{Nota:} La corrente dipende da \textbf{$V_{GS}$ E $V_{DS}$}
                          }}

                          \vspace{0.15cm}
                          \colorbox{cyan!10}{\parbox{0.93\linewidth}{\small
                              \textbf{Formula alternativa:}
                              $$I_D = \frac{1}{2} K_n V_{OV} \left(V_{DS} - \frac{V_{DS}^2}{2}\right)$$
                          }}
                \end{enumerate}

                \small \textbf{Direzione corrente:} In nMOS, $I_D$ scorre da \textbf{Drain $\to$ Source}

            \end{minipage}
        };
        %------------ Box nMOS Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}nMOS - Metodo operativo};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ Box: pMOS - Metodo operativo ---------------
    \label{Box pMOS}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}



                \vspace{0.2cm}
                \textbf{\color{blue}PROCEDIMENTO OPERATIVO PER pMOS}

                \vspace{0.15cm}
                \colorbox{red!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ STEP 0 - CONTROLLO POLARITÀ}

                    \vspace{0.05cm}
                    \textbf{Prima di tutto}, verifica che:
                    $$V_S > V_G$$

                    \vspace{0.05cm}
                    Se $V_S \leq V_G$ → \textbf{pMOS OFF} (anche se $|V_{GS}| \geq |V_T|$!)

                    \vspace{0.05cm}
                    \textbf{Motivo:} Il modulo $|V_{GS}|$ nasconde il segno! Potresti avere $|V_{GS}| \geq |V_T|$ ma con polarità sbagliata (es. $V_{GS} > 0$), e il pMOS sarebbe OFF.
                }}

                \vspace{0.2cm}
                \textbf{\color{blue}Step 1: Calcolare $|V_{GS}|$}

                \vspace{0.05cm}
                (solo se hai verificato $V_S > V_G$)

                \vspace{0.15cm}
                \textbf{\color{blue}Step 2: PRIMO CONTROLLO - $|V_{GS}|$ vs $|V_T|$}

                \begin{enumerate}[leftmargin=*, itemsep=3pt]
                    \item Se \colorbox{red!20}{$|V_{GS}| < |V_T|$} $\Rightarrow$ \textbf{MOSFET OFF}
                          \begin{itemize}
                              \item $I_D = 0$ (circuito aperto)
                              \item Non c'è conduzione
                          \end{itemize}

                    \item Se \colorbox{green!20}{$|V_{GS}| > |V_T|$} $\Rightarrow$ \textbf{MOSFET ON}
                          \begin{itemize}
                              \item Calcolare $V_{OV} = |V_{GS}| - |V_T|$
                              \item Proseguire allo \textbf{Step 3}
                          \end{itemize}
                \end{enumerate}

                \vspace{0.2cm}
                \textbf{\color{blue}Step 3: SECONDO CONTROLLO - $|V_{DS}|$ vs $V_{OV}$}

                \vspace{0.1cm}
                \colorbox{yellow!20}{\parbox{0.95\linewidth}{
                    \textbf{Tensione di Overdrive:}
                    $$V_{OV} = |V_{GS}| - |V_T|$$
                }}

                \vspace{0.15cm}
                \begin{enumerate}[leftmargin=*, itemsep=3pt]
                    \item \textbf{\color{orange}ZONA DI SATURAZIONE}: Se $|V_{DS}| > V_{OV}$

                          \colorbox{orange!15}{\parbox{0.93\linewidth}{
                              $$I_D = K_p \cdot V_{OV}^2 = K_p(|V_{GS}| - |V_T|)^2$$

                              \vspace{0.1cm}
                              \textbf{Nota:} La corrente dipende \textbf{SOLO dall'overdrive}
                          }}

                    \item \textbf{\color{cyan!70!black}ZONA OHMICA (Triodo)}: Se $|V_{DS}| < V_{OV}$

                          \colorbox{cyan!15}{\parbox{0.93\linewidth}{
                              $$I_D = K_p\left[2 V_{OV} \cdot |V_{DS}| - |V_{DS}|^2\right]$$

                              \vspace{0.05cm}
                              {\footnotesize dove $V_{OV} = |V_{GS}| - |V_T|$}

                              \vspace{0.1cm}
                              \textbf{Nota:} La corrente dipende da \textbf{$V_{OV}$ E $|V_{DS}|$}
                          }}
                \end{enumerate}

                \vspace{0.2cm}
                \small \textbf{Direzione corrente:} In pMOS, $I_D$ scorre da \textbf{Source $\to$ Drain}

            \end{minipage}
        };
        %------------ Box pMOS Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}pMOS - Metodo operativo};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


    %------------ Box: Riepilogo nMOS vs pMOS ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{\color{purple}Grandezze da calcolare per determinare lo stato:}

                \vspace{0.2cm}

                \begin{tabular}{|c|c|}
                    \hline
                    \rowcolor{green!15}
                    \textbf{nMOS} & \textbf{pMOS} \\
                    \hline
                    $V_{GS}$ & $|V_{GS}|$ \\
                    \hline
                    $V_T$ & $|V_T|$ \\
                    \hline
                    $V_{OV} = V_{GS} - V_T$ & $V_{OV} = |V_{GS}| - |V_T|$ \\
                    \hline
                    $V_{DS}$ & $|V_{DS}|$ \\
                    \hline
                \end{tabular}

                \vspace{0.2cm}
                \colorbox{cyan!10}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Controlli identici:}
                    \begin{enumerate}[itemsep=1pt, leftmargin=*]
                        \item Se $V_{GS}$ (o $|V_{GS}|$) $<$ $V_T$ (o $|V_T|$) $\Rightarrow$ OFF
                        \item Se ON: confronta $V_{DS}$ (o $|V_{DS}|$) con $V_{OV}$
                    \end{enumerate}

                    \vspace{0.05cm}
                    La \textbf{procedura è identica}, solo che per pMOS si usano i \textbf{valori assoluti}.
                }}

            \end{minipage}
        };
        %------------ Box Riepilogo Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Riepilogo: nMOS vs pMOS};
    \end{tikzpicture}

    \columnbreak

    %------------ MOSFET simmetrici - Source e Drain a runtime ---------------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ MOSFET SIMMETRICI}

                    \vspace{0.05cm}
                    I MOSFET sono dispositivi \textbf{simmetrici}: Source e Drain \textbf{NON sono fissi} ma vengono determinati dalle \textbf{tensioni a runtime}!
                }}

                \vspace{0.15cm}
                \textbf{\underline{Come identificare i terminali negli esercizi:}}

                \vspace{0.1cm}
                \textbf{GATE} (sempre indicato):

                • \textbf{nMOS}: gate \textbf{senza pallino}

                • \textbf{pMOS}: gate \textbf{con pallino} (\textbullet)

                \vspace{0.15cm}
                \textbf{SOURCE e DRAIN} (determinati a runtime): Se non indicati esplicitamente nel testo, si determinano in base alle \textbf{tensioni dei nodi}.

                \vspace{0.15cm}
                \textbf{\underline{Regole per determinare SOURCE:}}

                \vspace{0.1cm}
                \textbf{1. nMOS}

                \vspace{0.05cm}
                Il \textbf{SOURCE} è il nodo alla \textbf{tensione più BASSA} tra i due terminali non-gate.

                \vspace{0.05cm}
                Il DRAIN è l'altro terminale (tensione più alta).

                \vspace{0.15cm}
                \textbf{2. pMOS}

                \vspace{0.05cm}
                Il \textbf{SOURCE} è il nodo alla \textbf{tensione più ALTA} tra i due terminali non-gate.

                \vspace{0.05cm}
                Il DRAIN è l'altro terminale (tensione più bassa).

                \vspace{0.2cm}
                \hrule
                \vspace{0.15cm}

                \colorbox{red!15}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ ATTENZIONE - Riassegnazione a RUNTIME}

                    \vspace{0.05cm}
                    Durante l'esercizio, le tensioni ai nodi possono \textbf{cambiare}!

                    \vspace{0.05cm}
                    $\Rightarrow$ Source e Drain possono essere \textbf{riassegnati} in base alle nuove tensioni.

                    \vspace{0.05cm}
                    Devi \textbf{verificare quale nodo ha la tensione più alta/bassa} in ogni fase dell'analisi!
                }}

                \vspace{0.15cm}
                \textbf{Esempio pratico (nMOS):}

                Inizialmente: Nodo A = 3V, Nodo B = 1V $\Rightarrow$ Source = B (1V, più basso), Drain = A (3V)

                Dopo un transitorio: Nodo A = 0.5V, Nodo B = 2V $\Rightarrow$ Source = A (0.5V, più basso), Drain = B (2V)

                I terminali sono stati \textbf{invertiti}!

                \vspace{0.15cm}
                \textit{Perché è importante:} $V_{GS}$ e $V_{DS}$ dipendono da quale terminale è il Source. Per calcolare correttamente le formule, devi identificare Source e Drain correttamente in ogni momento. La zona di funzionamento (saturazione/omica) dipende da $V_{DS}$, quindi dall'identificazione corretta dei terminali.

            \end{minipage}
        };
        %------------ MOSFET simmetrici Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}MOSFET simmetrici - Source e Drain a runtime};
    \end{tikzpicture}

    \columnbreak

    %------------ Regola pratica ON/OFF veloce ---------------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \colorbox{yellow!50}{\parbox{0.95\linewidth}{
                    \centering
                    \textbf{REGOLA PRATICA VELOCE:}

                    \vspace{0.1cm}
                    \textbf{Come capire subito se un MOSFET è probabilmente ON o OFF?}
                }}

                \vspace{0.2cm}
                \textbf{\underline{nMOS:}}

                \vspace{0.1cm}
                \textbf{Gate a GND (0V)} → probabilmente \textbf{OFF}

                Se il gate è a massa, $V_{GS}$ è molto basso (o negativo se source è più alto), quindi $V_{GS} < V_T$ → OFF

                \vspace{0.1cm}
                \textbf{Gate a $V_{DD}$} → probabilmente \textbf{ON}

                Se il gate è all'alimentazione, $V_{GS}$ è alto (assumendo source a GND o comunque più basso), quindi $V_{GS} > V_T$ → ON

                \vspace{0.2cm}
                \hrule
                \vspace{0.15cm}

                \textbf{\underline{pMOS:}}

                \vspace{0.1cm}
                \textbf{Gate a GND (0V)} → probabilmente \textbf{ON}

                Se il gate è a massa, $V_{SG}$ è alto (assumendo source a $V_{DD}$ o comunque più alto), quindi $V_{SG} > |V_T|$ → ON

                \vspace{0.1cm}
                \textbf{Gate a $V_{DD}$} → probabilmente \textbf{OFF}

                Se il gate è all'alimentazione, $V_{SG}$ è molto basso (o negativo se source è più basso), quindi $V_{SG} < |V_T|$ → OFF

                \vspace{0.2cm}
                \hrule
                \vspace{0.15cm}

                \vspace{0.15cm}
                \textbf{Riassunto veloce:}

                \vspace{0.05cm}
                \centering
                \begin{tabular}{ccc}
                    & \textbf{Gate = GND} & \textbf{Gate = $V_{DD}$} \\
                    \hline
                    \textbf{nMOS} & OFF & ON \\
                    \textbf{pMOS} & ON & OFF \\
                \end{tabular}

                \vspace{0.2cm}
                \raggedright
                \textbf{ATTENZIONE:} Questa è una regola \textbf{approssimata} che assume:

                • Per nMOS: source vicino a GND

                • Per pMOS: source vicino a $V_{DD}$

                \vspace{0.03cm}
                Se il source è collegato diversamente (es. nMOS con source a $V_{DD}$, pMOS con source a GND), la regola \textbf{NON vale}! Devi sempre calcolare $V_{GS}$ o $V_{SG}$ correttamente.

            \end{minipage}
        };
        %------------ Regola pratica Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Regola pratica - MOSFET ON/OFF veloce};
    \end{tikzpicture}


    %------------ Overdrive e Parametro K ---------------------
    \label{Overdrive}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                $$K = \frac{1}{2} \mu \cdot C_{OX} \cdot \frac{W}{L}$$

                \noindent Dove:
                \begin{itemize}[itemsep=1pt, leftmargin=*]
                    \item $\mu$ = mobilità dei portatori nel canale
                    \item $C_{OX}$ = capacità specifica dell'ossido
                    \item $W/L$ = dimensioni fisiche del MOSFET \\
                          (Width/Length)
                \end{itemize}

                \vspace{0.2cm}
                \colorbox{orange!20}{\parbox{0.95\linewidth}{\small
                    \textbf{\color{red}$\triangle$ NOTA IMPORTANTE - Fattore 1/2}

                    \vspace{0.1cm}
                    K può essere definito \textbf{SENZA} il fattore $\frac{1}{2}$ al suo interno.

                    In tal caso, le formule delle correnti devono essere \textbf{riadattate}:

                    \vspace{0.1cm}
                    \begin{itemize}[itemsep=2pt]
                        \item \textbf{Saturazione:} \\
                              $I = \frac{K}{2}(V_{GS}-V_T)^2$ invece di $I = K(V_{GS}-V_T)^2$

                        \item \textbf{Omica:} \\
                              $I = K\left[(V_{GS}-V_T)V_{DS} - \frac{V_{DS}^2}{2}\right]$ \\
                              invece di $I = K\left[2(V_{GS}-V_T)V_{DS} - V_{DS}^2\right]$
                    \end{itemize}
                }}

            \end{minipage}
        };
        %------------ Overdrive Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Parametro K (Transconduttanza)};
    \end{tikzpicture}


    %------------ MOSFET in parallelo ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small


                \vspace{0.1cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ CONDIZIONE FONDAMENTALE:}

                    Tutti i \textbf{GATE devono essere in COMUNE} (stessa tensione al gate)
                }}

                \vspace{0.15cm}
                \textbf{\underline{1. MOSFET in PARALLELO}}

                \vspace{0.1cm}
                • GATE in comune

                • SOURCE in comune (vengono mantenuti)

                \vspace{0.1cm}
                \textbf{\color{purple}Formula:}
                $$K_{eq} = K_1 + K_2 + \cdots + K_n$$

                Se tutte uguali: $K_{eq} = n \cdot K$

                \vspace{0.1cm}
                \textit{Es:} 3 nMOS con $K = 0.5$ mA/V² → $K_{eq} = 1.5$ mA/V²

                \vspace{0.15cm}
                \hrule
                \vspace{0.15cm}

                \textbf{\underline{2. MOSFET in SERIE}}

                \vspace{0.1cm}
                • GATE in comune

                • SOURCE equivalente = SOURCE più BASSO

                \vspace{0.1cm}
                \textbf{\color{purple}Formula:}
                $$\frac{1}{K_{eq}} = \frac{1}{K_1} + \frac{1}{K_2} + \cdots + \frac{1}{K_n}$$

                Per 2 MOS: $K_{eq} = \frac{K_1 \cdot K_2}{K_1 + K_2}$

                \vspace{0.03cm}
                Se uguali: $K_{eq} = \frac{K}{n}$

                \vspace{0.1cm}
                \textit{Es:} 2 nMOS $K_1=1$, $K_2=2$ mA/V² → $K_{eq}=0.67$ mA/V²

                \vspace{0.1cm}
                \textit{Nota:} Queste semplificazioni evitano calcoli complessi nei circuiti.

            \end{minipage}
        };
        %------------ Semplificazioni MOSFET Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Semplificazioni MOSFET};
    \end{tikzpicture}


    %------------ Analisi Porte Logiche ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Quando usare:} Dopo aver fatto semplificazioni (serie/parallelo), quando $V_{DS} = V_{OUT}$ e devi capire la zona di funzionamento.
                }}

                \vspace{0.15cm}
                \textbf{IPOTESI:} Se ti hanno chiesto l'espressione logica della porta, puoi ipotizzare che sia \textbf{ideale}:

                \vspace{0.05cm}
                • $V_{OUT}$ ha valori logici \textbf{ALTO} e \textbf{BASSO}

                • $V_{OUT} = V_{DS}$ del MOSFET (dopo semplificazioni)

                \vspace{0.15cm}
                \textbf{\underline{METODO:}}

                \vspace{0.1cm}
                \textbf{1. Uscita logica BASSA (``0'')}

                \vspace{0.05cm}
                $V_{OUT} \approx 0V$ → $V_{DS}$ piccola → $V_{DS} < V_{OV}$ → \textbf{ZONA OMICA}

                \vspace{0.15cm}
                \textbf{2. Uscita logica ALTA (``1'')}

                \vspace{0.05cm}
                $V_{OUT} \approx V_{DD}$ → $V_{DS}$ grande → $V_{DS} > V_{OV}$ → \textbf{ZONA SATURAZIONE}

                \vspace{0.15cm}
                \textit{Nota:} Questo metodo ti permette di \textbf{ipotizzare} la zona di funzionamento senza fare calcoli complessi. Poi puoi verificare con le formule.

                \vspace{0.1cm}
                \textbf{Esempio pratico:}

                Se $V_{OUT} = 0V$ (logica bassa) e hai $V_{OV} = 2V$:

                $V_{DS} \approx 0V < 2V$ → OMICA $\checkmark$

                \vspace{0.03cm}
                Se $V_{OUT} = 5V$ (logica alta) e hai $V_{OV} = 2V$:

                $V_{DS} \approx 5V > 2V$ → SATURAZIONE $\checkmark$

            \end{minipage}
        };
        %------------ Analisi Porte Logiche Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Analisi Porte Logiche};
    \end{tikzpicture}


    %------------ Resistenza di canale ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{\color{blue}Resistenza di Canale ($R_{CH}$ o $R_{eq}$)}

                \vspace{0.15cm}
                \textbf{Quando usare:} Calcolare la corrente nel MOSFET quando:

                • $V_{OUT} = V_{DS}$ (l'uscita coincide con la tensione drain-source)

                • $V_{OUT} \approx 0V$ (uscita logica bassa)

                \vspace{0.15cm}
                La \textbf{resistenza di canale} è la resistenza equivalente del MOSFET in un \textbf{intorno di $V_{DS} = 0V$}

                \vspace{0.15cm}
                \textbf{\underline{FORMULA:}}

                \vspace{0.1cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    $$R_{CH} = R_{eq} = \frac{1}{2K \cdot V_{OV}}$$

                    \vspace{0.05cm}
                    \centering
                    dove $V_{OV} = V_{GS} - V_T$
                }}

                \vspace{0.15cm}
                \textit{Nota:} $K$ può essere il $K$ del singolo MOSFET o il $K_{eq}$ del MOSFET equivalente (dopo semplificazioni serie/parallelo)

                \vspace{0.15cm}
                \textit{Origine:} Derivata di $I_D$ rispetto a $V_{DS}$ calcolata in $V_{DS}=0$ (approssimazione di Taylor al primo ordine)

                \vspace{0.15cm}
                \textbf{\underline{QUANDO È VALIDA:}}

                \vspace{0.05cm}
                $\checkmark$ $V_{DS} \approx 0V$ (uscita logica bassa)

                $\checkmark$ MOSFET in zona OMICA

                $\checkmark$ Calcoli approssimativi di corrente

                \vspace{0.1cm}
                $\times$ Se $V_{DS}$ NON è vicino a 0V

                $\times$ In altri punti di lavoro (devi ricalcolare la derivata nel punto specifico)

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ SANITY CHECK}

                    Dopo aver calcolato $I_D$ usando $R_{CH}$, \textbf{DEVI verificare}:

                    $$V_{R_{CH}} \ll V_{OV}$$

                    Dove $V_{R_{CH}}$ è la tensione ai capi della resistenza equivalente (= $V_{DS}$ del MOSFET).

                    \vspace{0.05cm}
                    Se $V_{R_{CH}} \approx V_{OV}$ o maggiore, l'approssimazione \textbf{NON è valida}!
                }}

                \vspace{0.15cm}
                \textbf{Esempio pratico:}

                Se $K = 1$ mA/V², $V_{GS} = 3V$, $V_T = 1V$:

                $V_{OV} = 3V - 1V = 2V$

                $R_{CH} = \frac{1}{2 \cdot 1 \cdot 2} = \frac{1}{4}$ k$\Omega$ = 250 $\Omega$

                \vspace{0.05cm}
                Con $V_{DS} = 0.1V$:

                $I_D \approx \frac{V_{DS}}{R_{CH}} = \frac{0.1V}{250\Omega} = 0.4$ mA

                \vspace{0.05cm}
                \textbf{Verifica:} $V_{DS} = 0.1V \ll V_{OV} = 2V$ $\checkmark$ OK!

            \end{minipage}
        };
        %------------ Resistenza di canale Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Resistenza di canale};
    \end{tikzpicture}


    %------------ Carica condensatore con MOSFET ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \textbf{Scenario:} MOSFET utilizzato per caricare un condensatore (es. in porte logiche, circuiti di trasferimento carica)

                \vspace{0.15cm}
                \textbf{Nota importante:} La tensione massima/minima raggiungibile sul condensatore dipende dal \textbf{tipo di MOSFET}!

                \vspace{0.2cm}
                \colorbox{yellow!50}{\parbox{0.95\linewidth}{
                    \centering
                    \textbf{REGOLA MNEMONICA:}

                    \vspace{0.1cm}
                    \textbf{Gli nMOS NON sono bravi a CARICARE}

                    \textbf{I pMOS NON sono bravi a SCARICARE}
                }}

                \vspace{0.15cm}
                \textbf{\underline{CARICA - 1. Con pMOS}}

                \vspace{0.1cm}
                \textbf{Carica COMPLETA:} Il condensatore si carica fino a \textbf{$V_{DD}$}

                \vspace{0.05cm}
                $$V_{C,max} = V_{DD}$$

                \vspace{0.05cm}
                \textit{Motivo:} Nel pMOS, la corrente scorre da Source (alto) → Drain (basso). Il pMOS può rimanere acceso fino a quando il condensatore raggiunge $V_{DD}$, perché il Source è collegato a $V_{DD}$ e mantiene sempre $V_{SG} > |V_T|$.

                \vspace{0.15cm}
                \hrule
                \vspace{0.15cm}

                \textbf{\underline{CARICA - 2. Con nMOS}}

                \vspace{0.1cm}
                \textbf{Carica LIMITATA:} Il condensatore si carica \textbf{solo fino a}:

                \vspace{0.05cm}
                $$V_{C,max} = V_G - V_T$$

                \vspace{0.05cm}
                \textit{Motivo:} Nel nMOS, quando il condensatore (collegato al Drain) si carica, aumenta $V_D$. Quando $V_D$ raggiunge $V_G - V_T$, si ha $V_{GS} = V_{G} - V_{S} = V_{G} - (V_G - V_T) = V_T$ → il MOSFET \textbf{si spegne} (entra in interdizione). \textbf{Non può caricare oltre} perché $V_{GS} = V_T$ è la condizione di soglia (OFF).

                \vspace{0.15cm}
                \textbf{Esempio pratico (CARICA):}

                Se $V_G = 5V$ e $V_T = 1V$ per un nMOS:

                $V_{C,max} = 5V - 1V = 4V$ (non $5V$!)

                \vspace{0.05cm}
                Con pMOS invece: $V_{C,max} = V_{DD}$ (carica completa)

            \end{minipage}
        };
        %------------ Carica condensatore Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Carica di un condensatore con MOSFET};
    \end{tikzpicture}


    %------------ Scarica condensatore con MOSFET ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \textbf{Comportamento SPECULARE alla carica}

                \vspace{0.15cm}
                \textbf{\underline{SCARICA - 1. Con nMOS}}

                \vspace{0.1cm}
                \textbf{Scarica COMPLETA:} Il condensatore si scarica fino a \textbf{GND (0V)}

                \vspace{0.05cm}
                $$V_{C,min} = 0V$$

                \vspace{0.05cm}
                \textit{Motivo:} Nel nMOS, il Source è collegato a GND e la corrente scorre dal condensatore (Drain) verso GND. Il nMOS rimane acceso finché $V_{GS} > V_T$. Dato che $V_S = 0V$ (GND), finché $V_G > V_T$ il transistor resta acceso e può scaricare completamente il condensatore.

                \vspace{0.15cm}
                \hrule
                \vspace{0.15cm}

                \textbf{\underline{SCARICA - 2. Con pMOS}}

                \vspace{0.1cm}
                \textbf{Scarica LIMITATA:} Il condensatore si scarica \textbf{solo fino a}:

                \vspace{0.05cm}
                $$V_{C,min} = V_G + |V_T|$$

                \vspace{0.05cm}
                \textit{Motivo:} Nel pMOS, quando il condensatore (collegato al Source) si scarica, diminuisce $V_S$. Quando $V_S$ scende fino a $V_G + |V_T|$, si ha $V_{SG} = |V_T|$ → il MOSFET \textbf{si spegne}. \textbf{Non può scaricare oltre} perché $V_{SG} = |V_T|$ è la condizione di soglia (OFF).

                \vspace{0.15cm}
                \textbf{Esempio pratico (SCARICA):}

                Se $V_G = 2V$ e $|V_T| = 1V$ per un pMOS:

                $V_{C,min} = 2V + 1V = 3V$ (non può scendere sotto!)

                \vspace{0.05cm}
                Con nMOS invece: $V_{C,min} = 0V$ (scarica completa)

                \vspace{0.2cm}
                \hrule
                \vspace{0.15cm}

                \colorbox{red!15}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\triangle$ CONSEGUENZA PRATICA - Simmetria CARICA/SCARICA}

                    \vspace{0.05cm}
                    \textbf{CARICA:} pMOS completa ($\to V_{DD}$), nMOS limitata ($\to V_G - V_T$)

                    \textbf{SCARICA:} nMOS completa ($\to$ GND), pMOS limitata ($\to V_G + |V_T|$)

                    \vspace{0.05cm}
                    Nelle porte logiche cMOS:

                    • \textbf{pMOS} nella rete \textbf{pull-up} (PUN) → porta uscita a $V_{DD}$

                    • \textbf{nMOS} nella rete \textbf{pull-down} (PDN) → porta uscita a GND
                }}

            \end{minipage}
        };
        %------------ Scarica condensatore Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Scarica di un condensatore con MOSFET};
    \end{tikzpicture}


    %------------ Valutazione logica PTL ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \textbf{Scenario:} Circuiti con un solo MOSFET + condensatore (non completamente cMOS)

                \vspace{0.15cm}
                \colorbox{orange!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ SOGLIA LOGICA: $\frac{V_{DD}}{2}$}

                    \vspace{0.05cm}
                    Per la \textbf{tabella di verità}, l'uscita è considerata:

                    • \textbf{HIGH} se $V_{OUT} > \frac{V_{DD}}{2}$

                    • \textbf{LOW} se $V_{OUT} < \frac{V_{DD}}{2}$
                }}

                \vspace{0.2cm}
                \textbf{\underline{Caso 1: nMOS sulla pull-up + condensatore}}

                \vspace{0.1cm}
                \textbf{Problema:} nMOS carica solo fino a $V_{C,max} = V_G - V_T$

                \vspace{0.05cm}
                \textbf{Valutazione logica:}

                Se $V_G - V_T > \frac{V_{DD}}{2}$ → Uscita = \textbf{HIGH} (logicamente ``1'')

                Se $V_G - V_T < \frac{V_{DD}}{2}$ → Uscita = \textbf{LOW} (logicamente ``0'')

                \vspace{0.1cm}
                \textbf{Esempio:} $V_{DD} = 5V$, $V_G = 4V$, $V_T = 1V$

                $V_{C,max} = 4V - 1V = 3V$

                $\frac{V_{DD}}{2} = 2.5V$

                $3V > 2.5V$ → Uscita = \textbf{HIGH} (anche se non raggiunge $V_{DD}$!)

                \vspace{0.15cm}
                \hrule
                \vspace{0.15cm}

                \textbf{\underline{Caso 2: pMOS sulla pull-down + condensatore}}

                \vspace{0.1cm}
                \textbf{Problema:} pMOS scarica solo fino a $V_{C,min} = V_G + |V_T|$

                \vspace{0.05cm}
                \textbf{Valutazione logica:}

                Se $V_G + |V_T| < \frac{V_{DD}}{2}$ → Uscita = \textbf{LOW} (logicamente ``0'')

                Se $V_G + |V_T| > \frac{V_{DD}}{2}$ → Uscita = \textbf{HIGH} (logicamente ``1'')

                \vspace{0.1cm}
                \textbf{Esempio:} $V_{DD} = 5V$, $V_G = 1V$, $|V_T| = 1V$

                $V_{C,min} = 1V + 1V = 2V$

                $\frac{V_{DD}}{2} = 2.5V$

                $2V < 2.5V$ → Uscita = \textbf{LOW} (anche se non raggiunge GND!)

                \vspace{0.15cm}
                \textit{Nota importante:} Questa valutazione si usa SOLO per le \textbf{tabelle di verità} dei circuiti ibridi. Nei circuiti cMOS completi, l'uscita raggiunge sempre $V_{DD}$ o GND.

            \end{minipage}
        };
        %------------ Valutazione logica Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Valutazione logica circuiti ibridi/intermedi (PTL)};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \columnbreak





    %------------ Tempo di propagazione ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{\color{blue}Tempo di propagazione ($\tau$ o $t_{prop}$)}

                \vspace{0.2cm}
                \textbf{Definizione:} Tempo impiegato a raggiungere la soglia della porta logica successiva.

                \vspace{0.15cm}
                \colorbox{yellow!20}{\parbox{0.95\linewidth}{
                    \textbf{Convenzione:} Se non specificato, si prende:
                    $$V_{finale} = \frac{V_{DD}}{2}$$
                }}

                \vspace{0.2cm}
                \textbf{\color{purple}Metodo 1: Approssimazione a corrente costante}

                \vspace{0.1cm}
                $$\tau = \frac{\Delta V \cdot C}{I_{sat}}$$

                \vspace{0.15cm}
                Dove:
                \begin{itemize}[itemsep=2pt, leftmargin=*]
                    \item $\Delta V = V_{finale} - V_{iniziale}$
                    \item $V_{finale} = \frac{V_{DD}}{2}$ (sempre!)
                    \item $C$ = capacità di carico
                    \item $I_{sat}$ = corrente di saturazione del MOSFET
                \end{itemize}

                \vspace{0.15cm}
                \colorbox{cyan!10}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Esempio:} Se $V_{DD} = 5V$ e $V_{iniziale} = 0V$:

                    La transizione è da $0V$ a $\frac{5V}{2} = 2.5V$ (NON a 5V!)

                    $$\Delta V = 2.5V - 0V = 2.5V$$
                }}

            \end{minipage}
        };
        %------------ Tempo propagazione Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Tempo di propagazione};
    \end{tikzpicture}


    %------------ PTL vs CMOS ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \textbf{Confronto:} Due approcci diversi per implementare porte logiche

                \vspace{0.2cm}
                \textbf{\underline{1. CMOS (Complementary MOS Logic)}}

                \vspace{0.1cm}
                \textbf{Struttura:}

                • Rete \textbf{PUN} (pMOS) - pull-up network

                • Rete \textbf{PDN} (nMOS) - pull-down network

                • \textbf{Sempre} una rete ON, l'altra OFF

                \vspace{0.1cm}
                \textbf{Vantaggi:}

                • Uscita sempre a $V_{DD}$ o GND (livelli completi)

                • Potenza statica = 0 (nessun percorso VDD→GND)

                • Immunità al rumore elevata

                \vspace{0.1cm}
                \textbf{Svantaggi:}

                • Richiede reti complementari (più transistor)

                • Area maggiore

                \vspace{0.2cm}
                \hrule
                \vspace{0.15cm}

                \textbf{\underline{2. PTL (Pass Transistor Logic)}}

                \vspace{0.1cm}
                \textbf{Struttura:}

                • Usa \textbf{singoli transistor} (nMOS o pMOS)

                • I transistor ``passano'' i segnali da ingresso a uscita

                • NON usa reti complementari

                \vspace{0.1cm}
                \textbf{Vantaggi:}

                • Meno transistor (area ridotta)

                • Circuiti più semplici

                \vspace{0.1cm}
                \textbf{Svantaggi:}

                • \textbf{Livelli degradati}:

                \quad - nMOS carica solo fino a $V_G - V_T$

                \quad - pMOS scarica solo fino a $V_G + |V_T|$

                • Immunità al rumore ridotta

                • Potenza statica $\neq$ 0 (possibili percorsi VDD→GND)

                \vspace{0.2cm}
                \hrule
                \vspace{0.15cm}

                \colorbox{yellow!50}{\parbox{0.95\linewidth}{\footnotesize
                    \centering
                    \textbf{CONFRONTO RAPIDO:}

                    \vspace{0.05cm}
                    \textbf{CMOS}: Livelli completi, 0 potenza statica, + area

                    \textbf{PTL}: Livelli degradati, potenza statica, - area
                }}

            \end{minipage}
        };
        %------------ PTL vs CMOS Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}PTL vs CMOS Logic};
    \end{tikzpicture}


    %------------ Tempo propagazione PTL ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}


                \vspace{0.2cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ PROBLEMA - Approssimazione a corrente costante}

                    \vspace{0.05cm}
                    L'approssimazione con $I = I_{sat}$ (corrente costante in saturazione) è \textbf{molto SOTTOSTIMATA} per la PTL!

                    \vspace{0.05cm}
                    \textbf{Motivo:} Nella PTL, durante la carica/scarica, il MOSFET passa dalla zona di saturazione alla zona omica, e la corrente diminuisce drasticamente.
                }}

                \vspace{0.2cm}
                \textbf{\underline{METODO CORRETTO - Approssimazione RC}}

                \vspace{0.15cm}
                \textbf{Ipotesi da considerare:}

                \vspace{0.05cm}
                1. La corrente \textbf{finale} è circa \textbf{zero} (quando $V_C \approx V_G - V_T$ per nMOS)

                \vspace{0.05cm}
                2. La corrente a \textbf{metà tensione} ($V_{DD}/2$) è quella che determina il tempo

                \vspace{0.05cm}
                3. Sostituisci il transistor con una \textbf{resistenza equivalente} calcolata in zona omica

                \vspace{0.2cm}
                \textbf{\underline{Procedura:}}

                \vspace{0.1cm}
                \textbf{Step 1:} Calcola la resistenza equivalente in zona omica

                \vspace{0.05cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    $$R_{eq} = \frac{1}{2K \cdot V_{OV}}$$

                    \vspace{0.05cm}
                    dove $V_{OV} = V_{GS} - V_T$ al punto di lavoro considerato (tipicamente a $V_{OUT} = \frac{V_{DD}}{2}$)
                }}

                \vspace{0.15cm}
                \textbf{Step 2:} Calcola il tempo di propagazione come circuito RC

                \vspace{0.05cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    $$\tau_{prop} = R_{eq} \cdot C$$

                }}

                \vspace{0.2cm}
                \hrule
                \vspace{0.15cm}

                \textbf{Esempio pratico (nMOS in PTL):}

                $V_{DD} = 5V$, $V_G = 5V$, $V_T = 1V$, $K = 1$ mA/V$^2$, $C = 10$ pF

                \vspace{0.03cm}
                A metà tensione ($V_{OUT} = 2.5V$):

                $V_{GS} = 5V$ (gate fisso), $V_S = 2.5V$ (source al condensatore)

                $V_{OV} = 5V - 1V = 4V$

                \vspace{0.03cm}
                $R_{eq} = \frac{1}{2 \cdot 1 \cdot 4} = 0.125$ k$\Omega$ = 125 $\Omega$

                \vspace{0.03cm}
                $\tau_{prop} = 125 \cdot 10 \cdot 10^{-12} $ = 1.25 ns

                \vspace{0.15cm}
                \textbf{Confronto con approssimazione a corrente costante:}

                Se usassi $I_{sat} = K \cdot V_{OV}^2 = 1 \cdot 4^2 = 16$ mA (molto sovrastimato!)

                $\tau = \frac{\Delta V \cdot C}{I_{sat}} = \frac{2.5 \cdot 10p}{16m} = 1.56$ ns

                Il metodo RC è più accurato perché considera la diminuzione della corrente!

            \end{minipage}
        };
        %------------ Tempo propagazione PTL Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Tempo di propagazione - PTL (metodo accurato)};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ Potenza statica ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{\color{blue}Potenza statica}

                \vspace{0.2cm}
                \textbf{Definizione:} Potenza consumata dal circuito quando gli ingressi e le uscite \textbf{NON commutano} (analisi statica).

                \vspace{0.2cm}
                \textbf{Importante:} In analisi statica, il condensatore si comporta come se non ci fosse (circuito aperto).

                \vspace{0.2cm}
                \textbf{\color{purple}Formula:}

                \vspace{0.1cm}
                $$P_{statica} = I \cdot V_{DD}$$

                \vspace{0.15cm}
                Dove:
                \begin{itemize}[itemsep=2pt, leftmargin=*]
                    \item $I$ = corrente che scorre nel MOSFET/circuito
                    \item $V_{DD}$ = tensione di alimentazione
                \end{itemize}

                \vspace{0.15cm}
                \textit{Nota:} Poiché il condensatore è un circuito aperto in regime stazionario (nessun $\frac{dV}{dt}$), si calcola solo la corrente continua che scorre attraverso i MOSFET.

                \vspace{0.2cm}
                \textbf{cMOS standard:} $P_{statica} = 0$ sempre. Non esistono configurazioni che consumano potenza statica.

                \vspace{0.1cm}
                \textbf{cMOS non standard:} Possono avere configurazioni in cui $P_{statica} \neq 0$.

                \vspace{0.2cm}
                \colorbox{red!15}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ IMPORTANTE - Calcolo $V_{GS}$}

                    In analisi statica, se il \textbf{source dell'nMOS NON è a massa} (ma collegato a un'altra alimentazione):

                    \textbf{NON} usare $V_G$ direttamente, ma calcolare:
                    $$V_{GS} = V_G - V_S$$

                    Lo stesso vale per pMOS se il source NON è a $V_{DD}$.
                }}

            \end{minipage}
        };
        %------------ Potenza statica Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Potenza statica};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ Potenza dinamica ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.2cm}
                \textbf{Definizione:} Potenza consumata durante le commutazioni degli ingressi uscite.

                \vspace{0.2cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ CONDIZIONE FONDAMENTALE}

                    \vspace{0.1cm}
                    Prima di applicare la formula, verificare che:
                    $$\tau_{prop} \leq \frac{T_{in}}{2}$$

                    Dove:
                    \begin{itemize}[itemsep=1pt]
                        \item $\tau_{prop}$ = tempo di propagazione
                        \item $T_{in}$ = periodo del segnale di ingresso
                    \end{itemize}

                    \vspace{0.05cm}
                    Se $\tau_{prop} > \frac{T_{in}}{2}$, il circuito \textbf{NON ha tempo} di raggiungere il regime prima della prossima commutazione $\Rightarrow$ la formula \textbf{NON è valida}.
                }}

                \vspace{0.15cm}
                \textit{Nota pratica:} Se hai calcolato $\tau_{prop}$ per una transizione (es. high$\to$low) ma la potenza dinamica riguarda la transizione opposta (low$\to$high), verifica l'\textbf{ordine di grandezza}. Se $K_n$ e $K_p$ sono comparabili numericamente, i due tempi di propagazione saranno multipli ma \textbf{stesso ordine di grandezza}. Se $\tau_{prop} \ll \frac{T_{in}}{2}$ (molto minore), sei a posto anche senza calcolare l'altro! \textbf{ATTENZIONE:} Questa assunzione vale \textbf{SOLO se $K_n \approx K_p$}. Se i valori di $K$ sono molto diversi, devi calcolare entrambi i tempi di propagazione.

                \vspace{0.2cm}
                \textbf{\color{purple}Formula generale:}

                \vspace{0.1cm}
                $$P_D = V_{DD} \sum_{i} (V_{OH,i} - V_{OL,i}) \cdot C_i \cdot f_i$$

                \vspace{0.2cm}
                \textbf{Caso semplificato} (un solo nodo d'uscita):
                $$P_D = V_{DD} \cdot (V_{OH} - V_{OL}) \cdot C_L \cdot f_{out}$$

                \vspace{0.2cm}
                Dove:
                \begin{itemize}[itemsep=2pt, leftmargin=*]
                    \item $V_{DD}$ = tensione di alimentazione
                    \item $V_{OH}$ = tensione output HIGH (valore massimo)
                    \item $V_{OL}$ = tensione output LOW (valore minimo)
                    \item $C_L$ = capacità del carico
                    \item $f_{out}$ = frequenza di uscita
                \end{itemize}

                \vspace{0.2cm}
                \textbf{Come determinare $V_{OH}$ e $V_{OL}$:}

                Sono i valori massimo e minimo dell'uscita durante le commutazioni.

                \textbf{Metodi:}
                \begin{itemize}[itemsep=1pt]
                    \item Dal grafico di $V_{out}(t)$ (se richiesto in precedenza)
                    \item Forniti direttamente nel testo dell'esercizio
                    \item Analizzando le transizioni del circuito
                \end{itemize}

            \end{minipage}
        };
        %------------ Potenza dinamica Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Potenza dinamica};
    \end{tikzpicture}


    %------------ Duty Cycle ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{\color{blue}Duty Cycle (ciclo di lavoro)}

                \vspace{0.2cm}
                \textbf{Definizione:} Il \textbf{duty cycle} $\delta$ è il rapporto tra il tempo in cui il segnale è HIGH e il periodo totale:

                \vspace{0.1cm}
                $$\delta = \frac{T_{HIGH}}{T} = \frac{T_{HIGH}}{T_{HIGH} + T_{LOW}}$$

                \vspace{0.15cm}
                Espresso in percentuale: $\delta \% = \delta \times 100$

                \vspace{0.2cm}
                \textbf{Esempi comuni:}

                \vspace{0.05cm}
                • $\delta = 0.5$ (50\%) → onda quadra simmetrica (HIGH e LOW stesso tempo)

                • $\delta = 0.25$ (25\%) → segnale HIGH per 25\% del periodo

                • $\delta = 0.75$ (75\%) → segnale HIGH per 75\% del periodo

                \vspace{0.2cm}
                \textit{Relazione con la potenza dinamica:} Se il duty cycle $\neq$ 50\%, può influenzare la frequenza effettiva delle commutazioni complete. In molti esercizi si assume duty cycle = 50\% (onda quadra simmetrica).

            \end{minipage}
        };
        %------------ Duty Cycle Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Duty Cycle};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    %------------ cMOS ---------------
    \label{cMOS}
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \textbf{Definizione:} Una porta logica \textbf{cMOS} (Complementary MOS) è composta da due reti complementari:

                \vspace{0.05cm}
                • \textbf{PUN} (Pull-Up Network): rete di \textbf{pMOS}

                • \textbf{PDN} (Pull-Down Network): rete di \textbf{nMOS}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ REGOLA FONDAMENTALE}

                    \vspace{0.05cm}
                    In qualsiasi configurazione di ingresso:

                    \vspace{0.03cm}
                    \textbf{Solo UNA rete è attiva (ON) alla volta}

                    \vspace{0.05cm}
                    • Se PUN è ON → PDN è OFF (uscita = $V_{DD}$)

                    • Se PDN è ON → PUN è OFF (uscita = GND)
                }}

                \vspace{0.15cm}
                \textbf{\underline{Significato PRATICO negli esercizi:}}

                \vspace{0.05cm}
                \textbf{1. Potenza statica = 0}

                Poiché una rete è sempre OFF, non c'è percorso diretto tra $V_{DD}$ e GND → $P_{statica} = 0$

                \vspace{0.1cm}
                \textbf{2. Analisi per stati logici}

                Per ogni combinazione di ingressi, verifica:

                • Quali MOSFET sono ON/OFF

                • Quale rete (PUN o PDN) è attiva

                • Output = $V_{DD}$ se PUN ON, = GND se PDN ON

                \vspace{0.15cm}
                \textbf{\underline{Esempio: cMOS Inverter}}

                \vspace{0.05cm}
                \textbf{Ingresso ALTO (``1''):}

                • nMOS ON → PDN attiva → Uscita = GND (``0'')

                • pMOS OFF → PUN spenta

                \vspace{0.05cm}
                \textbf{Ingresso BASSO (``0''):}

                • pMOS ON → PUN attiva → Uscita = $V_{DD}$ (``1'')

                • nMOS OFF → PDN spenta

                \vspace{0.1cm}
                \textit{Nota:} Le reti sono \textbf{complementari}: se PUN realizza $f$, PDN realizza $\overline{f}$

            \end{minipage}
        };
        %------------ cMOS Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Porte cMOS - Definizione};
    \end{tikzpicture}


    %------------ Costruzione PUN da PDN ---------------
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small

                \vspace{0.15cm}
                \textbf{Problema:} Data la rete Pull-Down (PDN) con nMOS, costruire la rete Pull-Up (PUN) con pMOS

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ METODO - Trasformazione DUALE}

                    \vspace{0.05cm}
                    \colorbox{yellow!40}{\parbox{0.92\linewidth}{\tiny
                        \centering
                        \textbf{In pratica: INVERSIONE RICORSIVA di SERIE e PARALLELO}
                    }}

                    \vspace{0.05cm}
                    Dalla PDN alla PUN:

                    \vspace{0.05cm}
                    \textbf{1.} SERIE → PARALLELO

                    \textbf{2.} PARALLELO → SERIE

                    \textbf{3.} nMOS → pMOS

                    \textbf{4.} Gate (ingressi) → RIMANGONO UGUALI
                }}

                \vspace{0.15cm}
                \textbf{\underline{PROCEDURA MECCANICA:}}

                \vspace{0.05cm}
                \textbf{Step 1:} Identifica la struttura della PDN

                • Individua le connessioni SERIE

                • Individua le connessioni PARALLELO

                \vspace{0.05cm}
                \textbf{Step 2:} Applica la trasformazione

                • Ogni SERIE diventa PARALLELO

                • Ogni PARALLELO diventa SERIE

                • Sostituisci nMOS con pMOS

                • Mantieni gli stessi gate

                \vspace{0.15cm}
                \textbf{Esempio pratico:}

                \textbf{PDN:} nMOS(A) in SERIE con [nMOS(B) || nMOS(C)]

                \vspace{0.05cm}
                \textbf{Applicazione trasformazione:}

                • A in SERIE → A in PARALLELO

                • (B || C) → (B in SERIE con C)

                \vspace{0.05cm}
                \textbf{PUN:} pMOS(A) in PARALLELO con [pMOS(B) in SERIE con pMOS(C)]

                \vspace{0.05cm}
                In formula: $PUN = A \parallel (B \cdot C)$

                \vspace{0.15cm}
                \textbf{Verifica:} Le due reti sono complementari

                • PDN: $f = A \cdot (B + C)$

                • PUN: $\overline{f} = \overline{A} + (\overline{B} \cdot \overline{C}) = \overline{A \cdot (B + C)}$ $\checkmark$

                \vspace{0.1cm}
                \textit{Nota:} Questo metodo garantisce che solo una rete sia ON alla volta (proprietà fondamentale delle porte cMOS)

            \end{minipage}
        };
        %------------ Costruzione PUN da PDN Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Costruzione PUN da PDN};
    \end{tikzpicture}
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    \newpage

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ OpAmp - Introduzione e Caratteristica ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Amplificatore Operazionale (OpAmp)}

                \vspace{0.15cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.7]
                        % OpAmp
                        \draw (2,1.5) node[op amp, noinv input up] (opamp) {};
                        % Labels
                        \node at (opamp.-) [left] {\footnotesize $V^-$};
                        \node at (opamp.+) [left] {\footnotesize $V^+$};
                        \draw (opamp.out) -- ++(0.5,0) node[right] {$V_{out}$};
                        % Power supplies (dashed)
                        \draw[dashed] (opamp.up) -- ++(0,0.4) node[above] {\tiny $+V_{DD}$};
                        \draw[dashed] (opamp.down) -- ++(0,-0.4) node[below] {\tiny $-V_{SS}$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.1cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Equazione fondamentale:}

                    \vspace{0.1cm}
                    $$\boxed{V_{out} = A_0 \cdot (V^+ - V^-)}$$

                    dove $A_0$ = guadagno ad anello aperto ($A_0 \to \infty$ ideale)
                }}

                \vspace{0.15cm}
                \textbf{Caratteristica $V_{out}$ vs $(V^+ - V^-)$:}

                \vspace{0.1cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.55]
                        % Axes
                        \draw[->] (-2.5,0) -- (2.5,0) node[right] {\footnotesize $V^+ - V^-$};
                        \draw[->] (0,-2.2) -- (0,2.5) node[above] {\footnotesize $V_{out}$};
                        % Saturation levels
                        \draw[dashed, red, thick] (-2.5,1.7) -- (2.5,1.7);
                        \node[red, right] at (2.5,1.7) {\tiny $+V_{sat}$};
                        \draw[dashed, red, thick] (-2.5,-1.7) -- (2.5,-1.7);
                        \node[red, right] at (2.5,-1.7) {\tiny $-V_{sat}$};
                        % Characteristic curve
                        \draw[thick, blue] (-2.5,-1.7) -- (-0.3,-1.7) -- (0.3,1.7) -- (2.5,1.7);
                        % Labels for zones
                        \node[blue] at (-1.5,-2) {\tiny SAT$^-$};
                        \node[blue] at (0,-0.6) {\tiny LIN};
                        \node[blue] at (1.5,2) {\tiny SAT$^+$};
                        % Slope annotation
                        \draw[<->, green!50!black] (0.1,0) -- (0.25,1.2);
                        \node[green!50!black, right] at (0.3,0.6) {\tiny $A_0$};
                    \end{tikzpicture}
                \end{center}

                \vspace{0.1cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{ZONA LINEARE} (tra le saturazioni):

                    \vspace{0.05cm}
                    $V_{out} = A_0 \cdot (V^+ - V^-)$

                    \vspace{0.05cm}
                    {\footnotesize L'OpAmp amplifica la differenza degli ingressi}
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{ZONA di SATURAZIONE:}

                    \vspace{0.05cm}
                    • Se $(V^+ - V^-) > 0$ (anche di poco): $V_{out} = +V_{sat}$

                    • Se $(V^+ - V^-) < 0$ (anche di poco): $V_{out} = -V_{sat}$

                    \vspace{0.05cm}
                    {\footnotesize L'uscita ``tocca'' le alimentazioni e non va oltre!}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ I trattini (- - -) nel grafico:}

                    \vspace{0.05cm}
                    Indicano i \textbf{limiti di saturazione} $\pm V_{sat}$.

                    L'uscita si ``appiattisce'' su questi valori e non segue più $(V^+ - V^-)$!
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Valori tipici di $V_{sat}$:}

                    \vspace{0.05cm}
                    • \textbf{Rail-to-rail:} $V_{sat} = V_{alim}$ esattamente

                    • \textbf{Standard:} $V_{sat} \approx V_{alim} - 1V \div 2V$
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}OpAmp - Introduzione e Caratteristica};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ OpAmp - Impedenza con Condensatori per Bode ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Impedenza del condensatore:}

                \vspace{0.1cm}
                $$Z_C(s) = \frac{1}{sC}$$

                {\footnotesize Con $s = j\omega$: modulo $|Z_C| = \frac{1}{\omega C}$, fase $\angle Z_C = -90^\circ$}

                \vspace{0.2cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{
                    \textbf{Comportamento del condensatore in base alla frequenza:}

                    \vspace{0.1cm}
                    \begin{center}
                    \begin{tabular}{|c|c|c|c|}
                        \hline
                        \textbf{Freq.} & \textbf{$Z_C$} & \textbf{Equiv.} & \textbf{Effetto} \\
                        \hline
                        DC ($\omega=0$) & $\infty$ & \textbf{Aperto} & Cancella ramo \\
                        \hline
                        Alta ($\omega \to \infty$) & $0$ & \textbf{Corto} & Filo (a GND) \\
                        \hline
                    \end{tabular}
                    \end{center}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{orange}$\bigstar$ DC ($\omega = 0$):} $Z_C = \frac{1}{0 \cdot C} \to \infty$ → \textbf{APERTO}

                    \vspace{0.05cm}
                    Il condensatore \`e carico, blocca la corrente continua.
                }}

                \vspace{0.1cm}
                \colorbox{cyan!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{blue}$\bigstar$ Alta freq. ($\omega \to \infty$):} $Z_C = \frac{1}{\infty \cdot C} \to 0$ → \textbf{CORTO}

                    \vspace{0.05cm}
                    Il condensatore non ha tempo di caricarsi, la corrente passa libera.

                    \vspace{0.05cm}
                    \textit{Nota:} Se C \`e collegato a massa, il nodo va a \textbf{GND}.
                }}

                \vspace{0.2cm}
                \textbf{Configurazioni comuni:}

                \vspace{0.15cm}
                \textbf{1. C in PARALLELO con R:}

                \vspace{0.05cm}
                $$Z(s) = \frac{R \cdot \frac{1}{sC}}{R + \frac{1}{sC}} = \frac{R}{1 + sRC}$$

                \vspace{0.05cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{\tiny
                    \textbf{Notazione comoda per paralleli:} $Z = (R^{-1} + Z_C^{-1})^{-1}$

                    \vspace{0.02cm}
                    Più facile da manipolare rispetto a $\frac{Z_1 \cdot Z_2}{Z_1 + Z_2}$
                }}

                \vspace{0.05cm}
                Polo in: $\omega_p = \frac{1}{RC}$

                \vspace{0.15cm}
                \textbf{2. C in SERIE con R:}

                \vspace{0.05cm}
                $$Z(s) = R + \frac{1}{sC} = \frac{1 + sRC}{sC}$$

                \vspace{0.05cm}
                Zero in: $\omega_z = \frac{1}{RC}$

                \vspace{0.2cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ CONTROLLI (SANITY CHECKS)}

                    \vspace{0.05cm}
                    Dopo aver calcolato impedenze (serie/parallelo):

                    \vspace{0.1cm}
                    \textbf{1. Controllo Dimensionale:}

                    \vspace{0.03cm}
                    • L'impedenza $Z$ deve avere dimensione di $\Omega$ (ohm)

                    • Il coefficiente $\tau$ che moltiplica $s$ deve essere in [s]

                    • Relazione utile: $[\text{F}] \cdot [\Omega] = [\text{s}]$

                    • Es: $RC$ ha dimensioni $[\Omega] \cdot [\text{F}] = [\text{s}]$ $\checkmark$

                    \vspace{0.1cm}
                    \textbf{2. Controllo a Frequenza Nulla ($s = 0$):}

                    \vspace{0.03cm}
                    • A $s = 0$ (DC), il condensatore è APERTO

                    • Sostituisci $s = 0$ in $Z(s)$ calcolata

                    • Deve dare la stessa $R_{eq}$ ottenuta considerando C aperto

                    \vspace{0.03cm}
                    Es: $Z = \frac{R}{1 + sRC}|_{s=0} = R$ (corretto: C aperto lascia R)
                }}

            \end{minipage}
        };
        %------------ Impedenza con Condensatori Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Impedenza con Condensatori};
    \end{tikzpicture}

    \newpage

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Forma Standard per Bode ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                Data una funzione di trasferimento generica come $T(s) = \frac{V_{out}}{I_{in}}$, portala in forma:

                \vspace{0.1cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Trasferimento vs Guadagno:}

                    \vspace{0.05cm}
                    • \textbf{Guadagno} = numero \textbf{puro} (adimensionale): $\frac{V_{out}}{V_{in}}$

                    \vspace{0.03cm}
                    • \textbf{Trasferimento} = ha \textbf{unit\`a di misura}: es. $\frac{V_{out}}{I_{in}}$ [$\Omega$]

                    \vspace{0.05cm}
                    Es: amplificatore a \textbf{transimpedenza} ha trasferimento in $\Omega$
                }}

                \vspace{0.1cm}

                \vspace{0.05cm}
                $$T(s) = K \cdot s^n \cdot \frac{(1 + s\tau_{z1})(1 + s\tau_{z2})\cdots}{(1 + s\tau_{p1})(1 + s\tau_{p2})\cdots}$$

                \vspace{0.1cm}
                Dove:

                \vspace{0.05cm}
                • $K$ = guadagno costante (può essere assente se $K=1$)

                • $s^n$ = poli/zeri nell'origine (può essere assente se $n=0$)

                \hspace{0.3cm} $n > 0$: zeri nell'origine, $n < 0$: poli nell'origine

                • $\tau_{zi} = \frac{1}{\omega_{zi}}$ = costante di tempo dello zero $i$-esimo

                • $\tau_{pi} = \frac{1}{\omega_{pi}}$ = costante di tempo del polo $i$-esimo

                \vspace{0.15cm}
                \textbf{Procedimento:}

                \vspace{0.05cm}
                1. Fattorizza numeratore e denominatore

                2. Porta ogni fattore $(s + a)$ nella forma $(1 + s\tau)$:

                \hspace{0.3cm} $(s + a) = a(1 + s/a)$ → raccolta $a$ in $K$, con $\tau = 1/a$

                3. Raccogli tutti i coefficienti costanti in $K$

                4. Eventuali $s$ isolati formano il termine $s^n$

                \vspace{0.2cm}
                \textit{Nota:} In questa forma, poli e zeri sono immediatamente visibili: $\omega_p = \frac{1}{\tau_p}$ e $\omega_z = \frac{1}{\tau_z}$

                \vspace{0.2cm}
                \colorbox{purple!15}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Conversione Scala Logaritmica $\leftrightarrow$ Lineare}

                    \vspace{0.1cm}
                    \textbf{Da LINEARE a dB (logaritmica):}

                    \vspace{0.05cm}
                    $$|T|_{\text{dB}} = 20\log_{10}(|T|_{\text{lin}})$$

                    \vspace{0.1cm}
                    \textbf{Da dB a LINEARE:}

                    \vspace{0.05cm}
                    $$|T|_{\text{lin}} = 10^{|T|_{\text{dB}}/20}$$

                    \vspace{0.1cm}
                    \textbf{Valori utili da ricordare:}

                    \vspace{0.05cm}
                    • 0 dB $\leftrightarrow$ 1 (lineare)

                    • 20 dB $\leftrightarrow$ 10 (lineare)

                    • -20 dB $\leftrightarrow$ 0.1 (lineare)

                    • 3 dB $\leftrightarrow$ $\sqrt{2} \approx 1.41$ (lineare)

                    • -3 dB $\leftrightarrow$ $1/\sqrt{2} \approx 0.707$ (lineare)

                    • 6 dB $\leftrightarrow$ 2 (lineare)
                }}

            \end{minipage}
        };
        %------------ Forma Standard per Bode Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Forma Standard per Bode};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Bode - Diagramma del Modulo ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                Data $T(s) = K \cdot s^n \cdot \frac{(1 + s\tau_{z1})(1 + s\tau_{z2})\cdots}{(1 + s\tau_{p1})(1 + s\tau_{p2})\cdots}$

                \vspace{0.15cm}
                {\footnotesize
                \textbf{Punto di partenza per il tracciamento:}

                \vspace{0.05cm}
                • Se $n = 0$: calcola $|T(0)|$ e $\angle T(0)$ (sostituisci $s=0$)

                \vspace{0.05cm}
                • Se $n \neq 0$: \textbf{NON puoi} calcolare a $s=0$ (singolarità!) $\rightarrow$ vedi box dedicato
                }

                \vspace{0.2cm}
                \textbf{Tracciamento del Modulo:}

                \vspace{0.15cm}
                \textbf{1. Contributo di K (guadagno costante):}

                \vspace{0.05cm}
                Retta orizzontale a: $20\log_{10}|K|$ dB

                \vspace{0.05cm}
                • Se $K > 0$: $20\log_{10}K$ dB

                • Se $K < 0$: $20\log_{10}|K|$ dB (modulo positivo)

                \vspace{0.15cm}
                \textbf{2. Contributo di $s^n$ (poli/zeri nell'origine):}

                \vspace{0.05cm}
                Retta passante per $(1, 0\text{ dB})$ con pendenza:

                \vspace{0.05cm}
                • $+20n$ dB/dec se $n > 0$ (zeri nell'origine)

                • $-20|n|$ dB/dec se $n < 0$ (poli nell'origine)

                \vspace{0.15cm}
                \textbf{3. Contributo degli ZERI $(1 + s\tau_z)$:}

                \vspace{0.05cm}
                Per $\omega_z = \frac{1}{\tau_z}$:

                \vspace{0.05cm}
                • $\omega < \omega_z$: contributo $\approx 0$ dB (retta orizzontale)

                • $\omega = \omega_z$: punto di spigolo

                • $\omega > \omega_z$: pendenza $+20$ dB/dec

                \vspace{0.15cm}
                \textbf{4. Contributo dei POLI $(1 + s\tau_p)$:}

                \vspace{0.05cm}
                Per $\omega_p = \frac{1}{\tau_p}$:

                \vspace{0.05cm}
                • $\omega < \omega_p$: contributo $\approx 0$ dB (retta orizzontale)

                • $\omega = \omega_p$: punto di spigolo

                • $\omega > \omega_p$: pendenza $-20$ dB/dec

                \vspace{0.15cm}
                \textbf{5. Tracciamento finale (METODO PRATICO):}

                \vspace{0.05cm}
                a) Parte da $K \cdot s^n$ con pendenza iniziale
 
                \vspace{0.03cm}
                \hspace{0.3cm} Se $n=0$: costante fino alla $1^a$ singolarità

                b) Ordina poli e zeri per frequenza crescente

                c) Ad ogni singolarità (da sinistra a destra):

                \vspace{0.03cm}
                \hspace{0.3cm} • Per ogni \textbf{zero}: aggiungi $+20$ dB/dec alla pendenza

                \hspace{0.3cm} • Per ogni \textbf{polo}: aggiungi $-20$ dB/dec alla pendenza

                d) Esempio: se hai pendenza 0 e incontri zero → diventa $+20$ dB/dec

                \vspace{0.1cm}
                \hspace{0.5cm} poi incontri polo → diventa 0 dB/dec

                \vspace{0.2cm}
                \textbf{Guadagno di Banda (GBW):}

                \vspace{0.05cm}
                Per amplificatori con 1 polo dominante:

                \vspace{0.05cm}
                $$\text{GBW} = |A_0| \cdot \omega_p$$

                Dove $A_0$ è il guadagno a basse frequenze (prima del polo)

            \end{minipage}
        };
        %------------ Bode Modulo Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Bode - Diagramma del Modulo};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Bode - Metodo Generale Unificato ---------------

    \resizebox{\columnwidth}{!}{
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.45\textwidth}

                \small
                \colorbox{red!25}{\parbox{0.97\linewidth}{
                    \textbf{\color{red!70!black}$\bigstar$ METODO GENERALE UNIFICATO per Bode del Modulo}
                }}

                \vspace{0.2cm}
                \textbf{\underline{PASSO 1: Analisi Strutturale (Scomposizione Visiva)}}

                \vspace{0.1cm}
                Guarda $G(s)$ e identifica \textbf{col dito} questi tre elementi (no calcoli, solo riconoscimento):

                \vspace{0.1cm}
                \textbf{1. Il Guadagno Statico ($K$):}

                Raccogli tutti i numeri costanti che moltiplicano la funzione.

                $\Rightarrow$ Determina l'\textbf{altezza verticale} del grafico.

                \vspace{0.1cm}
                \textbf{2. I Termini Binomiali $(1 + s\tau)$} (singolarit\`a standard):

                \vspace{0.05cm}
                • Se \`e al \textbf{NUMERATORE}: \`e uno \textbf{ZERO} (grafico \textbf{sale})

                • Se \`e al \textbf{DENOMINATORE}: \`e un \textbf{POLO} (grafico \textbf{scende})

                \vspace{0.1cm}
                \textbf{3. La ``S'' Isolata ($s^n$):}

                Cerca le $s$ che \textbf{NON} sono sommate a 1 (es: $s$, $s^2$, $1/s$, $1/s^2$)

                \vspace{0.05cm}
                • Se al \textbf{NUMERATORE} ($s$, $s^2$): hai $n$ \textbf{Zeri nell'origine}

                • Se al \textbf{DENOMINATORE} ($1/s$, $1/s^2$): hai $n$ \textbf{Poli nell'origine}

                • Se \textbf{non c'\`e}: $n = 0$

                \vspace{0.25cm}
                \textbf{\underline{PASSO 2: Calcolo delle Frequenze di Taglio}}

                \vspace{0.1cm}
                Prendi tutti i \textit{Termini Binomiali} (Passo 1, punto 2) e calcola:

                $$\boxed{f_p = \frac{1}{2\pi \cdot \tau}}$$

                \textbf{Lista Ordinata:} metti le frequenze in ordine crescente $f_1 < f_2 < f_3 \dots$

                $\Rightarrow$ Questi sono i ``paletti'' verticali sull'asse delle frequenze.

                \vspace{0.25cm}
                \textbf{\underline{PASSO 3: Il Confronto Cruciale (L'Attacco del Grafico)}}

                \vspace{0.1cm}
                Decidi come \textbf{inizia} il grafico a sinistra. Guarda solo la ``S'' Isolata (Passo 1, punto 3).

                \vspace{0.1cm}
                \textbf{CASO A: Nessuna ``S'' Isolata} (singolarit\`a NON in zero)

                \vspace{0.05cm}
                • \textbf{Comportamento:} Il grafico parte \textbf{PIATTO} (orizzontale)

                • \textbf{Valore di partenza:} Converti $K$ da lineare a dB:

                $$\boxed{|K|_{\text{dB}} = 20 \log_{10}(|K|_{\text{lin}})}$$

                • \textbf{Azione:} Disegna retta orizzontale fino alla prima freq. $f_1$

                \vspace{0.1cm}
                \textbf{CASO B: Presenza di ``S'' Isolata} (singolarit\`a IN zero)

                \vspace{0.05cm}
                • \textbf{Comportamento:} Il grafico parte \textbf{IN PENDENZA}

                \hspace{0.3cm} -- Zero in origine ($s$): parte \textbf{salendo} (+20 dB/dec)

                \hspace{0.3cm} -- Polo in origine ($1/s$): parte \textbf{scendendo} (-20 dB/dec)

                \vspace{0.1cm}
                • \textbf{Punto di Ancoraggio (IL TRUCCO):}

                \hspace{0.3cm} Non calcolare la retta iniziale (difficile!)

                \hspace{0.3cm} Scegli $f_{test}$ \textbf{dopo} la prima singolarit\`a o nel ``centro banda''

                \hspace{0.3cm} Calcola il modulo con $s = j 2\pi f_{test}$

                \hspace{0.3cm} Segna quel punto e usalo come \textbf{perno} per le pendenze

                \vspace{0.25cm}
                \textbf{\underline{PASSO 4: Tracciamento Dinamico (Disegno)}}

                \vspace{0.1cm}
                Percorri l'asse delle frequenze da \textbf{sinistra a destra}:

                \vspace{0.1cm}
                1. Avanza fino alla prima frequenza $f_1$

                \vspace{0.05cm}
                2. \textbf{Applica la modifica:}

                \hspace{0.3cm} • Se $f_1$ era un \textbf{POLO}: \textbf{sottrai} 20 alla pendenza

                \hspace{0.5cm} (es: eri piatto 0 $\to$ diventi -20 dB/dec)

                \hspace{0.3cm} • Se $f_1$ era uno \textbf{ZERO}: \textbf{aggiungi} 20 alla pendenza

                \hspace{0.5cm} (es: scendevi -20 $\to$ diventi piatto 0)

                \vspace{0.05cm}
                3. Prosegui fino a $f_2$ e \textbf{ripeti}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Bode - Metodo Generale Unificato};
    \end{tikzpicture}}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Formule Rapide di Navigazione sul Grafico ---------------

    \resizebox{0.8\linewidth}{!}{%
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{\color{red!70!black}$\bigstar$ REGOLE AUREE per muoversi sul grafico}
                }}

                \vspace{0.2cm}
                \colorbox{orange!25}{\parbox{0.95\linewidth}{
                    \textbf{1. Sulla DISCESA (-20 dB/dec): Legge del Prodotto Costante}

                    \vspace{0.1cm}
                    $$\boxed{G \cdot f = \text{Costante}}$$

                    \vspace{0.05cm}
                    \textbf{Uso:} Da $(G_1, f_1)$ trovo $G_2$ a frequenza $f_2$:

                    $$G_2 = \frac{G_1 \cdot f_1}{f_2}$$

                    \vspace{0.05cm}
                    \textit{Mnemonica: ``Pi\`u vado avanti in frequenza, pi\`u il guadagno scende: il loro prodotto resta uguale.''}
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{2. Sulla SALITA (+20 dB/dec): Legge del Rapporto Costante}

                    \vspace{0.1cm}
                    $$\boxed{\frac{G}{f} = \text{Costante}}$$

                    \vspace{0.05cm}
                    \textbf{Uso:} Da $(G_1, f_1)$ trovo $G_2$ a frequenza $f_2$:

                    $$G_2 = G_1 \cdot \frac{f_2}{f_1}$$

                    \vspace{0.05cm}
                    \textit{Mnemonica: ``Se la frequenza raddoppia, il guadagno raddoppia.''}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{Caso Generale: pendenza $\pm n \cdot 20$ dB/dec}

                    \vspace{0.1cm}
                    \textbf{DISCESA} ($-n \cdot 20$ dB/dec):
                    $$\boxed{G \cdot f^n = \text{Cost.}} \quad \Rightarrow \quad G_2 = G_1 \cdot \left(\frac{f_1}{f_2}\right)^n$$

                    \vspace{0.05cm}
                    \textbf{SALITA} ($+n \cdot 20$ dB/dec):
                    $$\boxed{\frac{G}{f^n} = \text{Cost.}} \quad \Rightarrow \quad G_2 = G_1 \cdot \left(\frac{f_2}{f_1}\right)^n$$

                    \vspace{0.1cm}
                    {\footnotesize
                    \begin{tabular}{|c|c|c|}
                        \hline
                        \textbf{Pendenza} & \textbf{Discesa} & \textbf{Salita} \\
                        \hline
                        $\pm 20$ dB/dec & $G \cdot f$ & $G / f$ \\
                        $\pm 40$ dB/dec & $G \cdot f^2$ & $G / f^2$ \\
                        $\pm 60$ dB/dec & $G \cdot f^3$ & $G / f^3$ \\
                        \hline
                    \end{tabular}
                    }
                }}

                \vspace{0.15cm}
                \colorbox{red!30}{\parbox{0.95\linewidth}{
                    \textbf{Intersezione con asse 0 dB: $G = 1$}

                    \vspace{0.1cm}
                    \textbf{$\triangle$ WARNING CRITICO:}

                    Quando cerchi l'intersezione con l'asse 0 dB, usa:

                    $$\boxed{G_{\text{lineare}} = 1} \quad \text{(NON 0!)}$$

                    \textbf{Motivo:} $0 \text{ dB} \Leftrightarrow G_{\text{lin}} = 1$

                    Se metti 0 nella moltiplicazione, annulli tutto!
                }}

                \vspace{0.2cm}
                \textbf{Esempio pratico:}

                \vspace{0.05cm}
                Plateau a $G = 100$ che finisce in polo a $f = 1$ kHz.

                A che frequenza taglio l'asse 0 dB scendendo?

                \vspace{0.1cm}
                Uso regola discesa: $G_1 \cdot f_1 = G_2 \cdot f_2$

                $$100 \cdot 1\text{k} = 1 \cdot f_x \Rightarrow \boxed{f_x = 100 \text{ kHz}}$$

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Formule Rapide di Navigazione sul Bode};
    \end{tikzpicture}%
    }

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Bode - Singolarità in Zero ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Caso:} $T(s) = s\tau_0 \cdot \frac{(1 + s\tau_{z1})}{(1 + s\tau_{p1})}$ \quad (zero nell'origine)

                \vspace{0.15cm}
                \textbf{Procedimento:}

                \vspace{0.1cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{1. Trova il punto di partenza (intersezione con 0 dB):}

                    \vspace{0.1cm}
                    Frequenza: $\boxed{f_0 = \frac{1}{2\pi\tau_0}}$ \quad oppure \quad $\boxed{\omega_0 = \frac{1}{\tau_0}}$

                    \vspace{0.1cm}
                    $\Rightarrow$ A $\omega = \omega_0$ il contributo di $s\tau_0$ vale \textbf{0 dB}
                }}

                \vspace{0.15cm}
                \textbf{2. Traccia la retta con pendenza $+20$ dB/dec}

                \vspace{0.05cm}
                passante per il punto $(\omega_0, 0\text{ dB})$

                \vspace{0.15cm}
                \textbf{3. Aggiungi i contributi di poli/zeri:}

                \vspace{0.05cm}
                • A $\omega_{z1} = 1/\tau_{z1}$: pendenza $+20$ dB/dec

                • A $\omega_{p1} = 1/\tau_{p1}$: pendenza $-20$ dB/dec

                \vspace{0.2cm}
                {\footnotesize
                \textbf{$\triangle$ Se polo nell'origine} (es. $\frac{1}{s\tau_0}$):

                \vspace{0.05cm}
                • Pendenza iniziale \textbf{$-20$ dB/dec}

                • Stesso punto di partenza: $(\omega_0 = 1/\tau_0, 0\text{ dB})$
                }

                \vspace{0.2cm}
                \colorbox{magenta!20}{\parbox{0.95\linewidth}{
                    \textbf{FASE con singolarit\`a in zero:}

                    \vspace{0.1cm}
                    \textbf{Zero nell'origine} ($s^n$ al numeratore):

                    \vspace{0.05cm}
                    Fase iniziale: $\boxed{+90^\circ \cdot n}$ (costante $\forall \omega$)

                    \vspace{0.1cm}
                    \textbf{Polo nell'origine} ($s^n$ al denominatore):

                    \vspace{0.05cm}
                    Fase iniziale: $\boxed{-90^\circ \cdot n}$ (costante $\forall \omega$)

                    \vspace{0.1cm}
                    {\footnotesize Poi aggiungi i contributi dei poli/zeri normali ($\pm 90^\circ$ ciascuno)}
                }}

            \end{minipage}
        };
        %------------ Singolarità in Zero Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Bode - Singolarità in Zero ($n \neq 0$)};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Bode - Diagramma della Fase ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Tracciamento della Fase:}

                \vspace{0.15cm}
                \textbf{1. Contributo di K:}

                \vspace{0.05cm}
                • Se $K > 0$ (cioè $T(0) > 0$): fase $= 0^\circ$

                • Se $K < 0$ (cioè $T(0) < 0$): fase $= -180^\circ$

                \vspace{0.05cm}
                {\tiny Se $T(0) < 0$, parti da $-180^\circ$ e somma i contributi}

                \vspace{0.15cm}
                \textbf{2. Contributo di $s^n$:}

                \vspace{0.05cm}
                Fase costante: $+90^\circ \cdot n$ per ogni frequenza

                \vspace{0.15cm}
                \textbf{3. Contributo degli ZERI $(1 + s\tau_z)$:}

                \vspace{0.05cm}
                Transizione centrata in $\omega_z = \frac{1}{\tau_z}$:

                \vspace{0.05cm}
                • $\omega < \omega_z/10$: fase $\approx 0^\circ$

                • $\omega = \omega_z$: fase $= +45^\circ$

                • $\omega > 10\omega_z$: fase $\approx +90^\circ$

                \vspace{0.05cm}
                Transizione lineare tra $\omega_z/10$ e $10\omega_z$

                \vspace{0.15cm}
                \textbf{4. Contributo dei POLI $(1 + s\tau_p)$:}

                \vspace{0.05cm}
                Transizione centrata in $\omega_p = \frac{1}{\tau_p}$:

                \vspace{0.05cm}
                • $\omega < \omega_p/10$: fase $\approx 0^\circ$

                • $\omega = \omega_p$: fase $= -45^\circ$

                • $\omega > 10\omega_p$: fase $\approx -90^\circ$

                \vspace{0.05cm}
                Transizione lineare tra $\omega_p/10$ e $10\omega_p$

                \vspace{0.15cm}
                \textbf{5. Tracciamento finale:}

                \vspace{0.05cm}
                a) Parti dalla fase iniziale:

                \vspace{0.03cm}
                \hspace{0.3cm} • Se $T(0) > 0$: parte da $0^\circ + 90^\circ \cdot n$

                \hspace{0.3cm} • Se $T(0) < 0$: parte da $-180^\circ + 90^\circ \cdot n$

                b) Somma algebrica dei contributi di poli e zeri:

                \vspace{0.03cm}
                \hspace{0.3cm} • Zeri: $+90^\circ$ asintoticamente (transizione da $\omega_z/10$ a $10\omega_z$)

                \hspace{0.3cm} • Poli: $-90^\circ$ asintoticamente (transizione da $\omega_p/10$ a $10\omega_p$)

                c) I contributi si \textbf{sovrappongono} se poli/zeri sono vicini

                \vspace{0.2cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ ERRORE COMUNE}

                    \vspace{0.05cm}
                    Nel modulo, le pendenze si \textbf{sommano} ad ogni polo/zero

                    \vspace{0.05cm}
                    Nella fase, i contributi si \textbf{sovrappongono} (somma algebrica delle fasi)
                }}

            \end{minipage}
        };
        %------------ Bode Fase Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Bode - Diagramma della Fase};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Intersezione 0 dB in Bode ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Problema:} Il diagramma passa vicino a 0 dB nei pressi di una singolarità. Interseca prima o dopo?

                \vspace{0.2cm}
                \textbf{Regola di Conservazione Guadagno-Frequenza:}

                \vspace{0.1cm}
                Su un tratto con pendenza costante di $m$ dB/dec, vale:

                \vspace{0.05cm}
                $$|T(\omega)| \cdot \omega^{m/20} = \text{costante}$$

                \vspace{0.15cm}
                \textbf{Metodo pratico (verifica per ipotesi):}

                \vspace{0.1cm}
                \textbf{IPOTESI:} Supponi che la retta continui \textbf{indisturbata} con la stessa pendenza (cioè che interseca 0 dB PRIMA della singolarità)

                \vspace{0.1cm}
                \textbf{1.} Identifica un punto noto sul tratto: $(\omega_1, |T(\omega_1)|)$

                \vspace{0.05cm}
                \hspace{0.3cm} Es: a basse frequenze, spesso $|T(0)| = K$

                \vspace{0.1cm}
                \textbf{2.} Con pendenza $m$ dB/dec costante, calcola $\omega_0$ dove $|T| = 1$:

                \vspace{0.05cm}
                $$\omega_0 = \omega_1 \cdot |T(\omega_1)|^{20/m}$$

                \vspace{0.05cm}
                {\tiny
                \textbf{ATTENZIONE:} $|T(\omega_1)|$ in \textbf{scala LINEARE}, non in dB!

                Se hai il valore in dB: $|T| = 10^{(\text{dB}/20)}$
                }

                \vspace{0.1cm}
                \textbf{3.} Confronta $\omega_0$ con la singolarità $\omega_s$:

                \vspace{0.05cm}
                • Se $\omega_0 < \omega_s$: ipotesi \textbf{CORRETTA} → interseca prima

                \hspace{0.4cm} La retta raggiunge 0 dB prima di cambiare pendenza

                \vspace{0.05cm}
                • Se $\omega_0 > \omega_s$: ipotesi \textbf{ERRATA} → interseca dopo

                \hspace{0.4cm} La pendenza cambia prima di raggiungere 0 dB

                \vspace{0.2cm}
                \textbf{Casi comuni:}

                \vspace{0.1cm}
                \textbf{Pendenza 0 dB/dec} ($m = 0$): costante, già noto

                \vspace{0.1cm}
                \textbf{Pendenza $-20$ dB/dec} ($m = -20$):

                \vspace{0.05cm}
                $$\omega_0 = \omega_1 \cdot |T(\omega_1)|$$

                \vspace{0.05cm}
                Questa è la formula del \textbf{GBW} (Guadagno di Banda)!

                \vspace{0.1cm}
                \textbf{Pendenza $+20$ dB/dec} ($m = +20$):

                \vspace{0.05cm}
                $$\omega_0 = \frac{\omega_1}{|T(\omega_1)|}$$

                \vspace{0.2cm}
                {\footnotesize
                \textbf{$\bigstar$ UTILITÀ PRATICA}

                \vspace{0.05cm}
                Questo metodo evita di dover disegnare con precisione il diagramma per capire l'ordine di intersezione e singolarità, garantendo il tracciamento corretto dopo entrambi i punti.
                }

            \end{minipage}
        };
        %------------ Intersezione 0 dB Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Intersezione 0 dB in Bode};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Calcolo Guadagno a Frequenze Specifiche ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Quando ti chiedono il guadagno a una frequenza specifica:}

                \vspace{0.2cm}
                \textbf{CASO 1: Lontano dalle singolarità ($\geq 1$ decade)}

                \vspace{0.1cm}
                Usa il \textbf{diagramma sintotico} (approssimazione):

                \vspace{0.05cm}
                • Se $\omega < \omega_p/10$ o $\omega > 10\omega_p$: il polo/zero ha effetto trascurabile

                • Leggi il valore dal diagramma asintotico con la pendenza corrente

                \vspace{0.05cm}
                \textit{Esempio:} Con pendenza $-20$ dB/dec da $\omega_1$ a $\omega_2$:

                \vspace{0.05cm}
                $$|T(\omega_2)|_{\text{dB}} = |T(\omega_1)|_{\text{dB}} - 20\log_{10}\left(\frac{\omega_2}{\omega_1}\right)$$

                \vspace{0.2cm}
                \textbf{CASO 2: Esattamente sulla singolarità ($\omega = \omega_p$ o $\omega_z$)}

                \vspace{0.1cm}
                Usa le \textbf{formule esatte}:

                \vspace{0.1cm}
                \textbf{Modulo:}

                \vspace{0.05cm}
                • Polo: $|1 + j\omega_p\tau_p| = |1 + j| = \sqrt{2}$ → $\boxed{-3 \text{ dB}}$

                • Zero: $|1 + j\omega_z\tau_z| = |1 + j| = \sqrt{2}$ → $\boxed{+3 \text{ dB}}$

                \vspace{0.1cm}
                \textbf{Fase:}

                \vspace{0.05cm}
                • Polo: $\angle(1 + j\omega_p\tau_p) = \arctan(1)$ → $\boxed{-45^\circ}$

                • Zero: $\angle(1 + j\omega_z\tau_z) = \arctan(1)$ → $\boxed{+45^\circ}$

                \vspace{0.2cm}
                \textbf{CASO 3: Vicino alle singolarità ($< 1$ decade ma $\neq$ singolarità)}

                \vspace{0.1cm}
                Usa i \textbf{numeri complessi}, sostituendo $s = j\omega$:

                \vspace{0.05cm}
                $$T(j\omega) = K \cdot (j\omega)^n \cdot \frac{(1 + j\omega\tau_{z1})(1 + j\omega\tau_{z2})\cdots}{(1 + j\omega\tau_{p1})(1 + j\omega\tau_{p2})\cdots}$$

                \vspace{0.1cm}
                1. Sostituisci il valore numerico di $\omega$

                2. Calcola ogni termine: $|1 + j\omega\tau| = \sqrt{1 + (\omega\tau)^2}$

                3. Moltiplica/dividi i moduli per ottenere $|T(j\omega)|$

                4. Converti in dB: $20\log_{10}|T(j\omega)|$

                \vspace{0.2cm}
                {\footnotesize
                \textbf{Regola pratica:}

                \vspace{0.05cm}
                • Lontano → diagramma sintotico (veloce)

                • Esattamente sopra → $\pm 3$ dB, $\pm 45^\circ$ (immediato)

                • Vicino → numeri complessi (calcolo esatto)
                }

            \end{minipage}
        };
        %------------ Calcolo Guadagno Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Calcolo Guadagno a Frequenze Specifiche};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Guadagno Reale vs Ideale ---------------

    \resizebox{0.72\linewidth}{!}{%
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{\color{red!70!black}$\bigstar$ ESAME: Calcolo del GUADAGNO REALE}
                }}

                \vspace{0.2cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Calcolo del guadagno d'anello $G_{loop}$:}

                    \vspace{0.1cm}
                    1. \textbf{Spegni tutti i generatori} (incluso $V_{in}$!)

                    2. \textbf{Taglia l'anello} (apri il feedback)

                    3. Inserisci generatore di test $V_t$ nel punto di taglio

                    4. Usa la caratteristica dell'OpAmp:

                    \hspace{0.5cm} $V_y = A(s) \cdot (V^+ - V^-)$ \quad con $A(s) = \frac{A_0}{1 + s\tau_0}$

                    5. Scrivi $G_{loop} = \frac{V_y}{V_t}$

                    \vspace{0.1cm}
                    $$\boxed{G_{loop} = \frac{V_y}{V_t} = A(s) \cdot \beta}$$

                    \vspace{0.1cm}
                    \textbf{$A(s)$} = \textbf{guadagno ad anello aperto} dell'OpAmp:

                    $$A(s) = \frac{A_0}{1 + s\tau_0}$$

                    • $A_0 = A(0)$ = guadagno a freq. 0 (punto partenza Bode, $\sim 10^5$-$10^6$)

                    • $\tau_0 = \frac{1}{\omega_p}$ = costante di tempo polo dominante

                    \hspace{0.5cm} {\footnotesize (polo dominante = polo a freq. pi\`u bassa)}

                    \vspace{0.15cm}
                    \textbf{GBWP} (Gain-Bandwidth Product):
                    $$\boxed{\text{GBWP} = A_0 \cdot f_0}$$

                    {\footnotesize dove $f_0 = \frac{1}{2\pi\tau_0}$ = frequenza del polo. In questo corso gli OpAmp hanno \textbf{sempre una singola singolarit\`a}.}

                    \vspace{0.1cm}
                    \textbf{$\beta$} = fattore di retroazione (dipende da $R_f$, $R_G$)
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ ATTENZIONE: $V^+ = V^-$ NON vale qui!}

                    \vspace{0.05cm}
                    L'ipotesi $V^+ = V^-$ \`e valida \textbf{solo per OpAmp retroazionati} (ideali in catena chiusa).

                    \vspace{0.05cm}
                    Nel calcolo di $G_{loop}$ l'anello \`e \textbf{aperto} $\Rightarrow$ devi usare $V_{out} = A(s) \cdot (V^+ - V^-)$
                }}

                \vspace{0.2cm}
                \textbf{Relazione tra i guadagni:}

                \vspace{0.1cm}
                $$\boxed{G_A = -G_{loop} \cdot G_{id}}$$

                \vspace{0.05cm}
                \small
                $G_A$ = guadagno di andata, $G_{loop}$ = guadagno d'anello, $G_{id}$ = guadagno ideale

                \vspace{0.2cm}
                \textbf{Formula guadagno reale:}

                \vspace{0.1cm}
                $$\boxed{G_{\text{reale}} = \frac{G_{\text{ideale}}}{1 - \frac{1}{G_{loop}}}}$$

                \vspace{0.25cm}
                \textbf{$\bigstar$ METODO GRAFICO (pi\`u veloce!)}

                \vspace{0.1cm}
                \textbf{Procedimento:}

                \vspace{0.05cm}
                1. Traccia il Bode del \textbf{guadagno ideale} $G_{id}$

                \vspace{0.05cm}
                2. Traccia il Bode del \textbf{guadagno d'andata} $G_A$

                \vspace{0.05cm}
                3. \textbf{Per ogni frequenza}: prendi il \textbf{valore pi\`u BASSO} tra i due grafici

                \vspace{0.1cm}
                $\Rightarrow$ Il risultato \`e il Bode del \textbf{guadagno reale}

                \vspace{0.2cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.55]
                        % Assi
                        \draw[->] (0,0) -- (6,0) node[right] {\tiny $\log\omega$};
                        \draw[->] (0,-0.5) -- (0,3.5) node[above] {\tiny dB};

                        % Guadagno ideale (costante)
                        \draw[thick, blue, dashed] (0,2.5) -- (5.5,2.5);
                        \node[blue, anchor=west] at (5.6,2.5) {\tiny $G_{id}$};

                        % Guadagno d'andata (scende)
                        \draw[thick, orange, dashed] (0,3) -- (1.5,3) -- (4.5,0.5);
                        \node[orange, anchor=west] at (4.6,0.8) {\tiny $G_A$};

                        % Guadagno reale (minimo dei due)
                        \draw[very thick, red] (0,2.5) -- (2,2.5) -- (4.5,0.5);
                        \node[red, anchor=north] at (3,1.2) {\tiny $G_{reale}$};

                        % Punto di intersezione
                        \fill (2,2.5) circle (2pt);
                    \end{tikzpicture}
                \end{center}

                \vspace{0.1cm}
                {\footnotesize
                \textbf{Perch\'e funziona:}

                \vspace{0.05cm}
                • Se $|G_{loop}| \gg 1$: $G_{reale} \approx G_{id}$

                • Se $|G_{loop}| \ll 1$: $G_{reale} \approx G_A$ (segue l'andata)

                \vspace{0.05cm}
                $\Rightarrow$ Il guadagno reale \`e \textbf{limitato} dal pi\`u piccolo dei due!
                }

            \end{minipage}
        };
        %------------ Guadagno Reale Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Guadagno Reale vs Ideale};
    \end{tikzpicture}%
    }

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Guadagno Reale - Attenzione alle Intersezioni ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \colorbox{red!30}{\parbox{0.95\linewidth}{
                    \textbf{\color{red!70!black}$\triangle$ ATTENZIONE alle INTERSEZIONI}
                }}

                \vspace{0.15cm}
                \textbf{Problema tipico:}

                $G_A$ e $G_{id}$ hanno zeri/poli a frequenze diverse $\Rightarrow$ le intersezioni possono essere \textbf{non ovvie}.

                \vspace{0.15cm}
                \textbf{Caso comune:}

                \vspace{0.05cm}
                • $G_A$ sale poi diventa piatto (a un certo valore)

                • $G_{id}$ sale poi diventa piatto (a valore \textbf{diverso})

                \vspace{0.1cm}
                \textbf{Domanda:} L'intersezione \`e \textbf{prima} o \textbf{dopo} il prossimo polo?

                \vspace{0.15cm}
                \textbf{Metodo per ipotesi:}

                \vspace{0.1cm}
                1. \textbf{Fai un'ipotesi} su quale tratto (salita/discesa/piatto) interseca

                \vspace{0.05cm}
                2. Usa le \textbf{regole di navigazione}:

                \hspace{0.3cm} • Discesa: $G \cdot f = \text{cost}$

                \hspace{0.3cm} • Salita: $G / f = \text{cost}$

                \vspace{0.05cm}
                3. Calcola la frequenza di intersezione $f_x$

                \vspace{0.05cm}
                4. \textbf{Verifica:} Se $f_x$ viene \textbf{pi\`u alta} del polo successivo $\Rightarrow$ \textbf{ipotesi sbagliata!}

                \hspace{0.3cm} Rifai con pendenza diversa (es: crescente invece che decrescente)

                \vspace{0.15cm}
                \textbf{Alla fine:}

                Per ogni frequenza, evidenzia il \textbf{punto pi\`u basso} tra $G_A$ e $G_{id}$ $\Rightarrow$ ottieni $G_{reale}$

                \vspace{0.2cm}
                {\footnotesize
                \textbf{$\bigstar$ NOTA su $A_0$ e GBW:}

                \vspace{0.05cm}
                Se \textbf{non viene dato} $A_0$ ma viene dato $\tau_0$:

                \vspace{0.05cm}
                • Potrebbe essere dato il \textbf{GBW} (prodotto guadagno-banda)

                • Oppure c'\`e un altro modo per risolvere l'esercizio

                \vspace{0.05cm}
                Ricorda: $\text{GBW} = A_0 \cdot \omega_p = A_0 / \tau_0$
                }

                \vspace{0.15cm}
                {\footnotesize
                \textbf{Calcolo analitico di $G_{id}$:}

                \vspace{0.05cm}
                Se richiesto esplicitamente, pu\`o portare a \textbf{equazioni di 2° grado in $s$} (conti lunghi).

                \vspace{0.05cm}
                $\Rightarrow$ Raramente richiesto all'esame.
                }

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Guadagno Reale - Intersezioni};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Margine di Fase e Stabilità ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{\color{red!70!black}$\bigstar$ MARGINE DI FASE e STABILIT\`A}
                }}

                \vspace{0.2cm}
                \textbf{Procedimento:}

                \vspace{0.1cm}
                1. Disegna il Bode di $G_{loop}$ (modulo e fase)

                \vspace{0.05cm}
                2. Trova la \textbf{frequenza di crossover} $f_c$:

                \hspace{0.3cm} frequenza dove $|G_{loop}| = 0$ dB (taglia l'asse \textbf{orizzontale})

                \vspace{0.05cm}
                3. Leggi la \textbf{fase} di $G_{loop}$ a $f_c$: $\phi(f_c)$

                \vspace{0.05cm}
                4. Calcola il \textbf{margine di fase}:

                \vspace{0.1cm}
                $$\boxed{\text{PM} = 360° + \phi(f_c)}$$

                \vspace{0.1cm}
                \textbf{Formula esplicita per $\phi(f_c)$:}

                $$\boxed{\phi(f_c) = 180^\circ - \sum_i \arctan\left(\frac{f_c}{f_{pi}}\right) + \sum_j \arctan\left(\frac{f_c}{f_{zj}}\right)}$$

                \vspace{0.1cm}
                {\footnotesize
                • $f_c$ = frequenza di crossover (dove $|G_{loop}| = 0$ dB)

                • $f_{pi}$ = frequenza del polo $i$-esimo

                • $f_{zj}$ = frequenza dello zero $j$-esimo

                \vspace{0.05cm}
                I poli \textbf{sottraggono} fase, gli zeri \textbf{aggiungono} fase.
                }

                \vspace{0.2cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{Classificazione della stabilit\`a:}

                    \vspace{0.1cm}
                    \begin{tabular}{|c|c|}
                        \hline
                        \textbf{Margine di Fase} & \textbf{Sistema} \\
                        \hline
                        PM $> 45°$ & \textbf{Asintoticamente stabile} \\
                        \hline
                        PM $= 0°$ & \textbf{Criticamente stabile} \\
                        \hline
                        PM $< 0°$ & \textbf{Instabile} \\
                        \hline
                    \end{tabular}
                }}

                \vspace{0.2cm}
                {\footnotesize
                \textbf{$\triangle$ NOTA PRATICA:}

                \vspace{0.05cm}
                • PM $\approx 60°$-$70°$: risposta ben smorzata

                • PM $\approx 45°$: leggero overshoot

                • PM $< 45°$: oscillazioni/overshoot significativo

                \vspace{0.05cm}
                \textbf{Regola:} Pi\`u alto il PM, pi\`u stabile il sistema
                }

                \vspace{0.15cm}
                \colorbox{red!40}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ SISTEMA CON 2 POLI PRIMA DI $f_c$:}

                    \vspace{0.05cm}
                    Se $f_c$ viene \textbf{dopo} entrambi i poli (cio\`e $f_{p1}, f_{p2} < f_c$):

                    \vspace{0.05cm}
                    $\Rightarrow$ Sistema \textbf{SICURAMENTE INSTABILE}

                    \vspace{0.05cm}
                    {\tiny (fase gi\`a a $-180°$ prima del taglio)}
                }}

                \vspace{0.15cm}
                \colorbox{orange!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ $f_c$ a meno di 1 decade dal 2° polo:}

                    \vspace{0.05cm}
                    Se $f_{p1} < f_c < f_{p2}$ ma $f_c < 10 \cdot f_{p2}$:

                    \vspace{0.05cm}
                    $\Rightarrow$ Il grafico \textbf{ideale} della fase \textbf{NON \`e affidabile!}

                    \vspace{0.05cm}
                    $\Rightarrow$ Devi calcolare il \textbf{PM analiticamente} con gli $\arctan$

                    \vspace{0.1cm}
                    \textbf{Verifica:} $f_c > 10 \cdot f_{p2}$? $\Rightarrow$ OK grafico ideale

                    \vspace{0.05cm}
                    Es: $f_{p2} = 15.92$ kHz $\Rightarrow$ serve $f_c > 159.2$ kHz

                    Se $f_c = 90.9$ kHz $<$ 159.2 kHz $\Rightarrow$ \textbf{calcolo analitico!}
                }}

                \vspace{0.15cm}
                {\footnotesize
                \textbf{Interpretazione grafica:}

                \vspace{0.05cm}
                Il margine di fase \`e ``quanto manca'' alla fase per raggiungere $-360°$ (o $-180°$ in alcuni testi) quando il guadagno vale 0 dB.

                \vspace{0.05cm}
                Se la fase \`e gi\`a oltre $-360°$ quando $|G| = 0$ dB $\Rightarrow$ sistema \textbf{instabile}
                }

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Margine di Fase e Stabilit\`a};
    \end{tikzpicture}

    \newpage

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ OpAmp - Retroazione e Saturazione ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Retroazione e Saturazione dell'OpAmp}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{RETROAZIONE NEGATIVA}

                    \vspace{0.1cm}
                    \textbf{Condizione:} $V_{out}$ ritorna su $V^-$ (morsetto invertente)

                    \vspace{0.1cm}
                    \textbf{Comportamento:}
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item Sistema \textbf{STABILE}
                        \item L'OpAmp \textbf{NON satura} (lavora in zona lineare)
                        \item Vale l'ipotesi: $\boxed{V^+ = V^-}$
                        \item Vale l'ipotesi: $I^+ = I^- = 0$
                    \end{itemize}

                    \vspace{0.1cm}
                    $\Rightarrow$ Usare le formule degli amplificatori (inv, non-inv, sommatore...)
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{RETROAZIONE POSITIVA}

                    \vspace{0.1cm}
                    \textbf{Condizione:} $V_{out}$ ritorna su $V^+$ (morsetto non invertente)

                    \vspace{0.1cm}
                    \textbf{Comportamento:}
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item Sistema \textbf{INSTABILE / BISTABILE}
                        \item L'OpAmp \textbf{SATURA} sempre!
                        \item $V_{out} = +V_{sat}$ oppure $V_{out} = -V_{sat}$
                        \item \textbf{NON vale} $V^+ = V^-$
                    \end{itemize}

                    \vspace{0.1cm}
                    $\Rightarrow$ L'uscita si comporta come \textbf{generatore indipendente}!
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Come capire DOVE satura:}

                    \vspace{0.1cm}
                    Con retroazione positiva, confronta $V^+$ e $V^-$:

                    \vspace{0.1cm}
                    • Se $V^+ > V^-$ $\Rightarrow$ $\boxed{V_{out} = +V_{sat}}$

                    • Se $V^+ < V^-$ $\Rightarrow$ $\boxed{V_{out} = -V_{sat}}$

                    \vspace{0.1cm}
                    {\footnotesize L'OpAmp ``amplifica'' la differenza $V^+ - V^-$ fino a saturare!}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ REGOLA PRATICA - Riconoscimento:}

                    \vspace{0.1cm}
                    \textbf{Guarda dove va $V_{out}$:}

                    \vspace{0.05cm}
                    • $V_{out}$ torna su $V^-$ $\Rightarrow$ Retroaz. \textbf{NEGATIVA} $\Rightarrow$ \textbf{NON satura}

                    • $V_{out}$ torna su $V^+$ $\Rightarrow$ Retroaz. \textbf{POSITIVA} $\Rightarrow$ \textbf{SATURA}

                    \vspace{0.1cm}
                    {\footnotesize (Se non c'è retroazione, l'OpAmp è in \textbf{anello aperto} e satura!)}
                }}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ Caso COMPARATORE (no retroazione):}

                    \vspace{0.05cm}
                    Senza retroazione, l'OpAmp ha guadagno $A_0 \to \infty$:

                    $\Rightarrow$ Anche una piccola differenza $V^+ - V^-$ porta a saturazione!

                    $\Rightarrow$ $V_{out} = +V_{sat}$ se $V^+ > V^-$, altrimenti $V_{out} = -V_{sat}$
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}OpAmp - Retroazione e Saturazione};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ OpAmp - Riconoscere la Configurazione ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Come Riconoscere la Configurazione}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ REGOLA FONDAMENTALE:}

                    \vspace{0.1cm}
                    \textbf{Retroazione} = esiste un \textbf{percorso} da $V_{out}$ verso un ingresso dell'OpAmp.

                    \vspace{0.1cm}
                    Il percorso può passare attraverso:
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item Resistenze ($R_f$)
                        \item Condensatori
                        \item Reti di componenti
                        \item Collegamento diretto (buffer)
                    \end{itemize}

                    \vspace{0.05cm}
                    $\Rightarrow$ \textbf{Non serve} collegamento diretto!
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{PASSO 1: C'è retroazione?}

                    \vspace{0.1cm}
                    Parti da $V_{out}$ e chiediti:

                    ``Posso raggiungere $V^+$ o $V^-$ seguendo un percorso?''

                    \vspace{0.1cm}
                    • \textbf{SÌ} $\Rightarrow$ C'è retroazione (vai al passo 2)

                    • \textbf{NO} $\Rightarrow$ \textbf{Anello aperto} (comparatore) $\Rightarrow$ SATURA!
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{PASSO 2: Su quale morsetto arriva?}

                    \vspace{0.1cm}
                    Segui il percorso da $V_{out}$:

                    \vspace{0.1cm}
                    • Arriva su $V^-$ $\Rightarrow$ \textbf{Retroazione NEGATIVA}

                    \hspace{0.3cm} $\Rightarrow$ Stabile, NON satura, vale $V^+ = V^-$

                    \vspace{0.1cm}
                    • Arriva su $V^+$ $\Rightarrow$ \textbf{Retroazione POSITIVA}

                    \hspace{0.3cm} $\Rightarrow$ Bistabile, SATURA, Trigger di Schmitt
                }}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ ATTENZIONE - Casi misti:}

                    \vspace{0.05cm}
                    Se $V_{out}$ arriva su \textbf{ENTRAMBI} $V^+$ e $V^-$:

                    $\Rightarrow$ Analizza quale retroazione \textbf{domina}

                    $\Rightarrow$ Di solito la negativa (se $R_f$ su $V^-$ è più ``forte'')
                }}

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ TRUCCO VELOCE:}

                    \vspace{0.05cm}
                    Guarda la resistenza di feedback $R_f$:

                    • $R_f$ collega $V_{out}$ a $V^-$ $\Rightarrow$ Amplificatore (inv/non-inv)

                    • $R_f$ collega $V_{out}$ a $V^+$ $\Rightarrow$ Trigger di Schmitt

                    • Nessuna $R_f$ $\Rightarrow$ Comparatore (satura!)
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}OpAmp - Riconoscere Configurazione};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ OpAmp - Saturazione dell'Uscita ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Saturazione dell'Uscita dell'OpAmp}

                \vspace{0.1cm}
                L'uscita dell'OpAmp \textbf{non può superare} le tensioni di alimentazione!

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Limiti di saturazione:}

                    \vspace{0.1cm}
                    $$\boxed{-V_{sat} \leq V_{out} \leq +V_{sat}}$$

                    \vspace{0.1cm}
                    • $+V_{sat} \approx +V_{DD}$ (alimentazione positiva)

                    • $-V_{sat} \approx -V_{SS}$ (o $\approx 0V$ se alim. singola)

                    \vspace{0.05cm}
                    {\footnotesize (OpAmp reali: $V_{sat} \approx V_{alim} - 1V \div 2V$)}
                }}

                \vspace{0.15cm}
                \textbf{Caratteristica $V_{out}$ vs $V_{in}$:}

                \vspace{0.1cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.6]
                        % Axes
                        \draw[->] (-2.5,0) -- (2.5,0) node[right] {\footnotesize $V_{in}$};
                        \draw[->] (0,-2) -- (0,2.5) node[above] {\footnotesize $V_{out}$};
                        % Saturation levels (dashed lines)
                        \draw[dashed, red, thick] (-2.5,1.5) -- (2.5,1.5) node[right] {\tiny $+V_{sat}$};
                        \draw[dashed, red, thick] (-2.5,-1.5) -- (2.5,-1.5) node[right] {\tiny $-V_{sat}$};
                        % Linear region + saturation (amplifier characteristic)
                        \draw[thick, blue] (-2.5,-1.5) -- (-0.5,-1.5) -- (0.5,1.5) -- (2.5,1.5);
                        % Labels
                        \node[blue] at (-1.5,-1.8) {\tiny sat.};
                        \node[blue] at (0,-0.5) {\tiny lin.};
                        \node[blue] at (1.5,1.8) {\tiny sat.};
                    \end{tikzpicture}
                \end{center}

                \vspace{0.05cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    I \textbf{trattini orizzontali} (- - -) indicano i livelli di saturazione: l'uscita \textbf{si appiattisce} e non segue più l'ingresso!
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{Zona LINEARE} (tra le saturazioni):

                    \vspace{0.1cm}
                    $$V_{out} = A_v \cdot V_{in}$$

                    L'OpAmp amplifica normalmente (pendenza = guadagno $A_v$)
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{Zona di SATURAZIONE:}

                    \vspace{0.1cm}
                    • \textbf{Saturazione ALTA:} $V_{out} = +V_{sat}$ (costante)

                    \hspace{0.3cm} Si verifica quando $V_{in}$ è ``troppo positivo''

                    \vspace{0.05cm}
                    • \textbf{Saturazione BASSA:} $V_{out} = -V_{sat}$ (costante)

                    \hspace{0.3cm} Si verifica quando $V_{in}$ è ``troppo negativo''

                    \vspace{0.1cm}
                    $\Rightarrow$ L'uscita \textbf{non cambia} anche se $V_{in}$ varia!
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ Quando verificare la saturazione:}

                    \vspace{0.05cm}
                    Dopo aver calcolato $V_{out}$ con le formule, controlla:

                    $$\text{Se } V_{out,calc} > +V_{sat} \Rightarrow V_{out} = +V_{sat}$$
                    $$\text{Se } V_{out,calc} < -V_{sat} \Rightarrow V_{out} = -V_{sat}$$

                    \vspace{0.05cm}
                    $\Rightarrow$ Le formule valgono \textbf{solo} se $V_{out}$ resta nella zona lineare!
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}OpAmp - Saturazione dell'Uscita};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ OpAmp - Retroazione Negativa ---------------

    \resizebox{0.8\linewidth}{!}{%
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Amplificatore Invertente:}

                \vspace{0.15cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.7]
                        % OpAmp
                        \draw (2,1.5) node[op amp, noinv input up] (opamp) {};
                        % Input
                        \draw (opamp.-) -- ++(-0.5,0) to[R, l=$R_1$] ++(-1.5,0) node[left] {$V_{in}$};
                        % Feedback
                        \draw (opamp.-) -- ++(0,1.2) to[R, l=$R_f$] ++(2.2,0) -| (opamp.out);
                        % Ground on +
                        \draw (opamp.+) -- ++(-0.3,0) node[ground] {};
                        % Output
                        \draw (opamp.out) -- ++(0.5,0) node[right] {$V_{out}$};
                        % Labels
                        \node at (opamp.-) [above left] {\tiny $V^-$};
                        \node at (opamp.+) [below left] {\tiny $V^+$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.1cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    $$\boxed{V_{out} = -\frac{R_f}{R_1} V_{in}}$$

                    \vspace{0.05cm}
                    Guadagno: $A_v = -\frac{R_f}{R_1}$ \hspace{0.3cm} (segno $-$ = inversione)

                    \vspace{0.05cm}
                    {\footnotesize $R_1$ = impedenza di \textbf{ingresso} (tra $V_{in}$ e $V^-$)}
                }}

                \vspace{0.25cm}
                \textbf{Amplificatore Non Invertente:}

                \vspace{0.15cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.7]
                        % OpAmp
                        \draw (2,1.5) node[op amp, noinv input up] (opamp) {};
                        % Input on +
                        \draw (opamp.+) -- ++(-0.5,0) node[left] {$V_{in}$};
                        % Feedback network
                        \draw (opamp.-) -- ++(0,-0.8) coordinate (fb);
                        \draw (fb) to[R, l_=$R_1$] ++(0,-1.2) node[ground] {};
                        \draw (fb) to[R, l=$R_f$] ++(2,0) -| (opamp.out);
                        % Output
                        \draw (opamp.out) -- ++(0.5,0) node[right] {$V_{out}$};
                        % Labels
                        \node at (opamp.-) [above left] {\tiny $V^-$};
                        \node at (opamp.+) [above left] {\tiny $V^+$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.1cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    $$\boxed{V_{out} = \left(1 + \frac{R_f}{R_1}\right) V_{in}}$$

                    \vspace{0.05cm}
                    Guadagno: $A_v = 1 + \frac{R_f}{R_1}$ \hspace{0.3cm} (sempre $\geq 1$)

                    \vspace{0.05cm}
                    {\footnotesize $R_1$ = impedenza verso \textbf{GND} (tra $V^-$ e massa)}
                }}

                \vspace{0.25cm}
                \textbf{Buffer (Voltage Follower):}

                \vspace{0.1cm}
                Caso speciale: $R_f = 0$, $R_1 \to \infty$ (aperto)

                \vspace{0.05cm}
                $$\boxed{V_{out} = V_{in}} \quad (A_v = 1)$$

                Alta impedenza di ingresso, bassa impedenza di uscita.

                \vspace{0.2cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ IPOTESI OpAmp IDEALE}

                    \vspace{0.05cm}
                    • $V^+ = V^-$ (massa virtuale se $V^+ = 0$)

                    • $I^+ = I^- = 0$ (corrente negli ingressi nulla)

                    • Guadagno ad anello aperto $A \to \infty$
                }}

                \vspace{0.2cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ ATTENZIONE: $R_1$ ha significato DIVERSO!}

                    \vspace{0.1cm}
                    \textbf{INVERTENTE:}

                    $R_1$ = $Z_{in}$ = impedenza di \textbf{ingresso}

                    (tra $V_{in}$ e $V^-$, NON c'\`e $R$ verso GND)

                    \vspace{0.1cm}
                    \textbf{NON INVERTENTE:}

                    $R_1$ = $Z_G$ = impedenza verso \textbf{ground}

                    (tra $V^-$ e massa, $V_{in}$ entra direttamente su $V^+$)

                    \vspace{0.1cm}
                    $\Rightarrow$ Stessa formula $\frac{R_f}{R_1}$, ma $R_1$ \`e diversa!
                }}

            \end{minipage}
        };
        %------------ OpAmp Retroazione Negativa Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}OpAmp - Retroazione Negativa};
    \end{tikzpicture}%
    }

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ OpAmp - Riconoscimento Rapido Configurazioni ---------------

    \resizebox{0.8\linewidth}{!}{%
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{$A_v$ = Guadagno di tensione:} \quad $\boxed{V_{out} = A_v \cdot V_{in}}$

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{\color{red!70!black}$\bigstar$ REGOLA D'ORO - Riconoscimento al volo}

                    \vspace{0.1cm}
                    \textbf{Dove entra il segnale $V_{in}$?}

                    \vspace{0.1cm}
                    \begin{tabular}{|c|c|}
                        \hline
                        \textbf{Entra su $V^-$} & \textbf{Entra su $V^+$} \\
                        \hline
                        INVERTENTE & NON INVERTENTE \\
                        $A_v = -\frac{R_f}{R_G}$ & $A_v = 1 + \frac{R_f}{R_G}$ \\
                        \hline
                    \end{tabular}
                }}

                \vspace{0.25cm}
                \textbf{Procedimento rapido:}

                \vspace{0.1cm}
                \textbf{1. INVERTENTE} ($V_{in}$ su $V^-$, $V^+$ a massa)

                \vspace{0.1cm}
                \begin{enumerate}[leftmargin=*, itemsep=2pt]
                    \item $V^+ = 0$ (a massa) $\Rightarrow$ $V^- = 0$ (massa virtuale)
                    \item Corrente in $R_1$: $I = \frac{V_{in} - 0}{R_1} = \frac{V_{in}}{R_1}$
                    \item Stessa $I$ passa in $R_f$ (no corrente in OpAmp)
                    \item $V_{out} = 0 - I \cdot R_f = -\frac{R_f}{R_1} V_{in}$
                \end{enumerate}

                \vspace{0.15cm}
                \textbf{2. NON INVERTENTE} ($V_{in}$ su $V^+$)

                \vspace{0.1cm}
                \begin{enumerate}[leftmargin=*, itemsep=2pt]
                    \item $V^+ = V_{in}$ $\Rightarrow$ $V^- = V_{in}$
                    \item $V^-$ sta sul partitore $R_1$-$R_f$:
                    $$V^- = V_{out} \cdot \frac{R_1}{R_1 + R_f} = V_{in}$$
                    \item Risolvo: $V_{out} = V_{in} \cdot \frac{R_1 + R_f}{R_1} = \left(1 + \frac{R_f}{R_1}\right) V_{in}$
                \end{enumerate}

                \vspace{0.2cm}
                \textbf{$R_f$ (Feedback) e $R_G$ (Ground) - Definizioni}

                \vspace{0.1cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.55]
                        % OpAmp
                        \draw (2,1.5) node[op amp, noinv input up] (opamp) {};
                        % Rf - feedback
                        \draw (opamp.-) -- ++(0,1) to[R, l=$R_f$, color=red!70!black] ++(2,0) -| (opamp.out);
                        % RG - ground
                        \draw (opamp.-) -- ++(0,-0.6) to[R, l_=$R_G$, color=blue!70!black] ++(0,-1) node[ground] {};
                        % Labels
                        \node[red!70!black, anchor=west] at (4.2,2.5) {\scriptsize \textbf{Feedback}};
                        \node[blue!70!black, anchor=west] at (1.3,-0.8) {\scriptsize \textbf{Ground}};
                        \draw (opamp.out) -- ++(0.3,0) node[right] {\scriptsize $V_{out}$};
                        \draw (opamp.+) -- ++(-0.3,0) node[left] {\scriptsize $V_{in}$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.05cm}
                • \textcolor{red!70!black}{\textbf{$R_f$}} = collega $V^-$ a $V_{out}$ (chiude l'anello)

                • \textcolor{blue!70!black}{\textbf{$R_G$}} = collega $V^-$ a \textbf{massa} (riferimento)

                \vspace{0.1cm}
                \textit{Nota: $R_G$ \`e anche chiamata $R_1$ in molti testi}

                \vspace{0.2cm}
                {\footnotesize
                \textbf{$\triangle$ TRUCCO MNEMONICO}

                \vspace{0.05cm}
                • \textbf{Invertente}: segnale entra sul ``$-$'' $\Rightarrow$ guadagno con ``$-$''

                • \textbf{Non Inv.}: segnale entra sul ``$+$'' $\Rightarrow$ guadagno $\geq 1$ (positivo)

                \vspace{0.1cm}
                \textbf{Formula universale (non inv.):} $\boxed{A_v = 1 + \frac{R_{feedback}}{R_{GND}}}$
                }

                \vspace{0.15cm}
                {\footnotesize
                \textbf{Caso misto (sommatore):}

                Se ci sono \textbf{pi\`u ingressi} su $V^-$ attraverso resistenze diverse:
                $$V_{out} = -R_f \left(\frac{V_1}{R_1} + \frac{V_2}{R_2} + \cdots\right)$$

                Ogni ingresso contribuisce con il proprio rapporto $-\frac{R_f}{R_i}$
                }

            \end{minipage}
        };
        %------------ Riconoscimento Rapido Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}OpAmp - Riconoscimento Rapido};
    \end{tikzpicture}%
    }

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Slew Rate OpAmp ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Definizione:} Lo \textbf{Slew Rate (SR)} è la \textbf{massima velocità} con cui l'uscita di un OpAmp può variare nel tempo.

                \vspace{0.15cm}
                $$\text{SR} = \left|\frac{dV_{out}}{dt}\right|_{\text{max}}$$

                \vspace{0.1cm}
                Unità di misura: $\text{V}/\mu\text{s}$ oppure $\text{V/s}$

                \vspace{0.2cm}
                \textbf{A cosa serve:}

                \vspace{0.1cm}
                Lo slew rate è una \textbf{limitazione fisica} dell'OpAmp reale:

                \vspace{0.05cm}
                • Limita la velocità di risposta dell'amplificatore

                • Se il segnale richiede una variazione più rapida, l'uscita viene \textbf{distorta}

                • Importante per segnali ad alta frequenza o grande ampiezza

                \vspace{0.2cm}
                \textbf{Calcolo e Verifica:}

                \vspace{0.1cm}
                Per un segnale sinusoidale $V_{out}(t) = V_{\text{max}} \sin(\omega t)$:

                \vspace{0.05cm}
                $$\frac{dV_{out}}{dt} = V_{\text{max}} \omega \cos(\omega t)$$

                \vspace{0.1cm}
                La derivata massima è:

                \vspace{0.05cm}
                $$\left|\frac{dV_{out}}{dt}\right|_{\text{max}} = V_{\text{max}} \cdot \omega = 2\pi f V_{\text{max}}$$

                \vspace{0.15cm}
                \textbf{Condizione per evitare distorsione:}

                \vspace{0.05cm}
                $$\boxed{2\pi f V_{\text{max}} \leq \text{SR}}$$

                \vspace{0.1cm}
                Oppure, frequenza massima senza distorsione:

                \vspace{0.05cm}
                $$f_{\text{max}} = \frac{\text{SR}}{2\pi V_{\text{max}}}$$

                \vspace{0.2cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{\color{red}$\bigstar$ IMPORTANTE}

                    \vspace{0.05cm}
                    Se $2\pi f V_{\text{max}} > \text{SR}$:

                    \vspace{0.05cm}
                    • L'uscita NON segue l'ingresso

                    • Si ha distorsione del segnale (tipicamente forma triangolare)

                    \vspace{0.05cm}
                    Lo slew rate è \textbf{indipendente dal guadagno} (caratteristica dell'OpAmp)
                }}

                \vspace{0.2cm}
                \textbf{Esempio pratico:}
 
                \vspace{0.05cm}
                OpAmp con SR = 1 V/$\mu$s, segnale con $V_{\text{max}}$ = 10 V

                \vspace{0.05cm}
                $$f_{\text{max}} = \frac{1 \times 10^6 \text{ V/s}}{2\pi \times 10 \text{ V}} \approx 15.9 \text{ kHz}$$

                \vspace{0.05cm}
                A frequenze superiori, il segnale viene distorto.

            \end{minipage}
        };
        %------------ Slew Rate Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Slew Rate OpAmp};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Risposta al Gradino ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Sistema del primo ordine:}
                $$T(s) = \frac{K}{1 + s\tau}$$

                Dove:
                \begin{itemize}
                    \item $K$ = costante (guadagno statico)
                    \item $\tau$ = costante di tempo (coefficiente di $s$)
                    \item Polo in $\omega_p = \frac{1}{\tau}$
                \end{itemize}

                \vspace{0.15cm}
                \textbf{Risposta al gradino di ampiezza $X_0$:}

                \vspace{0.1cm}
                L'uscita ha andamento \textbf{esponenziale}:

                \vspace{0.1cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    $$y(t) = K \cdot X_0 \cdot \left(1 - e^{-t/\tau}\right)$$
                }}

                \vspace{0.1cm}
                \textbf{Valore asintotico} (per $t \to \infty$):
                $$y_\infty = K \cdot X_0$$

                Dove $X_0$ può essere una tensione o una corrente.

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{
                    \textbf{\color{red}$\triangle$ ATTENZIONE al segno di K:}

                    \vspace{0.05cm}
                    • Se $K > 0$: esponenziale \textbf{crescente} (parte da 0, sale verso $K \cdot X_0$)

                    \vspace{0.05cm}
                    • Se $K < 0$: esponenziale \textbf{decrescente} (parte da 0, scende verso $K \cdot X_0$)
                }}

                \vspace{0.2cm}
                \textbf{Parametri chiave:}

                \vspace{0.05cm}
                • $\tau$ = costante di tempo (si legge direttamente dal denominatore come coefficiente di $s$)

                \vspace{0.05cm}
                • Dopo $t = 5\tau$ l'uscita raggiunge $\approx 99\%$ del valore finale

                \vspace{0.2cm}
                {\footnotesize
                \textbf{Caso con due poli (raro in questo corso):}

                \vspace{0.05cm}
                $$T(s) = \frac{K}{(1 + s\tau_1)(1 + s\tau_2)}$$

                \vspace{0.05cm}
                Se i due poli sono \textbf{ben separati} (uno molto più lento dell'altro), la dinamica è dominata dal \textbf{polo a frequenza minore} (quello con $\tau$ maggiore).

                \vspace{0.05cm}
                In questo caso si può approssimare il sistema come se avesse un solo polo dominante.
                }

            \end{minipage}
        };
        %------------ Risposta al Gradino Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Risposta al Gradino - Sistema 1$^\circ$ Ordine};
    \end{tikzpicture}

    \newpage

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC R2R ---------------

    \resizebox{0.8\linewidth}{!}{%
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{DAC (Digital-to-Analog Converter)}

                \vspace{0.05cm}
                Converte un segnale \textbf{digitale} (N bit) in un segnale \textbf{analogico} (tensione o corrente proporzionale).

                \vspace{0.2cm}
                \textbf{DAC R-2R (Resistor Ladder)}

                \vspace{0.1cm}
                Rete a scala con sole resistenze di valore $R$ e $2R$.

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{Principio: Biforcazione delle Correnti}

                    \vspace{0.1cm}
                    Ad ogni nodo la corrente si \textbf{divide esattamente a met\`a}:

                    \vspace{0.05cm}
                    • Met\`a scende verso il ramo $2R$ (deviatore $S_i$)

                    • Met\`a prosegue orizzontalmente verso il nodo successivo

                    \vspace{0.1cm}
                    \textbf{Perch\'e si divide a met\`a?}

                    \vspace{0.05cm}
                    Ad ogni nodo, la $R_{eq}$ vista ``a destra'' vale $2R$ (propriet\`a della rete R-2R), quindi le due vie hanno \textbf{stessa resistenza} $\Rightarrow$ stessa corrente!

                    \vspace{0.1cm}
                    • $n$ biforcazioni: $I \to \frac{I}{2^n}$
                }}

                \vspace{0.15cm}
                \colorbox{red!30}{\parbox{0.95\linewidth}{
                    \textbf{$\triangle$ Se una resistenza cambia (es. $2R \to R'$):}

                    \vspace{0.1cm}
                    La configurazione R-2R si \textbf{rompe}!

                    \vspace{0.05cm}
                    • La $R_{eq}$ vista dal nodo modificato verso destra \textbf{non \`e pi\`u $2R$}

                    • La corrente \textbf{non si divide pi\`u a met\`a}

                    • Devi ricalcolare con partitore di corrente:

                    \vspace{0.05cm}
                    $$I_{ramo} = I_{tot} \cdot \frac{R_{altro}}{R_{ramo} + R_{altro}}$$
                }}

                \vspace{0.15cm}
                \textbf{$\bigstar$ CASO SEMPLICE: cambio NON sul bit meno significativo}

                \vspace{0.1cm}
                Se la resistenza modificata \textbf{non \`e quella di $S_0$} (LSB):

                \vspace{0.05cm}
                $\Rightarrow$ Il cambio influisce \textbf{solo} sulla corrente di quel ramo!

                \vspace{0.05cm}
                $\Rightarrow$ Le correnti degli \textbf{altri bit restano invariate}

                \vspace{0.1cm}
                \textbf{Calcolo $V_{out}$:}
                $$V_{out} = V_{out,ideale} + \Delta V \cdot S_i$$

                dove $\Delta V$ = errore dovuto al cambio di R, $S_i$ = bit modificato

                \vspace{0.1cm}
                \textbf{$\bigstar$ L'errore c'\`e SOLO se $S_i = 1$!}

                \vspace{0.1cm}
                \textbf{$\triangle$ Se cambia la R di $S_0$ (LSB):} tutte le correnti cambiano!

                \vspace{0.15cm}
                {\footnotesize
                \textbf{$\bigstar$ TRUCCO: Rinomina la corrente!}

                \vspace{0.1cm}
                Per evitare frazioni, chiama la corrente in uscita (quella che va verso $V$ con $R$) con un multiplo di $2^n$:

                \vspace{0.1cm}
                \textbf{Esempio con 3 biforcazioni:}

                \vspace{0.05cm}
                Invece di $I_{out} = \frac{I}{8}$, chiama $I_{out} = 8I$

                \vspace{0.05cm}
                $\Rightarrow$ Le correnti ai nodi saranno $8I$, $4I$, $2I$, $I$ (numeri interi!)
                }

                \vspace{0.15cm}
                \textbf{Procedimento di calcolo:}

                \vspace{0.1cm}
                1. Calcola la \textbf{resistenza equivalente} vista dal generatore $V$

                \vspace{0.05cm}
                2. Se c'\`e una $R$ in serie sotto, sommala a $R_{eq}$

                \vspace{0.05cm}
                3. Calcola $I = \frac{V}{R_{tot}}$

                \vspace{0.05cm}
                4. Segui le biforcazioni per trovare $I_{out}$

            \end{minipage}
        };
        %------------ DAC R2R Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC R-2R (Resistor Ladder)};
    \end{tikzpicture}%
    }

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC R2R - Deviatori e Vout ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Deviatori (Switch):}

                \vspace{0.05cm}
                • $S_i = 1$ $\Rightarrow$ deviatore \textbf{CHIUSO} (corrente passa)

                • $S_i = 0$ $\Rightarrow$ deviatore \textbf{APERTO} (corrente non passa)

                \vspace{0.1cm}
                \textbf{Tutti aperti} ($S_0 = S_1 = S_2 = 0$):

                $R_{eq} = \infty$ $\Rightarrow$ utile per calcolo errore con $V_{offset}$

                \vspace{0.15cm}
                \colorbox{green!30}{\parbox{0.95\linewidth}{
                    \textbf{Formula $V_{out}$ (DAC R-2R a 3 bit):}

                    \vspace{0.1cm}
                    $$V_{out} = -I_F \cdot R_F$$

                    dove $I_F$ = corrente di feedback:

                    \vspace{0.05cm}
                    $$I_F = I \cdot S_0 + 2I \cdot S_1 + 4I \cdot S_2$$

                    \vspace{0.1cm}
                    Quindi:
                    $$\boxed{V_{out} = -I \cdot R_F \cdot (S_0 + 2S_1 + 4S_2)}$$

                    \vspace{0.05cm}
                    {\footnotesize I ``$+$'' funzionano come OR: solo i bit a 1 contribuiscono!}
                }}

            \end{minipage}
        };
        %------------ DAC Deviatori Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC R-2R - Deviatori e $V_{out}$};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC - FSR e LSB ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{FSR e LSB (DAC a N bit):}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{LSB} (Least Significant Bit):

                    \vspace{0.1cm}
                    Tensione corrispondente al bit meno significativo:
                    $$\boxed{\text{LSB} = V_{out}(000...1) = I \cdot R_F}$$
                }}

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{FSR} (Full Scale Range):

                    \vspace{0.1cm}
                    Escursione massima dell'uscita:
                    $$\boxed{\text{FSR} = V_{out,max} - V_{out,min}}$$

                    \vspace{0.1cm}
                    Con $V_{out,min} = 0$ (tutti i bit a 0):
                    $$\text{FSR} = V_{out}(111...1) = \text{LSB} \cdot 2^N$$
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{Relazione LSB-FSR:}

                    \vspace{0.1cm}
                    $$\boxed{\text{LSB} = \frac{\text{FSR}}{2^N}}$$
                }}

                \vspace{0.15cm}
                {\footnotesize
                \textbf{Nota:} Pi\`u bit $N$ $\Rightarrow$ LSB pi\`u piccolo $\Rightarrow$ risoluzione migliore
                }

            \end{minipage}
        };
        %------------ DAC FSR LSB Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC - FSR e LSB};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC - DNL ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{DNL (Differential Non-Linearity)}

                \vspace{0.15cm}
                Misura lo \textbf{scostamento} tra il gradino reale e quello ideale nella caratteristica $V_{out}$ vs $S_{in}$.

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{DNL Assoluta} (in Volt):

                    \vspace{0.1cm}
                    $$\boxed{\text{DNL}_{ABS}(i) = V_{out}(i) - V_{out}(i-1) - \text{LSB}}$$

                    \vspace{0.1cm}
                    \textbf{DNL Relativa} (in LSB):

                    \vspace{0.1cm}
                    $$\boxed{\text{DNL}_{REL}(i) = \frac{\text{DNL}_{ABS}(i)}{\text{LSB}}}$$
                }}

                \vspace{0.15cm}
                \textbf{Caratteristica $V_{out}$ vs $S_{in}$ (word):}

                \vspace{0.1cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.6]
                        % Assi
                        \draw[->] (0,0) -- (5,0) node[right] {\tiny $S_{in}$};
                        \draw[->] (0,0) -- (0,4) node[above] {\tiny $V_{out}$};

                        % Labels asse x
                        \node[below] at (0.5,0) {\tiny 0};
                        \node[below] at (1.5,0) {\tiny 1};
                        \node[below] at (2.5,0) {\tiny 2};
                        \node[below] at (3.5,0) {\tiny 3};
                        \node[below] at (4.5,0) {\tiny ...};

                        % Caratteristica ideale (linea tratteggiata)
                        \draw[dashed, gray] (0.5,0.5) -- (4,3.5);
                        \node[gray, anchor=west] at (4.1,3.5) {\tiny ideale};

                        % Caratteristica reale (punti) - errore sui dispari
                        \filldraw[blue] (0.5,0.5) circle (2pt);
                        \filldraw[red] (1.5,1.3) circle (2pt);
                        \filldraw[blue] (2.5,2.5) circle (2pt);
                        \filldraw[red] (3.5,3.3) circle (2pt);

                        % Annotazione errore
                        \draw[<->, red, thick] (1.5,1.5) -- (1.5,1.3);
                        \node[red, anchor=west] at (1.6,1.4) {\tiny $\Delta V$};
                    \end{tikzpicture}
                \end{center}

            \end{minipage}
        };
        %------------ DAC DNL Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC - DNL (1/2)};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC - DNL (continua) ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Calcolo pratico:}

                \vspace{0.1cm}
                Se l'errore \`e su un \textbf{pattern} (es. tutti i dispari):

                \vspace{0.05cm}
                1. Calcola $V_{out}$ per \textbf{un solo caso} (es. word = 1)

                2. Trova $\text{DNL}_{ABS} = V_{out,reale}(1) - V_{out,ideale}(1)$

                3. Dividi per LSB $\Rightarrow$ $\text{DNL}_{REL}$

                \vspace{0.1cm}
                {\footnotesize \textbf{Nota:} La word 0 \textbf{non si calcola} (nessun gradino precedente)}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\triangle$ ATTENZIONE ai gradini di ``ritorno'':}

                    \vspace{0.1cm}
                    Se da 0$\to$1 ho un gradino di $-\Delta V$ (es. $-100$ mV):

                    \vspace{0.05cm}
                    • $V_{out}(1)$ \`e \textbf{sotto} la retta ideale

                    \vspace{0.1cm}
                    Quando passo da 1$\to$2 (e 2 \`e \textbf{corretto}):

                    \vspace{0.05cm}
                    • Devo ``recuperare'' il $\Delta V$ perso!

                    • Il gradino 1$\to$2 sar\`a di $+\Delta V$ rispetto all'ideale

                    \vspace{0.1cm}
                    $\Rightarrow$ \textbf{DNL alternata}: $-\Delta V$, $+\Delta V$, $-\Delta V$, ...
                }}

                \vspace{0.15cm}
                {\footnotesize
                \textbf{Interpretazione DNL:}

                \vspace{0.05cm}
                • $\text{DNL}_{REL} = 0$ $\Rightarrow$ gradino perfetto

                • $\text{DNL}_{REL} > 0$ $\Rightarrow$ gradino pi\`u grande

                • $\text{DNL}_{REL} < 0$ $\Rightarrow$ gradino pi\`u piccolo

                • $\text{DNL}_{REL} = -1$ $\Rightarrow$ \textbf{missing code}
                }

            \end{minipage}
        };
        %------------ DAC DNL Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC - DNL (2/2)};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC - Dinamica Transizioni ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Dinamica delle Transizioni (OpAmp reale)}

                \vspace{0.15cm}
                \textbf{Caso ideale:} transizione istantanea (gradino perfetto)

                \vspace{0.1cm}
                \textbf{Caso reale:} OpAmp con guadagno finito e polo
                $$A(s) = \frac{A_0}{1 + s\tau_0}$$

                $\Rightarrow$ La transizione \`e un \textbf{esponenziale} con $\tau = \tau_0$

                \vspace{0.15cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.6]
                        % Assi
                        \draw[->] (0,0) -- (5,0) node[right] {\tiny $t$};
                        \draw[->] (0,0) -- (0,3) node[above] {\tiny $V_{out}$};

                        % Gradino ideale
                        \draw[dashed, gray, thick] (0.5,0.5) -- (1.5,0.5) -- (1.5,2.5) -- (4.5,2.5);
                        \node[gray] at (3.5,2.8) {\tiny ideale};

                        % Esponenziale reale
                        \draw[blue, thick] (0.5,0.5) -- (1.5,0.5);
                        \draw[blue, thick, domain=1.5:4.5, samples=50] plot (\x, {2.5 - 2*exp(-(\x-1.5)/0.8)});
                        \node[blue] at (3.5,1.2) {\tiny reale};

                        % Tau
                        \draw[<->, red] (1.5,-0.3) -- (2.3,-0.3);
                        \node[red, below] at (1.9,-0.3) {\tiny $\tau_0$};
                    \end{tikzpicture}
                \end{center}

                \vspace{0.1cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Transizione} (es. da 000 a 100):
                    $$V_{out}(t) = V_{finale} \cdot \left(1 - e^{-t/\tau_0}\right)$$

                    dove $\tau_0$ = costante di tempo del polo dell'OpAmp
                }}

                \vspace{0.1cm}
                {\footnotesize
                \textbf{Nota:} $\tau_0$ limita la \textbf{velocit\`a} del DAC (settling time)
                }

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ Configurazione influenza $G_{loop}$:}

                    \vspace{0.05cm}
                    Al cambiare della \textbf{word} (configurazione deviatori), cambia la $R_{eq}$ vista dall'OpAmp.

                    \vspace{0.05cm}
                    $\Rightarrow$ Cambia il \textbf{guadagno d'anello} $G_{loop}$

                    $\Rightarrow$ Cambia il \textbf{guadagno reale} $G_{reale}$

                    $\Rightarrow$ Cambiano i \textbf{tempi di propagazione}!

                    \vspace{0.05cm}
                    \textbf{Conseguenza:} Il settling time \textbf{dipende dalla word}
                }}

            \end{minipage}
        };
        %------------ DAC Dinamica Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC - Dinamica Transizioni (OpAmp reale)};
    \end{tikzpicture}

    \newpage

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC a Correnti Pesate ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{DAC a Correnti Pesate}

                \vspace{0.05cm}
                Ogni bit controlla un \textbf{generatore di corrente} con peso binario. Le correnti vengono sommate e convertite in tensione.

                \vspace{0.2cm}
                \textbf{Principio di funzionamento:}

                \vspace{0.1cm}
                Ogni bit $S_i$ attiva un generatore di corrente $I_i$:
                $$I_i = 2^i \cdot I_{LSB}$$

                dove $I_{LSB}$ = corrente del bit meno significativo.

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{Corrente totale:}

                    \vspace{0.1cm}
                    $$I_{tot} = I_{LSB} \cdot (S_0 \cdot 2^0 + S_1 \cdot 2^1 + \cdots + S_{N-1} \cdot 2^{N-1})$$

                    \vspace{0.1cm}
                    Semplificando:
                    $$\boxed{I_{tot} = I_{LSB} \cdot \sum_{i=0}^{N-1} S_i \cdot 2^i}$$
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Formula $V_{out}$:}

                    \vspace{0.1cm}
                    Con OpAmp in configurazione transimpedenza:
                    $$\boxed{V_{out} = -I_{tot} \cdot R_F}$$

                    \vspace{0.05cm}
                    $$V_{out} = -I_{LSB} \cdot R_F \cdot (S_0 + 2S_1 + 4S_2 + \cdots)$$
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ ATTENZIONE al VERSO della corrente!}

                    \vspace{0.1cm}
                    Il segno di $V_{out}$ dipende dal \textbf{verso} della corrente:

                    \vspace{0.1cm}
                    • Corrente \textbf{entrante} nel nodo $V^-$ (verso il basso):
                    $$\boxed{V_{out} = +R_F \cdot I_{in}}$$

                    • Corrente \textbf{uscente} dal nodo $V^-$ (verso l'alto):
                    $$\boxed{V_{out} = -R_F \cdot I_{in}}$$

                    \vspace{0.05cm}
                    {\footnotesize \textbf{Regola:} Guarda il verso della freccia della corrente nel circuito!}
                }}

            \end{minipage}
        };
        %------------ DAC Correnti Pesate Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC a Correnti Pesate};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC Correnti Pesate - Deviatori e Vout ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Deviatori (Switch):}

                \vspace{0.05cm}
                • $S_i = 1$ $\Rightarrow$ corrente $I_i$ va verso il \textbf{sommatore}

                • $S_i = 0$ $\Rightarrow$ corrente $I_i$ va verso \textbf{massa}

                \vspace{0.1cm}
                \textbf{Nota:} Le correnti scorrono \textbf{sempre}, cambiano solo direzione!

                \vspace{0.15cm}
                \textbf{$\triangle$ Se una corrente cambia (es. $I_2 \to I_2'$):}

                \vspace{0.1cm}
                • Solo il contributo di quel bit cambia

                • Gli altri bit \textbf{non sono influenzati}

                \vspace{0.1cm}
                \textbf{Errore:} $\Delta V = (I_2' - I_2) \cdot R_F \cdot S_2$

                \vspace{0.1cm}
                \textbf{$\bigstar$ L'errore c'\`e SOLO se $S_i = 1$!}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{FSR e LSB:}

                    \vspace{0.1cm}
                    $$\text{LSB} = I_{LSB} \cdot R_F$$
                    $$\text{FSR} = \text{LSB} \cdot 2^N$$
                }}

            \end{minipage}
        };
        %------------ DAC Correnti Pesate Deviatori Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC Correnti Pesate - Deviatori};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC Correnti Pesate - DNL ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{DNL nel DAC a Correnti Pesate}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{DNL Assoluta} (in Volt):

                    \vspace{0.1cm}
                    $$\boxed{\text{DNL}_{ABS}(i) = V_{out}(i) - V_{out}(i-1) - \text{LSB}}$$

                    \vspace{0.1cm}
                    \textbf{DNL Relativa} (in LSB):

                    \vspace{0.1cm}
                    $$\boxed{\text{DNL}_{REL}(i) = \frac{\text{DNL}_{ABS}(i)}{\text{LSB}}}$$
                }}

                \vspace{0.15cm}
                \textbf{Calcolo pratico:}

                \vspace{0.1cm}
                Se una corrente $I_k$ \`e errata:

                \vspace{0.05cm}
                • L'errore appare su tutte le word con $S_k = 1$

                • Basta calcolare $V_{out}$ per \textbf{una} word con $S_k = 1$

                \vspace{0.1cm}
                {\footnotesize \textbf{Nota:} La word 0 \textbf{non si calcola}}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\triangle$ Gradini di ``ritorno'':}

                    \vspace{0.1cm}
                    Stesso principio del DAC R-2R:

                    \vspace{0.05cm}
                    Se 0$\to$1 ha DNL $= -\Delta V$, allora 1$\to$2 (se corretto) ha DNL $= +\Delta V$

                    \vspace{0.1cm}
                    $\Rightarrow$ \textbf{DNL alternata} sui pattern affetti
                }}

            \end{minipage}
        };
        %------------ DAC Correnti Pesate DNL Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC Correnti Pesate - DNL};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ DAC Correnti Pesate - Dinamica ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Dinamica delle Transizioni}

                \vspace{0.15cm}
                \textbf{Caso ideale:} transizione istantanea

                \vspace{0.1cm}
                \textbf{Caso reale:} OpAmp con guadagno finito e polo
                $$A(s) = \frac{A_0}{1 + s\tau_0}$$

                $\Rightarrow$ Transizione esponenziale con $\tau = \tau_0$

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Transizione:}
                    $$V_{out}(t) = V_{finale} \cdot \left(1 - e^{-t/\tau_0}\right)$$
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ Configurazione influenza $G_{loop}$:}

                    \vspace{0.05cm}
                    Al cambiare della \textbf{word}, cambia l'impedenza vista dall'OpAmp.

                    \vspace{0.05cm}
                    $\Rightarrow$ Cambia $G_{loop}$ $\Rightarrow$ Cambia $G_{reale}$

                    $\Rightarrow$ Cambiano i \textbf{tempi di propagazione}!

                    \vspace{0.05cm}
                    \textbf{Conseguenza:} Settling time \textbf{dipende dalla word}
                }}

            \end{minipage}
        };
        %------------ DAC Correnti Pesate Dinamica Header ---------------------
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}DAC Correnti Pesate - Dinamica};
    \end{tikzpicture}

    \newpage
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Comparatore a Singola Soglia ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Comparatore a Singola Soglia}

                \vspace{0.1cm}
                Confronta $V_{in}$ con una tensione di riferimento $V_{ref}$ (soglia unica).

                \vspace{0.2cm}
                \textbf{INVERTENTE} ($V_{in}$ su $V^-$, $V_{ref}$ su $V^+$):

                \vspace{0.1cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.65]
                        % OpAmp
                        \draw (2,1.5) node[op amp, noinv input up] (opamp) {};
                        % Input on -
                        \draw (opamp.-) -- ++(-0.5,0) node[left] {$V_{in}$};
                        % Reference on +
                        \draw (opamp.+) -- ++(-0.5,0) node[left] {$V_{ref}$};
                        % Output
                        \draw (opamp.out) -- ++(0.5,0) node[right] {$V_{out}$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.05cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    $$V_{out} = \begin{cases} +V_{sat} & \text{se } V_{in} < V_{ref} \\ -V_{sat} & \text{se } V_{in} > V_{ref} \end{cases}$$
                }}

                \vspace{0.15cm}
                \textbf{NON INVERTENTE} ($V_{in}$ su $V^+$, $V_{ref}$ su $V^-$):

                \vspace{0.1cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.65]
                        % OpAmp
                        \draw (2,1.5) node[op amp, noinv input up] (opamp) {};
                        % Reference on -
                        \draw (opamp.-) -- ++(-0.5,0) node[left] {$V_{ref}$};
                        % Input on +
                        \draw (opamp.+) -- ++(-0.5,0) node[left] {$V_{in}$};
                        % Output
                        \draw (opamp.out) -- ++(0.5,0) node[right] {$V_{out}$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.05cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    $$V_{out} = \begin{cases} +V_{sat} & \text{se } V_{in} > V_{ref} \\ -V_{sat} & \text{se } V_{in} < V_{ref} \end{cases}$$
                }}

                \vspace{0.15cm}
                \textbf{Soglia unica:} $\boxed{V_{TH} = V_{ref}}$

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ PROBLEMA: Rumore!}

                    \vspace{0.05cm}
                    Se $V_{in} \approx V_{ref}$, piccole oscillazioni causano \textbf{commutazioni multiple} indesiderate.

                    \vspace{0.05cm}
                    $\Rightarrow$ Soluzione: \textbf{Comparatore a doppia soglia} (isteresi)
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Comparatore a Singola Soglia};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Comparatore a Doppia Soglia (Isteresi) ---------------

    \resizebox{0.8\linewidth}{!}{%
    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Comparatore a Doppia Soglia (Trigger di Schmitt)}

                \vspace{0.1cm}
                Usa \textbf{retroazione positiva} per creare due soglie diverse: elimina il problema del rumore.

                \vspace{0.15cm}
                \textbf{INVERTENTE} ($V_{in}$ su $V^-$):

                \vspace{0.1cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.65]
                        % OpAmp
                        \draw (2,1.5) node[op amp, noinv input up] (opamp) {};
                        % Input on -
                        \draw (opamp.-) -- ++(-0.5,0) node[left] {$V_{in}$};
                        % Positive feedback network
                        \draw (opamp.+) -- ++(0,-0.8) coordinate (fb);
                        \draw (fb) to[R, l_=$R_1$] ++(0,-1.2) node[ground] {};
                        \draw (fb) to[R, l=$R_2$] ++(2,0) -| (opamp.out);
                        % Output
                        \draw (opamp.out) -- ++(0.5,0) node[right] {$V_{out}$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.05cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{Soglie di commutazione:}

                    \vspace{0.05cm}
                    $$\boxed{V_{TH} = +V_{sat} \cdot \frac{R_1}{R_1 + R_2}}$$
                    $$\boxed{V_{TL} = -V_{sat} \cdot \frac{R_1}{R_1 + R_2}}$$

                    \vspace{0.05cm}
                    \textbf{Isteresi:} $\Delta V = V_{TH} - V_{TL} = 2V_{sat} \cdot \frac{R_1}{R_1 + R_2}$
                }}

                \vspace{0.15cm}
                \textbf{NON INVERTENTE} ($V_{in}$ su $V^+$):

                \vspace{0.1cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.65]
                        % OpAmp
                        \draw (2,1.5) node[op amp, noinv input up] (opamp) {};
                        % Input through R1 to +
                        \draw (opamp.+) -- ++(-0.3,0) coordinate (plus);
                        \draw (plus) to[R, l=$R_1$] ++(-1.5,0) node[left] {$V_{in}$};
                        % Feedback R2 from output to +
                        \draw (plus) -- ++(0,1) to[R, l=$R_2$] ++(2.3,0) -| (opamp.out);
                        % Ground on -
                        \draw (opamp.-) -- ++(-0.3,0) node[ground] {};
                        % Output
                        \draw (opamp.out) -- ++(0.5,0) node[right] {$V_{out}$};
                    \end{circuitikz}
                \end{center}

                \vspace{0.05cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Soglie:}

                    \vspace{0.05cm}
                    $$\boxed{V_{TH} = -V_{sat} \cdot \frac{R_2}{R_1}}$$
                    $$\boxed{V_{TL} = +V_{sat} \cdot \frac{R_2}{R_1}}$$

                    \vspace{0.05cm}
                    {\footnotesize \textit{Nota: segni invertiti rispetto al caso invertente}}
                }}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ DIFFERENZA FONDAMENTALE}

                    \vspace{0.05cm}
                    • \textbf{Retroazione NEGATIVA} ($R_f$ su $V^-$): sistema \textbf{stabile}

                    • \textbf{Retroazione POSITIVA} ($R$ su $V^+$): sistema \textbf{bistabile}

                    \vspace{0.1cm}
                    \textbf{$\bigstar$ Con retroazione POSITIVA:} l'uscita si comporta come un \textbf{generatore indipendente} con valore $V_{out} = \pm V_{sat}$
                }}

                \vspace{0.15cm}
                \colorbox{red!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ REGOLA D'ORO - Riconoscimento:}

                    \vspace{0.05cm}
                    • $V_{out}$ \textbf{rientra su} $V^+$ $\Rightarrow$ \textbf{Trigger di Schmitt NON INVERTENTE}

                    • $V_{out}$ \textbf{rientra su} $V^-$ $\Rightarrow$ \textbf{Trigger di Schmitt INVERTENTE}

                    \vspace{0.1cm}
                    \textbf{$\triangle$ ATTENZIONE:} In entrambi i casi \textbf{NON applicare} le regole della retroazione negativa ($V^+ = V^-$, $I^+ = I^- = 0$)!

                    \vspace{0.05cm}
                    $\Rightarrow$ Usare analisi con $V_{out} = \pm V_{sat}$
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{OpAmp ``Rail-to-Rail'':}

                    \vspace{0.05cm}
                    L'uscita può raggiungere \textbf{esattamente} le tensioni di alimentazione:
                    $$V_{sat}^+ = +V_{DD} \qquad V_{sat}^- = -V_{SS} \text{ (o } 0V \text{ se singola alim.)}$$

                    \vspace{0.05cm}
                    \textbf{OpAmp standard:} $V_{sat} \approx V_{alim} - 1\text{V} \div 2\text{V}$

                    \vspace{0.05cm}
                    $\Rightarrow$ Nei trigger, se ``rail-to-rail'': usare $\pm V_{DD}$ nelle formule soglie
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Comparatore a Doppia Soglia (Isteresi)};
    \end{tikzpicture}%
    }

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Trigger di Schmitt - Funzionamento Concettuale ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Come Funziona il Trigger di Schmitt}

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{INVERTENTE} ($V_{in}$ su $V^-$, feedback su $V^+$)

                    \vspace{0.1cm}
                    \textbf{Idea:} L'ingresso ``combatte'' contro la retroazione positiva.

                    \vspace{0.1cm}
                    • $V_{in}$ \textbf{basso} $\Rightarrow$ $V^- < V^+$ $\Rightarrow$ $V_{out} = +V_{sat}$

                    \hspace{0.3cm} La retroazione porta $V^+ = +V_{sat} \cdot \frac{R_1}{R_1+R_2} = V_{TH}$

                    \vspace{0.1cm}
                    • $V_{in}$ \textbf{sale e supera} $V_{TH}$ $\Rightarrow$ $V^- > V^+$ $\Rightarrow$ \textbf{COMMUTA!}

                    \hspace{0.3cm} $V_{out} = -V_{sat}$ $\Rightarrow$ ora $V^+ = V_{TL}$ (soglia si abbassa!)

                    \vspace{0.1cm}
                    • $V_{in}$ \textbf{scende sotto} $V_{TL}$ $\Rightarrow$ $V^- < V^+$ $\Rightarrow$ \textbf{COMMUTA!}

                    \vspace{0.1cm}
                    \textbf{Comportamento:} $V_{in} \uparrow$ $\Rightarrow$ $V_{out} \downarrow$ (invertente!)
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{NON INVERTENTE} ($V_{in}$ e feedback entrambi su $V^+$)

                    \vspace{0.1cm}
                    \textbf{Idea:} Ingresso e retroazione si ``sommano'' su $V^+$.

                    \vspace{0.1cm}
                    • $V_{in}$ \textbf{basso} $\Rightarrow$ $V^+$ basso $\Rightarrow$ $V^+ < V^-$ $\Rightarrow$ $V_{out} = -V_{sat}$

                    \hspace{0.3cm} Retroazione ``tira giù'' ancora di più $V^+$

                    \vspace{0.1cm}
                    • $V_{in}$ \textbf{sale abbastanza} da vincere retroazione negativa:

                    \hspace{0.3cm} $V^+ > V^-$ $\Rightarrow$ \textbf{COMMUTA!} $V_{out} = +V_{sat}$

                    \hspace{0.3cm} Ora retroazione ``aiuta'' a tenere $V^+$ alto

                    \vspace{0.1cm}
                    • $V_{in}$ deve \textbf{scendere molto} per ricommutare

                    \vspace{0.1cm}
                    \textbf{Comportamento:} $V_{in} \uparrow$ $\Rightarrow$ $V_{out} \uparrow$ (non invertente!)
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Perché c'è isteresi?}

                    \vspace{0.05cm}
                    La \textbf{retroazione positiva} sposta la soglia dopo ogni commutazione!

                    \vspace{0.05cm}
                    • Dopo $V_{out} = +V_{sat}$: soglia diventa $V_{TH}$ (alta)

                    • Dopo $V_{out} = -V_{sat}$: soglia diventa $V_{TL}$ (bassa)

                    \vspace{0.05cm}
                    $\Rightarrow$ Servono \textbf{variazioni più grandi} di $V_{in}$ per commutare $\Rightarrow$ \textbf{immunità al rumore}
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Trigger di Schmitt - Funzionamento};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Trigger di Schmitt - Disegno Caratteristica ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Disegno Caratteristica $V_{out}$ vs $V_{in}$}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ REGOLE FONDAMENTALI:}

                    \vspace{0.1cm}
                    \textbf{1.} $V_{in} < V_{TL}$ \textbf{E} $V_{in} < V_{TH}$ (sotto entrambe):

                    \hspace{0.3cm} $\Rightarrow$ $V_{out}$ è \textbf{determinata} (HIGH o LOW)

                    \vspace{0.1cm}
                    \textbf{2.} $V_{in} > V_{TL}$ \textbf{E} $V_{in} > V_{TH}$ (sopra entrambe):

                    \hspace{0.3cm} $\Rightarrow$ $V_{out}$ è \textbf{determinata} (opposta al caso 1)

                    \vspace{0.1cm}
                    \textbf{3.} $V_{TL} < V_{in} < V_{TH}$ (fra le due soglie):

                    \hspace{0.3cm} $\Rightarrow$ $V_{out}$ \textbf{mantiene il valore precedente}
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Regola pratica:}

                    \vspace{0.05cm}
                    ``Per \textbf{commutare} devo attraversare la \textbf{soglia più lontana}''

                    \vspace{0.05cm}
                    $\Rightarrow$ Da HIGH: devo scendere sotto $V_{TL}$

                    $\Rightarrow$ Da LOW: devo salire sopra $V_{TH}$
                }}

                \vspace{0.15cm}
                \textbf{Esempio con ingresso triangolare:}

                {\footnotesize
                \begin{enumerate}[leftmargin=*]
                    \item Partenza: $V_{in}$ molto basso $\Rightarrow$ $V_{out}$ determinata
                    \item $V_{in}$ sale, supera $V_{TL}$: \textbf{nessuna commutazione}
                    \item $V_{in}$ supera $V_{TH}$: \textbf{COMMUTA!}
                    \item $V_{in}$ scende, rientra sotto $V_{TH}$: \textbf{nessuna commutazione}
                    \item $V_{in}$ scende sotto $V_{TL}$: \textbf{COMMUTA!}
                \end{enumerate}
                }

                \vspace{0.1cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ METODO DI ANALISI TRIGGER:}

                    \vspace{0.1cm}
                    \textbf{1.} \textbf{Riconoscere} che è retroazione \textbf{positiva}:

                    \hspace{0.3cm} $V_{out}$ torna su $V^+$? $\Rightarrow$ È un \textbf{Trigger di Schmitt}!

                    \vspace{0.1cm}
                    \textbf{2.} \textbf{Calcolare} $V^+$ e $V^-$ in funzione di $V_{in}$ e $V_{out}$

                    \hspace{0.3cm} (usare partitore/sovrapposizione)

                    \vspace{0.1cm}
                    \textbf{3.} \textbf{Trovare le soglie:} valori di $V_{in}$ per cui $V^+ = V^-$

                    \hspace{0.3cm} $\Rightarrow$ Con $V_{out} = +V_{sat}$: trovo $V_{TH}$

                    \hspace{0.3cm} $\Rightarrow$ Con $V_{out} = -V_{sat}$: trovo $V_{TL}$
                }}

                \vspace{0.1cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Calcolo $V^+$ con sovrapposizione:}

                    \vspace{0.05cm}
                    \textbf{Trigger NON INV} ($V^-$ a massa):

                    $V^-$ \textbf{non influisce} su $V_{out}$ (contributo = 0)

                    \vspace{0.05cm}
                    $\Rightarrow$ Calcolare solo contributo di $V_{in}$ e $V_{out}$ su $V^+$
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Trigger di Schmitt - Caratteristica};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Trigger di Schmitt - Calcolo Soglie ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Calcolo Dettagliato delle Soglie}

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{INVERTENTE} ($V_{in}$ su $V^-$, $R_1$-$R_2$ su $V^+$)

                    \vspace{0.1cm}
                    \textbf{Passo 1:} $V^- = V_{in}$ (collegamento diretto)

                    \vspace{0.1cm}
                    \textbf{Passo 2:} $V^+$ = partitore tra $V_{out}$ e massa:
                    $$V^+ = V_{out} \cdot \frac{R_1}{R_1 + R_2}$$

                    \vspace{0.1cm}
                    \textbf{Passo 3:} Soglia quando $V^+ = V^-$:
                    $$V_{in} = V_{out} \cdot \frac{R_1}{R_1 + R_2}$$

                    \vspace{0.1cm}
                    \textbf{Passo 4:} Sostituisco $V_{out} = \pm V_{sat}$:

                    $\Rightarrow V_{TH} = +V_{sat} \cdot \frac{R_1}{R_1 + R_2}$ (quando $V_{out}$ è HIGH)

                    $\Rightarrow V_{TL} = -V_{sat} \cdot \frac{R_1}{R_1 + R_2}$ (quando $V_{out}$ è LOW)
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{NON INVERTENTE} ($V_{in}$ e $V_{out}$ entrambi su $V^+$)

                    \vspace{0.1cm}
                    \textbf{Passo 1:} $V^- = 0$ (a massa)

                    \vspace{0.1cm}
                    \textbf{Passo 2:} $V^+$ con sovrapposizione:
                    $$V^+ = V_{in} \cdot \frac{R_2}{R_1 + R_2} + V_{out} \cdot \frac{R_1}{R_1 + R_2}$$

                    \vspace{0.1cm}
                    \textbf{Passo 3:} Soglia quando $V^+ = V^- = 0$:
                    $$V_{in} \cdot \frac{R_2}{R_1 + R_2} + V_{out} \cdot \frac{R_1}{R_1 + R_2} = 0$$
                    $$V_{in} = -V_{out} \cdot \frac{R_1}{R_2}$$

                    \vspace{0.1cm}
                    \textbf{Passo 4:} Sostituisco $V_{out} = \pm V_{sat}$:

                    $\Rightarrow V_{TH} = -V_{sat} \cdot \frac{R_1}{R_2}$ (quando $V_{out}$ è LOW, per salire)

                    $\Rightarrow V_{TL} = +V_{sat} \cdot \frac{R_1}{R_2}$ (quando $V_{out}$ è HIGH, per scendere)
                }}

                \vspace{0.1cm}
                {\footnotesize \textit{Nota: nel non invertente $V_{TL} > V_{TH}$ (soglie ``invertite'')}}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ ATTENZIONE - $V_{ref}$ generale:}

                    \vspace{0.05cm}
                    Le soglie vanno \textbf{sempre calcolate in funzione di $V_{ref}$}!

                    \vspace{0.05cm}
                    Se $V^-$ non è a massa ma a $V_{ref}$:
                    $$V^+ = V^- = V_{ref} \Rightarrow \text{soglie traslate di } V_{ref}$$

                    \vspace{0.05cm}
                    \textbf{Con correnti di bias $I_B$:} se presenti, possono modificare le tensioni sui nodi $\Rightarrow$ \textbf{ricalcolare le soglie} tenendo conto della caduta $I_B \cdot R$
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Trigger di Schmitt - Calcolo Soglie};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Trigger di Schmitt - Grafici Isteresi ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Grafici Caratteristica e Isteresi}

                \vspace{0.15cm}
                \textbf{INVERTENTE:} (ciclo percorso in senso \textbf{antiorario})

                \vspace{0.1cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.55]
                        % Axes
                        \draw[->] (-2.5,0) -- (2.5,0) node[right] {\footnotesize $V_{in}$};
                        \draw[->] (0,-1.8) -- (0,1.8) node[above] {\footnotesize $V_{out}$};
                        % Labels
                        \node[left] at (0,1.3) {\tiny $+V_{sat}$};
                        \node[left] at (0,-1.3) {\tiny $-V_{sat}$};
                        \node[below] at (-1.2,0) {\tiny $V_{TL}$};
                        \node[below] at (1.2,0) {\tiny $V_{TH}$};
                        % Hysteresis loop - INVERTED (counterclockwise)
                        \draw[thick, blue] (-2.3,1.3) -- (1.2,1.3);
                        \draw[thick, blue, ->] (1.2,1.3) -- (1.2,0);
                        \draw[thick, blue] (1.2,-1.3) -- (1.2,0);
                        \draw[thick, blue] (1.2,-1.3) -- (2.3,-1.3);
                        \draw[thick, red] (2.3,-1.3) -- (-1.2,-1.3);
                        \draw[thick, red, ->] (-1.2,-1.3) -- (-1.2,0);
                        \draw[thick, red] (-1.2,1.3) -- (-1.2,0);
                        \draw[thick, red] (-1.2,1.3) -- (-2.3,1.3);
                        % Dashed lines
                        \draw[dashed, gray] (-1.2,0) -- (-1.2,-1.3);
                        \draw[dashed, gray] (1.2,0) -- (1.2,1.3);
                    \end{tikzpicture}
                \end{center}

                {\footnotesize
                \textcolor{blue}{$\rightarrow$ Blu: $V_{in}$ sale} $\Rightarrow$ a $V_{TH}$ commuta da HIGH a LOW

                \textcolor{red}{$\leftarrow$ Rosso: $V_{in}$ scende} $\Rightarrow$ a $V_{TL}$ commuta da LOW a HIGH
                }

                \vspace{0.1cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ Come DISEGNARE (INV):}

                    1. Disegno linea \textcolor{red}{\textbf{ROSSA}} da \textbf{SOPRA a SOTTO} (partendo da $+V_{sat}$)

                    2. Completo con isteresi alla sua \textbf{DESTRA}
                }}

                \vspace{0.2cm}
                \textbf{NON INVERTENTE:} (ciclo percorso in senso \textbf{orario})

                \vspace{0.1cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.55]
                        % Axes
                        \draw[->] (-2.5,0) -- (2.5,0) node[right] {\footnotesize $V_{in}$};
                        \draw[->] (0,-1.8) -- (0,1.8) node[above] {\footnotesize $V_{out}$};
                        % Labels
                        \node[left] at (0,1.3) {\tiny $+V_{sat}$};
                        \node[left] at (0,-1.3) {\tiny $-V_{sat}$};
                        \node[below] at (-1.2,0) {\tiny $V_{TL}$};
                        \node[below] at (1.2,0) {\tiny $V_{TH}$};
                        % Hysteresis loop - NON INVERTED (clockwise)
                        \draw[thick, blue] (-2.3,-1.3) -- (-1.2,-1.3);
                        \draw[thick, blue, ->] (-1.2,-1.3) -- (-1.2,0);
                        \draw[thick, blue] (-1.2,1.3) -- (-1.2,0);
                        \draw[thick, blue] (-1.2,1.3) -- (2.3,1.3);
                        \draw[thick, red] (2.3,1.3) -- (1.2,1.3);
                        \draw[thick, red, ->] (1.2,1.3) -- (1.2,0);
                        \draw[thick, red] (1.2,-1.3) -- (1.2,0);
                        \draw[thick, red] (1.2,-1.3) -- (-2.3,-1.3);
                        % Dashed lines
                        \draw[dashed, gray] (-1.2,0) -- (-1.2,1.3);
                        \draw[dashed, gray] (1.2,0) -- (1.2,-1.3);
                    \end{tikzpicture}
                \end{center}

                {\footnotesize
                \textcolor{blue}{$\rightarrow$ Blu: $V_{in}$ sale} $\Rightarrow$ a $V_{TH}$ commuta da LOW a HIGH

                \textcolor{red}{$\leftarrow$ Rosso: $V_{in}$ scende} $\Rightarrow$ a $V_{TL}$ commuta da HIGH a LOW
                }

                \vspace{0.1cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ Come DISEGNARE (NON INV):}

                    1. Disegno linea \textcolor{blue}{\textbf{BLU}} da \textbf{BASSO ad ALTO} (partendo da $-V_{sat}$)

                    2. Completo con isteresi alla sua \textbf{DESTRA}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{Cos'è l'ISTERESI?}

                    \vspace{0.1cm}
                    È la \textbf{``memoria''} del sistema: l'uscita dipende non solo dal valore attuale di $V_{in}$, ma anche dalla \textbf{storia passata}.

                    \vspace{0.1cm}
                    \textbf{Graficamente:} è il ``rettangolo'' tra le due soglie. L'uscita può essere HIGH o LOW nella zona $V_{TL} < V_{in} < V_{TH}$ $\Rightarrow$ dipende da \textbf{dove arrivo}.

                    \vspace{0.1cm}
                    \textbf{Ampiezza isteresi:} $\boxed{\Delta V = V_{TH} - V_{TL}}$

                    \vspace{0.1cm}
                    \textbf{A cosa serve:} il rumore deve superare $\Delta V$ per causare commutazioni spurie $\Rightarrow$ \textbf{immunità al rumore}!
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ REGOLA MNEMONICA per disegnare:}

                    \vspace{0.1cm}
                    \textbf{1. Guarda dove entra $V_{in}$:}

                    \vspace{0.05cm}
                    • Entra su $V^-$ $\Rightarrow$ \textbf{INVERTENTE}

                    • Entra su $V^+$ $\Rightarrow$ \textbf{NON INVERTENTE}

                    \vspace{0.15cm}
                    \textbf{2. Disegna la PRIMA transizione verticale:}

                    \vspace{0.05cm}
                    • \textbf{INV}: parto da \textbf{SOPRA} ($+V_{sat}$), scendo $\downarrow$

                    \hspace{0.5cm} {\footnotesize (``MENO inverte'' $\Rightarrow$ parto dal PIÙ)}

                    \vspace{0.05cm}
                    • \textbf{NON INV}: parto da \textbf{SOTTO} ($-V_{sat}$), salgo $\uparrow$

                    \hspace{0.5cm} {\footnotesize (``PIÙ non inverte'' $\Rightarrow$ parto dal MENO)}

                    \vspace{0.15cm}
                    \textbf{3. La transizione avviene alla soglia PIÙ LONTANA:}

                    \vspace{0.05cm}
                    • Se parto da SOPRA $\Rightarrow$ attraverso $V_{TH}$ (soglia a destra)

                    • Se parto da SOTTO $\Rightarrow$ attraverso $V_{TL}$ (soglia a sinistra)

                    \vspace{0.05cm}
                    {\footnotesize \textbf{Regola:} devo sempre attraversare la soglia \textbf{più lontana} dal mio punto di partenza!}

                    \vspace{0.15cm}
                    \textbf{4. Completa il ciclo:}

                    \vspace{0.05cm}
                    Dall'arrivo, vai verso \textbf{DESTRA} e chiudi il rettangolo.

                    \vspace{0.15cm}
                    \textbf{5. FRECCE (verso di percorrenza):}

                    \vspace{0.05cm}
                    • Sulle linee \textbf{orizzontali}: freccia verso DESTRA $\rightarrow$ ($V_{in}$ sale)

                    • Sulle linee \textbf{orizzontali}: freccia verso SINISTRA $\leftarrow$ ($V_{in}$ scende)

                    • Sulle \textbf{transizioni verticali}: freccia nel verso della commutazione ($\uparrow$ o $\downarrow$)
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Trigger di Schmitt - Grafici Isteresi};
    \end{tikzpicture}

    \newpage

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ ADC - Introduzione ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{ADC (Analog-to-Digital Converter)}

                \vspace{0.1cm}
                Converte un segnale \textbf{analogico} (tensione) in un segnale \textbf{digitale} (word a N bit).

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Input:} Tensione analogica $V_{in}$

                    \textbf{Output:} Word digitale a $N$ bit
                }}

                \vspace{0.15cm}
                \textbf{Range di ingresso:}

                \vspace{0.1cm}
                L'ADC può convertire \textbf{solo} tensioni nel range:
                $$\boxed{V_{SS} \leq V_{in} \leq V_{DD}}$$

                dove $V_{SS}$ = tensione di alimentazione bassa, $V_{DD}$ = tensione di alimentazione alta.

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{Principio di funzionamento:}

                    \vspace{0.1cm}
                    L'ADC suddivide internamente il range $[V_{SS}, V_{DD}]$ in $2^N$ \textbf{intervalli} (livelli di quantizzazione).

                    \vspace{0.1cm}
                    Ogni tensione in ingresso viene ``collocata'' in uno di questi intervalli $\Rightarrow$ associata a una word digitale.

                    \vspace{0.1cm}
                    \textbf{Risoluzione:} $\Delta V = \frac{V_{DD} - V_{SS}}{2^N}$
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\triangle$ PROBLEMA: Segnale fuori range!}

                    \vspace{0.1cm}
                    Se $V_{in} < V_{SS}$ o $V_{in} > V_{DD}$, l'ADC \textbf{non può convertire} correttamente!

                    \vspace{0.1cm}
                    \textbf{Soluzione:} Serve un \textbf{blocco di condizionamento} (amplificatore + offset) prima dell'ADC per adattare il segnale al range $[V_{SS}, V_{DD}]$.
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}ADC - Introduzione};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Catena di Acquisizione ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Catena di Acquisizione}

                \vspace{0.1cm}
                Schema tipico per acquisire un segnale analogico:

                \vspace{0.15cm}
                \begin{center}
                    \begin{tikzpicture}[scale=0.6, every node/.style={scale=0.8}]
                        % Blocks
                        \draw[thick] (0,0) rectangle (1.8,1) node[midway] {\tiny Cond.};
                        \draw[thick] (2.3,0) rectangle (4.1,1) node[midway] {\tiny S\&H};
                        \draw[thick] (4.6,0) rectangle (6.4,1) node[midway] {\tiny ADC};
                        % Arrows
                        \draw[->, thick] (-0.8,0.5) -- (0,0.5) node[midway, above] {\tiny $V_{in}$};
                        \draw[->, thick] (1.8,0.5) -- (2.3,0.5);
                        \draw[->, thick] (4.1,0.5) -- (4.6,0.5);
                        \draw[->, thick] (6.4,0.5) -- (7.2,0.5) node[midway, above] {\tiny Word};
                    \end{tikzpicture}
                \end{center}

                \vspace{0.1cm}
                \textbf{1. Condizionamento} (opzionale):

                \vspace{0.05cm}
                Amplificatore + offset per adattare $V_{in}$ al range ADC

                $$V_{out} = A \cdot V_{in} + V_{offset}$$

                \vspace{0.1cm}
                \textbf{2. Sample \& Hold} (S\&H):

                \vspace{0.05cm}
                ``Congela'' il valore di $V_{in}$ durante la conversione

                \vspace{0.1cm}
                \textbf{3. ADC}:

                \vspace{0.05cm}
                Converte la tensione ``congelata'' in word digitale

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Perché serve il S\&H?}

                    \vspace{0.05cm}
                    L'ADC impiega un \textbf{tempo finito} per convertire. Se $V_{in}$ varia durante la conversione, il risultato è \textbf{errato}!

                    \vspace{0.05cm}
                    $\Rightarrow$ Il S\&H ``memorizza'' il valore all'istante di campionamento
                }}

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ Semplificazione S\&H:}

                    \vspace{0.05cm}
                    In prima approssimazione il S\&H \textbf{non introduce offset né guadagno}.

                    \vspace{0.05cm}
                    $\Rightarrow$ Per l'\textbf{adattamento} tra $V_{in}$ e ADC, il S\&H si considera come un \textbf{filo} (passa la tensione inalterata).
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Catena di Acquisizione};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Sample & Hold ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Sample \& Hold (S\&H)}

                \vspace{0.1cm}
                Circuito che ``memorizza'' una tensione analogica.

                \vspace{0.15cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.7]
                        % Input
                        \draw (0,1.5) node[left] {$V_{in}$} -- (0.5,1.5);
                        % Switch (nMOS)
                        \draw (0.5,1.5) to[nos, l=$S$] (2,1.5);
                        % Capacitor
                        \draw (2,1.5) -- (2.5,1.5);
                        \draw (2.5,1.5) to[C, l=$C$] (2.5,0);
                        \draw (2.5,0) node[ground] {};
                        % Output
                        \draw (2.5,1.5) -- (3.5,1.5) node[right] {$V_C$};
                        % Label
                        \node at (1.25,0.5) {\footnotesize nMOS};
                    \end{circuitikz}
                \end{center}

                \vspace{0.1cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{Fase di SAMPLE} (interruttore \textbf{chiuso}):

                    \vspace{0.1cm}
                    Il condensatore $C$ si carica a $V_{in}$

                    $$V_C = V_{in}$$

                    Il condensatore ``segue'' le variazioni di $V_{in}$
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Fase di HOLD} (interruttore \textbf{aperto}):

                    \vspace{0.1cm}
                    L'interruttore si apre $\Rightarrow$ il condensatore \textbf{rimane carico} a $V_{in,0}$ (valore all'istante di apertura)

                    \vspace{0.1cm}
                    $V_{in}$ può variare (es. oscillare a $V_{in,3}$), ma $V_C$ \textbf{resta fermo} a $V_{in,0}$

                    \vspace{0.1cm}
                    $\Rightarrow$ L'ADC converte con calma $V_{in,0}$ senza essere influenzato da oscillazioni!
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ È una MEMORIA ANALOGICA!}

                    \vspace{0.05cm}
                    Il condensatore ``ricorda'' il valore di tensione all'istante del campionamento.
                }}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Perché $C$ non si scarica in fase di HOLD?}

                    \vspace{0.05cm}
                    • Verso \textbf{sinistra}: interruttore \textbf{aperto}!

                    • Verso \textbf{destra}: ingresso ADC ha impedenza \textbf{infinita} (idealmente)

                    \vspace{0.05cm}
                    $\Rightarrow$ Nessun percorso di scarica $\Rightarrow$ $V_C$ resta costante
                }}

                \vspace{0.15cm}
                {\footnotesize \textbf{Implementazione tipica:} nMOS (interruttore) + Condensatore}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Sample \& Hold};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ Sample & Hold con Buffer ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Sample \& Hold con Buffer}

                \vspace{0.1cm}
                Nella realtà, l'ADC ha una resistenza \textbf{finita} verso GND $\Rightarrow$ il condensatore si scaricherebbe lentamente!

                \vspace{0.15cm}
                \textbf{Soluzione:} Aggiungere un \textbf{OpAmp a guadagno 1} (buffer)

                \vspace{0.15cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.65]
                        % Input
                        \draw (0,1.5) node[left] {$V_{in}$} -- (0.5,1.5);
                        % Switch
                        \draw (0.5,1.5) to[nos, l=$S$] (2,1.5);
                        % Capacitor
                        \draw (2,1.5) -- (2.5,1.5);
                        \draw (2.5,1.5) to[C, l=$C$] (2.5,0);
                        \draw (2.5,0) node[ground] {};
                        % Buffer OpAmp
                        \draw (3.5,1.5) node[op amp, noinv input up, scale=0.6] (opamp) {};
                        \draw (2.5,1.5) -- (opamp.+);
                        \draw (opamp.-) -- ++(0,-0.8) -| (opamp.out);
                        % Output to ADC
                        \draw (opamp.out) -- ++(0.8,0) node[right] {\footnotesize ADC};
                        % ADC resistance (shown as problem)
                        \draw[dashed, gray] (5.2,1.5) -- (5.2,0.5);
                        \draw[dashed, gray] (5.2,0.5) to[R, l_=\footnotesize $R_{ADC}$] (5.2,-0.5);
                        \draw[dashed, gray] (5.2,-0.5) node[ground] {};
                    \end{circuitikz}
                \end{center}

                \vspace{0.1cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{Come funziona:}

                    \vspace{0.1cm}
                    • Il buffer ha guadagno 1: $V_{out} = V^+ = V_C$

                    • L'ADC vede una \textbf{replica} della tensione sul condensatore

                    • L'ingresso $V^+$ dell'OpAmp ha impedenza \textbf{infinita}

                    \vspace{0.1cm}
                    $\Rightarrow$ Il condensatore \textbf{non si scarica} anche se $R_{ADC}$ è bassa!
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Funzione del buffer:}

                    \vspace{0.1cm}
                    \textbf{Separa} il condensatore dall'ADC (disaccoppiamento di impedenza)

                    \vspace{0.1cm}
                    • \textbf{Ingresso} buffer: impedenza $\infty$ (non carica $C$)

                    • \textbf{Uscita} buffer: impedenza $\approx 0$ (pilota $R_{ADC}$)

                    \vspace{0.1cm}
                    $\Rightarrow$ $C$ ``vede'' impedenza infinita, ADC ``vede'' sorgente ideale
                }}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ Senza buffer:}

                    \vspace{0.05cm}
                    Se $R_{ADC}$ fosse finita (anche alta), il condensatore si scaricherebbe lentamente attraverso $R_{ADC}$ durante la fase di HOLD.

                    \vspace{0.05cm}
                    $\Rightarrow$ Errore nella conversione (tensione che ``cala'' nel tempo)
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}Sample \& Hold con Buffer};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ ADC - Adattamento e Dinamica ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Adattamento del Segnale (Fitting)}

                \vspace{0.1cm}
                \textbf{Obiettivo:} Sfruttare al meglio l'\textbf{escursione} (dinamica) dell'ADC.

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ PROBLEMA TIPICO D'ESAME:}

                    \vspace{0.1cm}
                    Dato un segnale $V_{in} \in [V_{in,min}, V_{in,max}]$, progettare il circuito di condizionamento per \textbf{mappare} il segnale sull'intero range ADC $[V_{SS}, V_{DD}]$.
                }}

                \vspace{0.15cm}
                \textbf{Mappatura lineare:}

                \vspace{0.1cm}
                Si vuole che:
                \begin{itemize}[leftmargin=*, itemsep=0pt]
                    \item $V_{in,min} \to V_{SS}$
                    \item $V_{in,max} \to V_{DD}$
                \end{itemize}

                \vspace{0.1cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{Formula del condizionamento:}
                    $$\boxed{V_{ADC} = A \cdot V_{in} + V_{offset}}$$

                    \vspace{0.1cm}
                    \textbf{Guadagno:}
                    $$\boxed{A = \frac{V_{DD} - V_{SS}}{V_{in,max} - V_{in,min}}}$$

                    \vspace{0.1cm}
                    \textbf{Offset:}
                    $$\boxed{V_{offset} = V_{SS} - A \cdot V_{in,min}}$$

                    oppure equivalentemente:
                    $$V_{offset} = V_{DD} - A \cdot V_{in,max}$$
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Esempio:}

                    \vspace{0.05cm}
                    $V_{in} \in [-1V, +3V]$, ADC con $V_{SS} = 0V$, $V_{DD} = 5V$

                    \vspace{0.1cm}
                    $A = \frac{5 - 0}{3 - (-1)} = \frac{5}{4} = 1.25$

                    \vspace{0.05cm}
                    $V_{offset} = 0 - 1.25 \cdot (-1) = 1.25V$

                    \vspace{0.1cm}
                    $\Rightarrow V_{ADC} = 1.25 \cdot V_{in} + 1.25V$
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Perché massimizzare la dinamica?}

                    \vspace{0.05cm}
                    Se il segnale usa solo una \textbf{parte} del range ADC, si ``sprecano'' bit di risoluzione!

                    \vspace{0.05cm}
                    $\Rightarrow$ Mappando su tutto il range si sfrutta la \textbf{massima risoluzione} disponibile.
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}ADC - Adattamento e Dinamica};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ ADC - Metodo Calcolo VREF ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Calcolo $V_{REF}$ per Adattamento}

                \vspace{0.1cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ METODO DI CALCOLO:}

                    \vspace{0.1cm}
                    \textbf{1.} Calcolare $V_{ADC}$ in funzione di $V_{in}$ e $V_{REF}$

                    \vspace{0.1cm}
                    \textbf{2.} Imporre le condizioni di mappatura:
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item $V_{in} = V_{in,min} \Rightarrow V_{ADC} = V_{SS}$
                        \item $V_{in} = V_{in,max} \Rightarrow V_{ADC} = V_{DD}$
                    \end{itemize}

                    \vspace{0.1cm}
                    \textbf{3.} Risolvere il sistema per trovare $V_{REF}$
                }}

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ REGOLE per il calcolo di $V_{ADC}$:}

                    \vspace{0.1cm}
                    \textbf{Sample \& Hold:} considerarlo come un \textbf{filo}!

                    \vspace{0.05cm}
                    {\footnotesize (S\&H influisce solo in fase di conversione, non modifica il mapping ingresso/uscita)}

                    \vspace{0.1cm}
                    \textbf{Condensatore:} diventa un \textbf{aperto}!

                    \vspace{0.05cm}
                    {\footnotesize (Stiamo studiando l'accoppiamento I/O, non il comportamento in frequenza $\Rightarrow$ siamo in \textbf{DC} $\Rightarrow$ $s = 0$ $\Rightarrow$ $C$ aperto)}

                    \vspace{0.1cm}
                    \textbf{Buffer (OpAmp guadagno 1):} $V_{out} = V^+$
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Calcolo $V_{ADC}$ con sovrapposizione:}

                    \vspace{0.1cm}
                    Se il circuito ha $V_{in}$ e $V_{REF}$:

                    \vspace{0.05cm}
                    $$V_{ADC} = \underbrace{f_1(V_{in})}_{\text{contributo } V_{in}} + \underbrace{f_2(V_{REF})}_{\text{contributo } V_{REF}}$$

                    \vspace{0.1cm}
                    \textbf{Procedimento:}

                    \vspace{0.05cm}
                    1. Spegni $V_{REF}$ (= 0V) $\Rightarrow$ calcola contributo di $V_{in}$

                    2. Spegni $V_{in}$ (= 0V) $\Rightarrow$ calcola contributo di $V_{REF}$

                    3. Somma i due contributi
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ RICORDA:}

                    \vspace{0.05cm}
                    • Il secondo OpAmp (buffer) ha sempre \textbf{guadagno 1}

                    • Non stai facendo analisi in frequenza $\Rightarrow$ \textbf{NO} Bode, \textbf{NO} poli/zeri

                    • È come calcolare la caratteristica statica (tipo esercizi con diodi)
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}ADC - Metodo Calcolo $V_{REF}$};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ ADC - Buffer e Errore Statico ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Buffer prima dell'ADC - Errore Statico}

                \vspace{0.1cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{Buffer = Sample \& Hold in analisi statica}

                    \vspace{0.05cm}
                    In analisi statica, il S\&H si riduce \textbf{solo all'OpAmp} (il condensatore è aperto, l'interruttore è un filo).

                    $\Rightarrow$ ``Buffer'' è un altro nome per il circuito S\&H quando lo analizzi in DC.
                }}

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Buffer di tensione (Voltage Follower):}

                    \vspace{0.1cm}
                    \begin{center}
                        \begin{circuitikz}[scale=0.6]
                            \draw (2,1.5) node[op amp, noinv input up, scale=0.8] (opamp) {};
                            \draw (opamp.+) -- ++(-0.5,0) node[left] {\footnotesize $V_{in}$};
                            \draw (opamp.-) -- ++(0,-0.6) -| (opamp.out);
                            \draw (opamp.out) -- ++(0.5,0) node[right] {\footnotesize $V_{out}$};
                        \end{circuitikz}
                    \end{center}

                    \vspace{0.05cm}
                    Configurazione: $V^-$ collegato direttamente a $V_{out}$

                    \vspace{0.1cm}
                    $$\boxed{A_v = 1} \quad \Rightarrow \quad V_{out} = V_{in}$$

                    \vspace{0.05cm}
                    {\footnotesize \textbf{Ricordalo a memoria} per risparmiare conti!}
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\triangle$ Errore statico massimo di guadagno:}

                    \vspace{0.1cm}
                    Se l'esercizio chiede l'errore dovuto a variazione del guadagno $A_0$ del buffer:

                    \vspace{0.1cm}
                    \textbf{$\bigstar$ SEI SEMPRE IN ANALISI STATICA!}

                    \vspace{0.1cm}
                    $\Rightarrow$ \textbf{NON introdurre poli/zeri} a meno che l'esercizio lo richieda \textbf{esplicitamente}!

                    \vspace{0.1cm}
                    Assumi che il buffer \textbf{non abbia singolarità} (né poli né zeri).
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Guadagno reale del buffer:}

                    \vspace{0.1cm}
                    Con guadagno ad anello aperto finito $A_0$:

                    $$G_{reale} = \frac{A_0}{1 + A_0} = \frac{1}{1 + \frac{1}{A_0}}$$

                    \vspace{0.1cm}
                    \textbf{Errore rispetto al guadagno ideale (=1):}

                    $$\varepsilon = |G_{ideale} - G_{reale}| = \left|1 - \frac{A_0}{1 + A_0}\right| = \frac{1}{1 + A_0}$$

                    \vspace{0.1cm}
                    Se $A_0 \gg 1$: $\varepsilon \approx \frac{1}{A_0}$
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ TRUCCO VELOCE - Buffer:}

                    \vspace{0.1cm}
                    Per il buffer (follower): $\boxed{G_{loop} = -A_0}$

                    \vspace{0.1cm}
                    Quindi posso usare direttamente la formula generale:

                    $$\boxed{G_{reale} = \frac{G_{ideale}}{1 - \frac{1}{G_{loop}}} = \frac{1}{1 + \frac{1}{A_0}}}$$

                    \vspace{0.1cm}
                    $\Rightarrow$ \textbf{Non serve} tagliare l'anello e introdurre generatore di test!

                    \vspace{0.05cm}
                    {\footnotesize (Si può fare anche ``a mano'', ma così è più veloce)}
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Calcolo $V_{ADC,reale}$ e Errore:}

                    \vspace{0.1cm}
                    \textbf{Procedimento:}

                    \vspace{0.05cm}
                    1. Calcola $V_{ADC,id}$ (caso ideale, buffer con guadagno 1)

                    \vspace{0.05cm}
                    2. Calcola $G_{reale}$ del buffer: $G_{reale} = \frac{1}{1 + \frac{1}{A_0}}$

                    \vspace{0.05cm}
                    3. Moltiplica:

                    $$\boxed{V_{ADC,R} = V_{ADC,id} \cdot G_{reale}}$$

                    \vspace{0.1cm}
                    \textbf{Errore statico:}
                    $$\boxed{\varepsilon = \left| V_{ADC,R} - V_{ADC,id} \right|}$$
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Errore MASSIMO in funzione di LSB:}

                    \vspace{0.1cm}
                    Spesso viene chiesto di trovare $\varepsilon_{max}$ e esprimerlo in LSB:

                    \vspace{0.1cm}
                    $$\boxed{LSB = \frac{FSR}{2^N}}$$

                    dove $FSR = V_{DD} - V_{SS}$ (Full Scale Range)

                    \vspace{0.15cm}
                    \textbf{Errore in LSB:}
                    $$\boxed{\varepsilon_{max} [\text{LSB}] = \frac{\varepsilon_{max}}{LSB} = \frac{\varepsilon_{max} \cdot 2^N}{FSR}}$$
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ Caso con $V_{OS}$ su ENTRAMBI gli OpAmp:}

                    \vspace{0.1cm}
                    Se l'esercizio introduce $V_{OS1}$ (primo OpAmp) e $V_{OS2}$ (buffer):

                    \vspace{0.1cm}
                    \textbf{Usa sovrapposizione!} Già conosci i contributi di $V_{in}$ e $V_{REF}$ dai calcoli precedenti.

                    \vspace{0.1cm}
                    $\Rightarrow$ Devi calcolare \textbf{solo} i contributi di $V_{OS1}$ e $V_{OS2}$:

                    $$V_{ADC} = \underbrace{f(V_{in}, V_{REF})}_{\text{già calcolato}} + \underbrace{g(V_{OS1})}_{\text{nuovo}} + \underbrace{h(V_{OS2})}_{\text{nuovo}}$$

                    \vspace{0.1cm}
                    Poi calcola errore e rapportalo a LSB come sempre.
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ RIASSUNTO:}

                    \vspace{0.05cm}
                    • Buffer = S\&H in analisi statica (solo OpAmp)

                    • Buffer ideale: $A_v = 1$, $G_{loop} = -A_0$

                    • $V_{ADC,R} = V_{ADC,id} \cdot G_{reale}$

                    • Errore in LSB: $\frac{\varepsilon_{max}}{LSB}$ con $LSB = \frac{FSR}{2^N}$

                    • Con $V_{OS}$: sovrapposizione (riusa calcoli precedenti!)
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}ADC - Buffer e Errore Statico};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ ADC - Richieste Tipiche d'Esame ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Richieste Tipiche d'Esame - Errori}

                \vspace{0.1cm}
                Le domande più frequenti sul calcolo degli errori nella catena di acquisizione:

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{1. Errore dovuto a GUADAGNO FINITO}

                    \vspace{0.1cm}
                    L'OpAmp (buffer) ha $A_0$ finito invece di $\infty$.

                    \vspace{0.1cm}
                    \textbf{Procedimento:}
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item Calcola $G_{reale} = \frac{1}{1 + 1/A_0}$
                        \item $V_{ADC,R} = V_{ADC,id} \cdot G_{reale}$
                        \item $\varepsilon = |V_{ADC,R} - V_{ADC,id}|$
                    \end{itemize}

                    \vspace{0.05cm}
                    {\footnotesize Il caso \textbf{peggiore} è quando $V_{ADC,id}$ è massimo!}
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{2. Errore dovuto a $V_{OS}$}

                    \vspace{0.1cm}
                    Uno o più OpAmp hanno tensione di offset.

                    \vspace{0.1cm}
                    \textbf{Procedimento:}
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item \textbf{Sovrapposizione}: spegni tutte le sorgenti tranne $V_{OS}$
                        \item Calcola il contributo di $V_{OS}$ all'uscita
                        \item Se ci sono più OpAmp: somma i contributi
                    \end{itemize}

                    \vspace{0.05cm}
                    {\footnotesize \textbf{Tip:} $V_{OS}$ sul buffer si propaga direttamente con guadagno $\approx 1$}
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{3. Errore dovuto a CORRENTE DI BIAS}

                    \vspace{0.1cm}
                    L'OpAmp ha corrente $I_B$ \textbf{entrante} o \textbf{uscente} negli ingressi.

                    \vspace{0.1cm}
                    \textbf{Procedimento:}
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item Identifica su quale morsetto scorre $I_B$ ($V^+$ o $V^-$)
                        \item Trova la \textbf{resistenza} vista da quel morsetto
                        \item Calcola la caduta: $\Delta V = I_B \cdot R_{eq}$
                        \item Propaga l'errore all'uscita
                    \end{itemize}

                    \vspace{0.05cm}
                    {\footnotesize \textbf{Attenzione al verso!} Entrante vs uscente cambia il segno.}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ FORMULA FINALE - Tutti i casi:}

                    \vspace{0.1cm}
                    $$\boxed{\varepsilon_{max} [\text{LSB}] = \frac{\varepsilon_{max}}{LSB} = \frac{\varepsilon_{max} \cdot 2^N}{FSR}}$$

                    \vspace{0.1cm}
                    dove: $FSR = V_{DD} - V_{SS}$, $N$ = bit dell'ADC

                    \vspace{0.1cm}
                    \textbf{Caso peggiore:} Valuta $\varepsilon$ quando $V_{in}$ è al suo estremo (min o max).
                }}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ ERRORI COMBINATI:}

                    \vspace{0.05cm}
                    Se l'esercizio chiede errore totale con guadagno finito + $V_{OS}$ + $I_B$:

                    \vspace{0.05cm}
                    $\Rightarrow$ Usa \textbf{sovrapposizione}! Calcola ogni contributo separatamente.

                    \vspace{0.05cm}
                    $\Rightarrow$ Per il \textbf{caso peggiore}: somma i valori assoluti (worst case).
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}ADC - Richieste Tipiche d'Esame};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ ADC - Errore da Corrente di Bias nel S&H ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Errore da $I_B$ nel Sample \& Hold}

                \vspace{0.1cm}
                L'errore da corrente di bias va analizzato \textbf{separatamente} nelle due fasi!

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{FASE di SAMPLE} (switch \textbf{chiuso}):

                    \vspace{0.1cm}
                    Lo switch è chiuso $\Rightarrow$ il condensatore è collegato alla sorgente.

                    \vspace{0.1cm}
                    \textbf{Verifica:} La corrente $I_B$ causa variazione di $V_{ADC}$?

                    \vspace{0.1cm}
                    $\Rightarrow$ Spesso \textbf{NO}! La sorgente ``forza'' la tensione sul condensatore, $I_B$ non ha effetto su $V_{ADC}$.

                    \vspace{0.05cm}
                    {\footnotesize (Dipende dalla topologia: analizza caso per caso)}
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{FASE di HOLD} (switch \textbf{aperto}):

                    \vspace{0.1cm}
                    Lo switch si apre $\Rightarrow$ il condensatore è \textbf{isolato}.

                    \vspace{0.1cm}
                    \textbf{Idealmente:} $V_{ADC}$ rimane costante al valore campionato.

                    \vspace{0.1cm}
                    \textbf{Con $I_B$:} La corrente di bias del buffer \textbf{carica/scarica} il condensatore!

                    \vspace{0.1cm}
                    $\Rightarrow$ $V_{ADC}$ \textbf{deriva} (drift) nel tempo!
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Formula della DERIVA:}

                    \vspace{0.1cm}
                    Carica del condensatore a corrente costante:

                    $$\boxed{\Delta V = \frac{I_B \cdot T_{hold}}{C_H}}$$

                    dove:
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item $I_B$ = corrente di bias (entrante o uscente)
                        \item $T_{hold}$ = durata della fase di hold
                        \item $C_H$ = capacità del condensatore di hold
                    \end{itemize}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Andamento dell'ERRORE nel tempo:}

                    \vspace{0.1cm}
                    \begin{center}
                        \begin{tikzpicture}[scale=0.55]
                            % Axes
                            \draw[->] (0,0) -- (6,0) node[right] {\footnotesize $t$};
                            \draw[->] (0,0) -- (0,2.5) node[above] {\footnotesize $\varepsilon$};
                            % Sample phase
                            \fill[green!20] (0,0) rectangle (1.5,2.2);
                            \node at (0.75,2.5) {\tiny SAMPLE};
                            % Hold phase
                            \fill[red!20] (1.5,0) rectangle (4.5,2.2);
                            \node at (3,2.5) {\tiny HOLD};
                            % Sample phase 2
                            \fill[green!20] (4.5,0) rectangle (6,2.2);
                            \node at (5.25,2.5) {\tiny SAMPLE};
                            % Error line
                            \draw[thick, blue] (0,0.2) -- (1.5,0.2);
                            \draw[thick, blue] (1.5,0.2) -- (4.5,1.8);
                            \draw[thick, blue] (4.5,0.2) -- (6,0.2);
                            % Labels
                            \draw[dashed] (1.5,0) -- (1.5,2.2);
                            \draw[dashed] (4.5,0) -- (4.5,2.2);
                            \node at (1.5,-0.3) {\tiny S$\to$H};
                            \node at (4.5,-0.3) {\tiny H$\to$S};
                            % Max error
                            \draw[<->, red] (4.7,0.2) -- (4.7,1.8);
                            \node[red, right] at (4.7,1) {\tiny $\varepsilon_{max}$};
                        \end{tikzpicture}
                    \end{center}

                    \vspace{0.05cm}
                    • Transizione S$\to$H: errore = 0 (appena campionato)

                    • Durante HOLD: errore \textbf{cresce} linearmente

                    • \textbf{Errore MASSIMO:} appena \textbf{prima} di tornare in SAMPLE!
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ ERRORE MASSIMO:}

                    $$\boxed{\varepsilon_{max} = \frac{I_B \cdot T_{hold}}{C_H}}$$

                    L'errore è massimo alla fine della fase di hold (dopo tempo $T_{hold}$).
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ DIMENSIONAMENTO di $C_H$:}

                    \vspace{0.1cm}
                    Se viene chiesto: ``Dimensionare $C_H$ per avere $\varepsilon < \varepsilon_{spec}$''

                    \vspace{0.1cm}
                    Dalla formula: $\varepsilon_{max} = \frac{I_B \cdot T_{hold}}{C_H} < \varepsilon_{spec}$

                    \vspace{0.1cm}
                    $$\boxed{C_H > \frac{I_B \cdot T_{hold}}{\varepsilon_{spec}}}$$

                    \vspace{0.1cm}
                    Se $\varepsilon_{spec}$ è dato in LSB:

                    $$\boxed{C_H > \frac{I_B \cdot T_{hold}}{\varepsilon_{spec} \cdot LSB}}$$

                    dove $LSB = FSR / 2^N$
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ ATTENZIONE - Quale $I_B$ conta?}

                    \vspace{0.05cm}
                    Non tutte le correnti di bias causano deriva!

                    \vspace{0.05cm}
                    $\Rightarrow$ Analizza il circuito in fase di HOLD:

                    • Solo le $I_B$ che \textbf{scorrono nel condensatore} causano errore

                    • Le $I_B$ che hanno un altro percorso \textbf{non} influenzano $V_{ADC}$
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}ADC - Errore da $I_B$ nel S\&H};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ S&H - Dimensionamento Tensioni di Comando nMOS ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Tensioni di Comando nMOS nel S\&H}

                \vspace{0.1cm}
                L'nMOS funge da interruttore: va dimensionato $V_G$ per le fasi ON/OFF.

                \vspace{0.15cm}
                \begin{center}
                    \begin{circuitikz}[scale=0.6]
                        % Input
                        \draw (0,1.5) node[left] {$V_\beta$} -- (0.5,1.5);
                        % nMOS as switch
                        \draw (0.5,1.5) to[nos, l=$V_G$] (2.5,1.5);
                        % Capacitor side
                        \draw (2.5,1.5) -- (3,1.5) node[right] {$V_\gamma$};
                        % Labels
                        \node[above] at (1.5,1.8) {\footnotesize nMOS};
                    \end{circuitikz}
                \end{center}

                \vspace{0.05cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Premessa importante:}

                    \vspace{0.1cm}
                    • $V_\beta$ (sinistra) e $V_\gamma$ (destra, verso buffer) oscillano nel range ADC

                    • Non sappiamo quale sia Source e quale Drain (dipende dal verso della corrente durante carica/scarica di $C$)

                    • \textbf{Negli nMOS:} Source è il terminale a tensione \textbf{più bassa}

                    \vspace{0.1cm}
                    $\Rightarrow$ Consideriamo i \textbf{casi peggiori} agli estremi del range!
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ nMOS ON (fase SAMPLE):}

                    \vspace{0.1cm}
                    Condizione: $V_{GS} > V_T$

                    $$V_G - V_S > V_T$$

                    \vspace{0.1cm}
                    \textbf{Caso peggiore:} $V_S$ \textbf{massima} (= $V_{ADC,max}$)

                    \vspace{0.1cm}
                    Deve valere $\forall V_S$ nel range, quindi:

                    $$\boxed{V_{SH,ON} > V_T + V_{ADC,max}}$$

                    \vspace{0.05cm}
                    {\footnotesize Es: se $V_{ADC} \in [-5V, 0V]$ e $V_T = 0.5V$: $V_{SH,ON} > 0.5V$}
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ nMOS OFF (fase HOLD):}

                    \vspace{0.1cm}
                    Condizione: $V_{GS} < V_T$

                    $$V_G - V_S < V_T$$

                    \vspace{0.1cm}
                    \textbf{Caso peggiore:} $V_S$ \textbf{minima} (= $V_{ADC,min}$)

                    \vspace{0.1cm}
                    Deve valere $\forall V_S$ nel range, quindi:

                    $$\boxed{V_{SH,OFF} < V_T + V_{ADC,min}}$$

                    \vspace{0.05cm}
                    {\footnotesize Es: se $V_{ADC} \in [-5V, 0V]$ e $V_T = 0.5V$: $V_{SH,OFF} < -4.5V$}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ RIASSUNTO:}

                    \vspace{0.1cm}
                    \begin{tabular}{|c|c|c|}
                        \hline
                        \textbf{Fase} & \textbf{Condizione} & \textbf{Caso peggiore} \\
                        \hline
                        SAMPLE (ON) & $V_{GS} > V_T$ & $V_S = V_{ADC,max}$ \\
                        \hline
                        HOLD (OFF) & $V_{GS} < V_T$ & $V_S = V_{ADC,min}$ \\
                        \hline
                    \end{tabular}

                    \vspace{0.15cm}
                    $$\boxed{V_{SH,ON} > V_T + V_{ADC,max}}$$
                    $$\boxed{V_{SH,OFF} < V_T + V_{ADC,min}}$$
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ Perché questi casi peggiori?}

                    \vspace{0.05cm}
                    • \textbf{ON:} Se $V_S$ è alta, serve $V_G$ ancora più alta per avere $V_{GS} > V_T$

                    • \textbf{OFF:} Se $V_S$ è bassa, anche una $V_G$ bassa potrebbe dare $V_{GS} > V_T$ (accensione indesiderata!)
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}S\&H - Comando nMOS};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ S&H - Charge Injection ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{Errore da Charge Injection}

                \vspace{0.1cm}
                Quando l'nMOS passa da ON a OFF, la carica nel canale viene ``iniettata'' nel condensatore!

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{Cosa succede fisicamente:}

                    \vspace{0.1cm}
                    • L'nMOS in conduzione ha un \textbf{canale} formato da cariche

                    • Quando $V_G$ scende (transizione ON$\to$OFF), il canale si ``distrugge''

                    • Le cariche del canale devono andare da qualche parte!

                    • Una parte va verso il condensatore $C_H$ $\Rightarrow$ \textbf{errore}
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{Modello a capacità parassite:}

                    \vspace{0.1cm}
                    \begin{center}
                        \begin{circuitikz}[scale=0.55]
                            % Gate
                            \draw (1.5,2.5) node[above] {$V_G$} -- (1.5,2);
                            % Cp parasitic
                            \draw (1.5,2) to[C, l=$C_p$] (1.5,0.5);
                            % Connection to CH
                            \draw (1.5,0.5) -- (3,0.5);
                            \draw (3,0.5) to[C, l=$C_H$] (3,-1);
                            \draw (3,-1) node[ground] {};
                            % Output node
                            \draw (1.5,0.5) -- (0.5,0.5) node[left] {$V_\gamma$};
                            % Voltage label
                            \node at (3,0.8) {\footnotesize $\Delta V$};
                        \end{circuitikz}
                    \end{center}

                    \vspace{0.05cm}
                    $C_p$ = capacità parassita Gate-Canale dell'nMOS

                    $C_H$ = capacità di hold
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ FORMULA del Charge Injection:}

                    \vspace{0.1cm}
                    $$\boxed{\Delta V = \Delta V_G \cdot \frac{C_p}{C_p + C_H}}$$

                    \vspace{0.1cm}
                    dove:
                    \begin{itemize}[leftmargin=*, itemsep=0pt]
                        \item $\Delta V$ = errore sulla tensione di hold
                        \item $\Delta V_G$ = escursione del gate (da $V_{SH,ON}$ a $V_{SH,OFF}$)
                        \item $C_p$ = capacità parassita gate-canale dell'nMOS
                        \item $C_H$ = capacità del condensatore di hold
                    \end{itemize}
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{Interpretazione fisica:}

                    \vspace{0.1cm}
                    È un \textbf{partitore capacitivo}!

                    \vspace{0.1cm}
                    La variazione $\Delta V_G$ si ripartisce tra $C_p$ e $C_H$:

                    • Se $C_H \gg C_p$: $\Delta V \approx 0$ (errore piccolo)

                    • Se $C_H \ll C_p$: $\Delta V \approx \Delta V_G$ (errore grande!)

                    \vspace{0.1cm}
                    $\Rightarrow$ Serve $C_H$ \textbf{grande} per minimizzare l'errore
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Calcolo di $\Delta V_G$ (con SEGNO!):}

                    \vspace{0.1cm}
                    Per l'nMOS, la transizione ON$\to$OFF richiede di \textbf{abbassare} $V_G$:

                    $$\boxed{\Delta V_G = V_{G,finale} - V_{G,iniziale} = V_{SH,OFF} - V_{SH,ON}}$$

                    \vspace{0.1cm}
                    \textbf{Esempio:} Se $V_{SH,ON} = +12V$ e $V_{SH,OFF} = -12V$:

                    $$\Delta V_G = -12V - (+12V) = \mathbf{-24V}$$

                    \vspace{0.05cm}
                    $\Rightarrow$ $\Delta V$ è \textbf{NEGATIVO} $\Rightarrow$ tensione su $C_H$ \textbf{scende}!
                }}

                \vspace{0.15cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{
                    \textbf{$\triangle$ Perché NEGATIVO per nMOS?}

                    \vspace{0.1cm}
                    • Per \textbf{spegnere} un nMOS devo \textbf{abbassare} $V_G$

                    • $V_G$ scende $\Rightarrow$ $\Delta V_G < 0$

                    • Il charge injection \textbf{sottrae} carica a $C_H$

                    \vspace{0.05cm}
                    $\Rightarrow$ La tensione sul condensatore \textbf{diminuisce}!
                }}

                \vspace{0.15cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ ATTENZIONE alla terminologia!}

                    \vspace{0.1cm}
                    \textbf{Caso 1:} ``$V_G$ ha ampiezza \textbf{12V p-p}'' (picco-picco)

                    $\Rightarrow$ $|\Delta V_G| = 12V$, ma con segno: $\Delta V_G = -12V$

                    \vspace{0.15cm}
                    \textbf{Caso 2:} ``$V_G$ ha ampiezza \textbf{12V}'' (senza p-p)

                    $\Rightarrow$ Oscillazione $\pm 12V$ $\Rightarrow$ escursione totale = 24V

                    $$\boxed{\Delta V_G = -2 \times 12V = -24V}$$

                    \vspace{0.05cm}
                    {\footnotesize \textbf{Regola:} Ampiezza = semipicco $\Rightarrow$ moltiplica per 2, poi segno $-$!}
                }}

                \vspace{0.15cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ CASO PEGGIORE per $\varepsilon_{max}$:}

                    \vspace{0.1cm}
                    L'errore da charge injection è \textbf{massimo} quando la tensione sul condensatore $V_C$ (= $V_{ADC}$) è a un \textbf{estremo del range}!

                    \vspace{0.1cm}
                    \textbf{Perché?} Alla transizione SAMPLE$\to$HOLD:

                    \vspace{0.05cm}
                    • Se $V_C = V_{DD}$ (max): $V_S$ è alta $\Rightarrow$ per avere nMOS ON serviva $V_G$ molto alta $\Rightarrow$ $|\Delta V_G|$ è \textbf{massimo}

                    • Se $V_C = V_{SS}$ (min): stessa logica, escursione massima

                    \vspace{0.1cm}
                    $\Rightarrow$ \textbf{Negli esercizi:} considera $V_C = V_{DD}$ oppure $V_C = V_{SS}$ per trovare $\varepsilon_{max}$!
                }}

                \vspace{0.15cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ Verifica errore ammissibile:}

                    \vspace{0.1cm}
                    Calcola l'errore nel caso peggiore e confrontalo con la specifica:

                    $$|\Delta V| = |\Delta V_G| \cdot \frac{C_p}{C_p + C_H}$$

                    \vspace{0.1cm}
                    \textbf{Errore in LSB:}
                    $$\varepsilon [\text{LSB}] = \frac{|\Delta V|}{LSB} = \frac{|\Delta V| \cdot 2^N}{FSR}$$

                    \vspace{0.1cm}
                    Se la specifica richiede $\varepsilon < k$ LSB (es. $k = 1$ o $k = 0.5$):

                    $$\boxed{\frac{|\Delta V|}{LSB} < k \quad \Rightarrow \quad \text{Errore ammissibile!}}$$
                }}

                \vspace{0.15cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\bigstar$ DIMENSIONAMENTO di $C_H$:}

                    \vspace{0.05cm}
                    Se viene chiesto di dimensionare $C_H$ per avere $\varepsilon < k$ LSB:

                    \vspace{0.05cm}
                    $$|\Delta V_G| \cdot \frac{C_p}{C_p + C_H} < k \cdot LSB$$

                    \vspace{0.05cm}
                    Risolvendo per $C_H$:
                    $$\boxed{C_H > C_p \cdot \left( \frac{|\Delta V_G|}{k \cdot LSB} - 1 \right)}$$
                }}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{\footnotesize
                    \textbf{$\triangle$ NOTA:}

                    \vspace{0.05cm}
                    Il charge injection è un errore \textbf{sistematico} (sempre presente alla transizione ON$\to$OFF).

                    \vspace{0.05cm}
                    A differenza dell'errore da $I_B$ (che cresce nel tempo), questo errore è \textbf{istantaneo}!
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}S\&H - Charge Injection};
    \end{tikzpicture}

    \newpage

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ GUIDA - Riconoscere Configurazioni OpAmp ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \textbf{GUIDA: Riconoscere le Configurazioni OpAmp}

                \vspace{0.15cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ PASSO 1: C'è retroazione?}

                    \vspace{0.1cm}
                    Parti da $V_{out}$: esiste un percorso verso $V^+$ o $V^-$?

                    \vspace{0.1cm}
                    • \textbf{NO} $\Rightarrow$ vai a \textcolor{red}{\textbf{COMPARATORE}}

                    • \textbf{SÌ, verso $V^-$} $\Rightarrow$ vai a \textcolor{green!50!black}{\textbf{RETROAZ. NEGATIVA}}

                    • \textbf{SÌ, verso $V^+$} $\Rightarrow$ vai a \textcolor{blue}{\textbf{RETROAZ. POSITIVA}}
                }}

                \vspace{0.2cm}
                \colorbox{red!25}{\parbox{0.95\linewidth}{
                    \textcolor{red}{\textbf{COMPARATORE}} (no retroazione)

                    \vspace{0.1cm}
                    L'OpAmp è in \textbf{anello aperto} $\Rightarrow$ \textbf{SATURA sempre!}

                    \vspace{0.1cm}
                    • $V^+ > V^-$ $\Rightarrow$ $V_{out} = +V_{sat}$

                    • $V^+ < V^-$ $\Rightarrow$ $V_{out} = -V_{sat}$

                    \vspace{0.15cm}
                    \textbf{C'è una $V_{ref}$ su un morsetto?}

                    • \textbf{SÌ} $\Rightarrow$ \textbf{Comparatore a SINGOLA soglia}

                    \hspace{0.5cm} Soglia = $V_{ref}$

                    • \textbf{NO} $\Rightarrow$ Comparatore semplice (soglia = 0V o altra)
                }}

                \vspace{0.2cm}
                \colorbox{green!25}{\parbox{0.95\linewidth}{
                    \textcolor{green!50!black}{\textbf{RETROAZIONE NEGATIVA}} ($V_{out}$ torna su $V^-$)

                    \vspace{0.1cm}
                    L'OpAmp \textbf{NON satura}, lavora in zona \textbf{lineare}.

                    Vale: $V^+ = V^-$ e $I^+ = I^- = 0$

                    \vspace{0.15cm}
                    \textbf{Il collegamento $V^-$ a $V_{out}$ è DIRETTO?}

                    \vspace{0.1cm}
                    • \textbf{SÌ} (filo diretto) $\Rightarrow$ \textbf{BUFFER} (inseguitore)

                    \hspace{0.5cm} $A_v = 1$, usato nel S\&H

                    \vspace{0.1cm}
                    • \textbf{NO} (c'è $R_f$) $\Rightarrow$ \textbf{Amplificatore}

                    \hspace{0.5cm} Vai al PASSO 2
                }}

                \vspace{0.2cm}
                \colorbox{cyan!20}{\parbox{0.95\linewidth}{
                    \textbf{PASSO 2: Dove entra $V_{in}$?} (se amplificatore)

                    \vspace{0.1cm}
                    • $V_{in}$ entra su $V^-$ (attraverso $R_1$) $\Rightarrow$ \textbf{INVERTENTE}

                    \hspace{0.5cm} $A_v = -\frac{R_f}{R_1}$

                    \vspace{0.1cm}
                    • $V_{in}$ entra su $V^+$ $\Rightarrow$ \textbf{NON INVERTENTE}

                    \hspace{0.5cm} $A_v = 1 + \frac{R_f}{R_1}$

                    \vspace{0.1cm}
                    • Più ingressi su $V^-$ $\Rightarrow$ \textbf{SOMMATORE}

                    \hspace{0.5cm} $V_{out} = -R_f \left( \frac{V_1}{R_1} + \frac{V_2}{R_2} + ... \right)$
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}GUIDA - Riconoscere Configurazioni (1/2)};
    \end{tikzpicture}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %------------ GUIDA - Riconoscere Configurazioni OpAmp (2/2) ---------------

    \begin{tikzpicture}
        \node [mybox] (box){%
            \begin{minipage}{0.3\textwidth}

                \small
                \colorbox{blue!20}{\parbox{0.95\linewidth}{
                    \textcolor{blue}{\textbf{RETROAZIONE POSITIVA}} ($V_{out}$ torna su $V^+$)

                    \vspace{0.1cm}
                    L'OpAmp \textbf{SATURA sempre}! Sistema \textbf{bistabile}.

                    \textbf{NON vale} $V^+ = V^-$

                    \vspace{0.1cm}
                    $\Rightarrow$ È un \textbf{TRIGGER DI SCHMITT} (comparatore a doppia soglia / isteresi)

                    \vspace{0.15cm}
                    \textbf{Dove entra $V_{in}$?}

                    \vspace{0.1cm}
                    • $V_{in}$ entra su $V^-$ $\Rightarrow$ Trigger \textbf{INVERTENTE}

                    \hspace{0.5cm} Ciclo percorso in senso \textbf{antiorario}

                    \vspace{0.1cm}
                    • $V_{in}$ entra su $V^+$ $\Rightarrow$ Trigger \textbf{NON INVERTENTE}

                    \hspace{0.5cm} Ciclo percorso in senso \textbf{orario}
                }}

                \vspace{0.2cm}
                \colorbox{yellow!30}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ SCHEMA RIASSUNTIVO:}

                    \vspace{0.1cm}
                    \begin{tabular}{|l|c|c|}
                        \hline
                        \textbf{Config.} & \textbf{Retroaz.} & \textbf{Satura?} \\
                        \hline
                        Comparatore & Nessuna & \textbf{SÌ} \\
                        \hline
                        Buffer & Neg. (diretto) & NO \\
                        \hline
                        Invertente & Neg. ($R_f$) & NO \\
                        \hline
                        Non Inv. & Neg. ($R_f$) & NO \\
                        \hline
                        Sommatore & Neg. ($R_f$) & NO \\
                        \hline
                        Trigger Schmitt & \textbf{Positiva} & \textbf{SÌ} \\
                        \hline
                    \end{tabular}
                }}

                \vspace{0.2cm}
                \colorbox{red!20}{\parbox{0.95\linewidth}{
                    \textbf{$\triangle$ TRUCCHI VELOCI:}

                    \vspace{0.1cm}
                    • Vedi $R_f$ che va su $V^-$? $\Rightarrow$ Amplificatore (non satura)

                    • Vedi $R$ che va su $V^+$ da $V_{out}$? $\Rightarrow$ Trigger (satura)

                    • Vedi filo diretto $V^- \to V_{out}$? $\Rightarrow$ Buffer

                    • Non vedi nulla che torna indietro? $\Rightarrow$ Comparatore (satura)

                    • Vedi condensatore + switch prima dell'OpAmp? $\Rightarrow$ S\&H
                }}

                \vspace{0.2cm}
                \colorbox{green!20}{\parbox{0.95\linewidth}{
                    \textbf{$\bigstar$ FLOWCHART VELOCE:}

                    \vspace{0.1cm}
                    \texttt{1. Retroazione?}

                    \hspace{0.3cm} \texttt{NO → COMPARATORE (satura)}

                    \hspace{0.3cm} \texttt{SÌ → 2. Dove va?}

                    \vspace{0.05cm}
                    \texttt{2. Verso $V^+$ o $V^-$?}

                    \hspace{0.3cm} \texttt{$V^+$ → TRIGGER (satura)}

                    \hspace{0.3cm} \texttt{$V^-$ → 3. Diretto o con R?}

                    \vspace{0.05cm}
                    \texttt{3. Collegamento diretto?}

                    \hspace{0.3cm} \texttt{SÌ → BUFFER}

                    \hspace{0.3cm} \texttt{NO → AMPLIFICATORE (inv/non-inv)}
                }}

            \end{minipage}
        };
        \node[fancytitle, right=10pt] at (box.north west) {\color{white}GUIDA - Riconoscere Configurazioni (2/2)};
    \end{tikzpicture}


\end{multicols*}
\end{document}